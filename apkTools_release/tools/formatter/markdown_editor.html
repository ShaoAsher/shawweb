<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>åœ¨çº¿ Markdown ç¼–è¾‘å™¨</title>
  <link rel="stylesheet" href="../../assets/css/theme.css">
  <!-- Marked.js for Markdown parsing -->
  <script src="https://cdn.jsdelivr.net/npm/marked@11.1.1/marked.min.js"></script>
  <!-- Highlight.js for code syntax highlighting -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github.min.css"
    id="hljs-style">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/javascript.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/python.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/java.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/css.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/html.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/json.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/bash.min.js"></script>
  <style>
    /* ç»§æ‰¿theme.cssçš„åŸºç¡€æ ·å¼ */
    .container {
      max-width: 1400px;
    }

    .home-btn {
      position: absolute;
      top: var(--spacing-lg);
      left: var(--spacing-lg);
      width: 40px;
      height: 40px;
      background: rgba(255, 255, 255, 0.2);
      border: 2px solid rgba(255, 255, 255, 0.3);
      border-radius: var(--radius-full);
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--color-text-on-primary);
      text-decoration: none;
      font-size: var(--font-size-large);
      transition: all .3s;
      z-index: 10;
    }

    .home-btn:hover {
      background: rgba(255, 255, 255, 0.3);
      border-color: rgba(255, 255, 255, 0.5);
      transform: scale(1.1);
    }

    .header h1 {
      font-size: var(--font-size-xlarge);
      margin-bottom: var(--spacing-sm);
    }

    .header p {
      opacity: 0.9;
      font-size: var(--font-size-small);
    }

    .content {
      padding: var(--spacing-xl);
    }

    .editor-container {
      display: flex;
      flex-direction: column;
      gap: var(--spacing-md);
      height: calc(100vh - 250px);
      min-height: 600px;
    }

    .toolbar {
      display: flex;
      flex-wrap: wrap;
      gap: var(--spacing-sm);
      padding: var(--spacing-md);
      background: var(--color-surface-alt);
      border-radius: var(--radius-md);
      border: 1px solid var(--color-border);
    }

    .toolbar-btn {
      background: var(--color-surface-alt);
      border: 1px solid var(--color-border);
      color: var(--color-text-on-surface-alt);
      padding: var(--spacing-sm) var(--spacing-md);
      border-radius: var(--radius-sm);
      cursor: pointer;
      font-size: var(--font-size-small);
      transition: all 0.2s;
      display: flex;
      align-items: center;
      gap: var(--spacing-xs);
    }

    .toolbar-btn:hover {
      background: var(--color-hover);
      border-color: var(--color-primary);
      transform: translateY(-1px);
    }

    .toolbar-btn:active {
      transform: translateY(0);
    }

    .editor-preview-wrapper {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: var(--spacing-md);
      flex: 1;
      min-height: 0;
    }

    @media (max-width: 1024px) {
      .editor-preview-wrapper {
        grid-template-columns: 1fr;
      }
    }

    .editor-section,
    .preview-section {
      display: flex;
      flex-direction: column;
      background: var(--color-surface);
      border: 1px solid var(--color-border);
      border-radius: var(--radius-md);
      overflow: hidden;
    }

    .section-header {
      padding: var(--spacing-md);
      background: var(--color-surface-alt);
      border-bottom: 1px solid var(--color-border);
      font-weight: var(--font-weight-semibold);
      color: var(--color-text);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .editor-textarea {
      flex: 1;
      padding: var(--spacing-md);
      border: none;
      background: var(--color-surface);
      color: var(--color-text);
      font-family: 'Courier New', Consolas, monospace;
      font-size: var(--font-size-base);
      line-height: 1.6;
      resize: none;
      outline: none;
      overflow-y: auto;
    }

    .preview-content {
      flex: 1;
      padding: var(--spacing-lg);
      overflow-y: auto;
      background: var(--color-surface);
      color: var(--color-text);
    }

    .preview-content h1,
    .preview-content h2,
    .preview-content h3,
    .preview-content h4,
    .preview-content h5,
    .preview-content h6 {
      color: var(--color-text);
      margin-top: var(--spacing-lg);
      margin-bottom: var(--spacing-md);
      font-weight: var(--font-weight-bold);
    }

    .preview-content h1 {
      font-size: var(--font-size-xxlarge);
      border-bottom: 2px solid var(--color-border);
      padding-bottom: var(--spacing-sm);
    }

    .preview-content h2 {
      font-size: var(--font-size-xlarge);
      border-bottom: 1px solid var(--color-border);
      padding-bottom: var(--spacing-xs);
    }

    .preview-content h3 {
      font-size: var(--font-size-large);
    }

    .preview-content p {
      margin-bottom: var(--spacing-md);
      line-height: var(--line-height);
    }

    .preview-content ul,
    .preview-content ol {
      margin-bottom: var(--spacing-md);
      padding-left: var(--spacing-xl);
    }

    .preview-content li {
      margin-bottom: var(--spacing-xs);
    }

    .preview-content code {
      background: var(--color-surface-alt);
      padding: 2px 6px;
      border-radius: var(--radius-sm);
      font-family: 'Courier New', Consolas, monospace;
      font-size: 0.9em;
      color: var(--color-primary);
    }

    .preview-content pre {
      background: var(--color-surface-alt);
      border: 1px solid var(--color-border);
      border-radius: var(--radius-md);
      padding: var(--spacing-md);
      overflow-x: auto;
      margin-bottom: var(--spacing-md);
    }

    .preview-content pre code {
      background: transparent;
      padding: 0;
      color: var(--color-text);
    }

    .preview-content blockquote {
      border-left: 4px solid var(--color-primary);
      padding-left: var(--spacing-md);
      margin: var(--spacing-md) 0;
      color: var(--color-text-secondary);
      background: var(--color-surface-alt);
      padding: var(--spacing-md);
      border-radius: var(--radius-sm);
    }

    .preview-content table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: var(--spacing-md);
    }

    .preview-content table th,
    .preview-content table td {
      border: 1px solid var(--color-border);
      padding: var(--spacing-sm);
      text-align: left;
    }

    .preview-content table th {
      background: var(--color-surface-alt);
      font-weight: var(--font-weight-semibold);
    }

    .preview-content a {
      color: var(--color-primary);
      text-decoration: none;
    }

    .preview-content a:hover {
      text-decoration: underline;
    }

    .preview-content img {
      max-width: 100%;
      height: auto;
      border-radius: var(--radius-md);
      margin: var(--spacing-md) 0;
    }

    .preview-content hr {
      border: none;
      border-top: 2px solid var(--color-border);
      margin: var(--spacing-xl) 0;
    }

    .action-buttons {
      display: flex;
      gap: var(--spacing-md);
      margin-top: var(--spacing-md);
    }

    .btn {
      background: linear-gradient(135deg, var(--color-primary) 0%, var(--color-primary-dark) 100%);
      color: var(--color-text-on-primary);
      border: none;
      padding: var(--spacing-sm) var(--spacing-xl);
      border-radius: var(--radius-sm);
      font-size: var(--font-size-base);
      font-weight: var(--font-weight-semibold);
      cursor: pointer;
      transition: all 0.2s;
    }

    .btn:hover {
      transform: translateY(-2px);
      box-shadow: var(--shadow-md);
    }

    .btn:active {
      transform: translateY(0);
    }

    .btn-secondary {
      background: var(--color-surface-alt);
      color: var(--color-text-on-surface-alt);
      border: 1px solid var(--color-border);
    }

    .btn-secondary:hover {
      background: var(--color-hover);
    }

    .empty-preview {
      color: var(--color-text-secondary);
      text-align: center;
      padding: var(--spacing-xl);
      font-style: italic;
    }

    /* Highlight.js theme adjustments for dark themes */
    body[data-theme="cyberpunk"] .preview-content pre code,
    body.cyberpunk .preview-content pre code,
    body[data-theme="modern"] .preview-content pre code,
    body.modern .preview-content pre code {
      color: var(--color-text);
    }
  </style>
</head>

<body>
  <div class="container">
    <div class="header">
      <a href="../../index.html" class="home-btn" title="è¿”å›é¦–é¡µ">ğŸ </a>
      <h1>ğŸ“ åœ¨çº¿ Markdown ç¼–è¾‘å™¨</h1>
      <p>æ”¯æŒå®æ—¶é¢„è§ˆã€è¯­æ³•é«˜äº®å’Œä¸°å¯Œçš„ç¼–è¾‘å¿«æ·æŒ‰é’®</p>
    </div>
    <div class="content">
      <div class="editor-container">
        <div class="toolbar">
          <button class="toolbar-btn" onclick="insertText('h1')" title="æ ‡é¢˜ 1">
            <span>H1</span>
          </button>
          <button class="toolbar-btn" onclick="insertText('h2')" title="æ ‡é¢˜ 2">
            <span>H2</span>
          </button>
          <button class="toolbar-btn" onclick="insertText('h3')" title="æ ‡é¢˜ 3">
            <span>H3</span>
          </button>
          <button class="toolbar-btn" onclick="insertText('bold')" title="ç²—ä½“">
            <span>ğ</span>
          </button>
          <button class="toolbar-btn" onclick="insertText('italic')" title="æ–œä½“">
            <span>ğ¼</span>
          </button>
          <button class="toolbar-btn" onclick="insertText('link')" title="é“¾æ¥">
            <span>ğŸ”—</span>
          </button>
          <button class="toolbar-btn" onclick="insertText('image')" title="å›¾ç‰‡">
            <span>ğŸ–¼ï¸</span>
          </button>
          <button class="toolbar-btn" onclick="insertText('code')" title="è¡Œå†…ä»£ç ">
            <span>&lt;/&gt;</span>
          </button>
          <button class="toolbar-btn" onclick="insertText('codeblock')" title="ä»£ç å—">
            <span>â–</span>
          </button>
          <button class="toolbar-btn" onclick="insertText('quote')" title="å¼•ç”¨">
            <span>â</span>
          </button>
          <button class="toolbar-btn" onclick="insertText('list')" title="æ— åºåˆ—è¡¨">
            <span>â€¢</span>
          </button>
          <button class="toolbar-btn" onclick="insertText('olist')" title="æœ‰åºåˆ—è¡¨">
            <span>1.</span>
          </button>
          <button class="toolbar-btn" onclick="insertText('table')" title="è¡¨æ ¼">
            <span>â˜·</span>
          </button>
          <button class="toolbar-btn" onclick="insertText('hr')" title="åˆ†å‰²çº¿">
            <span>â”€</span>
          </button>
        </div>

        <div class="editor-preview-wrapper">
          <div class="editor-section">
            <div class="section-header">
              <span>ç¼–è¾‘åŒº</span>
              <span style="font-size: var(--font-size-small); color: var(--color-text-secondary);" id="charCount">0
                å­—ç¬¦</span>
            </div>
            <textarea id="editor" class="editor-textarea" placeholder="åœ¨æ­¤è¾“å…¥ Markdown å†…å®¹..."># Markdown ç¼–è¾‘å™¨

æ¬¢è¿ä½¿ç”¨åœ¨çº¿ Markdown ç¼–è¾‘å™¨ï¼

## åŠŸèƒ½ç‰¹æ€§

- âœ¨ å®æ—¶é¢„è§ˆ
- ğŸ¨ è¯­æ³•é«˜äº®
- âŒ¨ï¸ å¿«æ·æŒ‰é’®
- ğŸ“± å“åº”å¼è®¾è®¡

## ä½¿ç”¨æ–¹æ³•

1. åœ¨å·¦ä¾§ç¼–è¾‘åŒºè¾“å…¥ Markdown å†…å®¹
2. å³ä¾§ä¼šå®æ—¶æ˜¾ç¤ºé¢„è§ˆæ•ˆæœ
3. ä½¿ç”¨ä¸Šæ–¹å·¥å…·æ å¿«é€Ÿæ’å…¥å¸¸ç”¨æ ¼å¼

### ä»£ç ç¤ºä¾‹

\`\`\`javascript
function hello() {
    console.log('Hello, Markdown!');
}
\`\`\`

> è¿™æ˜¯ä¸€ä¸ªå¼•ç”¨å—

**ç²—ä½“æ–‡æœ¬** å’Œ *æ–œä½“æ–‡æœ¬*

[é“¾æ¥ç¤ºä¾‹](https://example.com)</textarea>
          </div>

          <div class="preview-section">
            <div class="section-header">
              <span>é¢„è§ˆåŒº</span>
            </div>
            <div id="preview" class="preview-content"></div>
          </div>
        </div>
      </div>

      <div class="action-buttons">
        <button class="btn" onclick="clearEditor()">æ¸…ç©º</button>
        <button class="btn btn-secondary" onclick="copyToClipboard()">å¤åˆ¶å†…å®¹</button>
        <button class="btn btn-secondary" onclick="downloadMarkdown()">ä¸‹è½½ Markdown</button>
        <button class="btn btn-secondary" onclick="downloadHTML()">ä¸‹è½½ HTML</button>
      </div>
    </div>
  </div>

  <script src="../../assets/js/themes.js"></script>
  <script src="../../assets/js/theme-ui.js"></script>
  <script>
    // é…ç½® Marked.js
    marked.setOptions({
      breaks: true,
      gfm: true,
      headerIds: true,
      mangle: false
    });

    const editor = document.getElementById('editor');
    const preview = document.getElementById('preview');
    const charCount = document.getElementById('charCount');

    // åˆå§‹åŒ–é¢„è§ˆ
    updatePreview();

    // å®æ—¶æ›´æ–°é¢„è§ˆ
    editor.addEventListener('input', () => {
      updatePreview();
      updateCharCount();
    });

    // æ›´æ–°å­—ç¬¦è®¡æ•°
    function updateCharCount() {
      const count = editor.value.length;
      charCount.textContent = `${count.toLocaleString()} å­—ç¬¦`;
    }

    // æ›´æ–°é¢„è§ˆ
    function updatePreview() {
      const markdown = editor.value;
      if (markdown.trim()) {
        const html = marked.parse(markdown);
        preview.innerHTML = html;
        // é«˜äº®ä»£ç å—
        preview.querySelectorAll('pre code').forEach((block) => {
          hljs.highlightElement(block);
        });
      } else {
        preview.innerHTML = '<div class="empty-preview">é¢„è§ˆå†…å®¹å°†æ˜¾ç¤ºåœ¨è¿™é‡Œ...</div>';
      }
    }

    // æ’å…¥æ–‡æœ¬
    function insertText(type) {
      const textarea = editor;
      const start = textarea.selectionStart;
      const end = textarea.selectionEnd;
      const selectedText = textarea.value.substring(start, end);
      let insertText = '';
      let cursorOffset = 0;

      switch (type) {
        case 'h1':
          insertText = `# ${selectedText || 'æ ‡é¢˜ 1'}`;
          cursorOffset = selectedText ? 0 : -4;
          break;
        case 'h2':
          insertText = `## ${selectedText || 'æ ‡é¢˜ 2'}`;
          cursorOffset = selectedText ? 0 : -4;
          break;
        case 'h3':
          insertText = `### ${selectedText || 'æ ‡é¢˜ 3'}`;
          cursorOffset = selectedText ? 0 : -4;
          break;
        case 'bold':
          insertText = `**${selectedText || 'ç²—ä½“æ–‡æœ¬'}**`;
          cursorOffset = selectedText ? 0 : -4;
          break;
        case 'italic':
          insertText = `*${selectedText || 'æ–œä½“æ–‡æœ¬'}*`;
          cursorOffset = selectedText ? 0 : -4;
          break;
        case 'link':
          insertText = `[${selectedText || 'é“¾æ¥æ–‡æœ¬'}](https://example.com)`;
          cursorOffset = selectedText ? -18 : -22;
          break;
        case 'image':
          insertText = `![${selectedText || 'å›¾ç‰‡æè¿°'}](https://example.com/image.png)`;
          cursorOffset = selectedText ? -31 : -37;
          break;
        case 'code':
          insertText = `\`${selectedText || 'ä»£ç '}\``;
          cursorOffset = selectedText ? 0 : -2;
          break;
        case 'codeblock':
          insertText = `\`\`\`\n${selectedText || 'ä»£ç å—'}\n\`\`\``;
          cursorOffset = selectedText ? -3 : -6;
          break;
        case 'quote':
          insertText = `> ${selectedText || 'å¼•ç”¨å†…å®¹'}`;
          cursorOffset = selectedText ? 0 : -5;
          break;
        case 'list':
          insertText = `- ${selectedText || 'åˆ—è¡¨é¡¹'}`;
          cursorOffset = selectedText ? 0 : -4;
          break;
        case 'olist':
          insertText = `1. ${selectedText || 'åˆ—è¡¨é¡¹'}`;
          cursorOffset = selectedText ? 0 : -4;
          break;
        case 'table':
          insertText = `| åˆ—1 | åˆ—2 | åˆ—3 |\n| --- | --- | --- |\n| å†…å®¹1 | å†…å®¹2 | å†…å®¹3 |`;
          cursorOffset = -selectedText.length;
          break;
        case 'hr':
          insertText = `\n---\n`;
          cursorOffset = 0;
          break;
      }

      const newText = textarea.value.substring(0, start) + insertText + textarea.value.substring(end);
      textarea.value = newText;
      textarea.focus();

      const newCursorPos = start + insertText.length + cursorOffset;
      textarea.setSelectionRange(newCursorPos, newCursorPos);

      updatePreview();
      updateCharCount();
    }

    // æ¸…ç©ºç¼–è¾‘å™¨
    function clearEditor() {
      if (confirm('ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰å†…å®¹å—ï¼Ÿ')) {
        editor.value = '';
        updatePreview();
        updateCharCount();
      }
    }

    // å¤åˆ¶åˆ°å‰ªè´´æ¿
    async function copyToClipboard() {
      try {
        await navigator.clipboard.writeText(editor.value);
        alert('å†…å®¹å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼');
      } catch (err) {
        // é™çº§æ–¹æ¡ˆ
        const textArea = document.createElement('textarea');
        textArea.value = editor.value;
        document.body.appendChild(textArea);
        textArea.select();
        try {
          document.execCommand('copy');
          alert('å†…å®¹å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼');
        } catch (e) {
          alert('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶');
        }
        document.body.removeChild(textArea);
      }
    }

    // ä¸‹è½½ Markdown
    function downloadMarkdown() {
      const content = editor.value;
      const blob = new Blob([content], { type: 'text/markdown;charset=utf-8' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `markdown-${Date.now()}.md`;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
    }

    // ä¸‹è½½ HTML
    function downloadHTML() {
      const markdown = editor.value;
      const html = marked.parse(markdown);
      const fullHtml = `<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Markdown å¯¼å‡º</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
        }
        pre {
            background: #f5f5f5;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
        }
        code {
            background: #f5f5f5;
            padding: 2px 6px;
            border-radius: 3px;
        }
        blockquote {
            border-left: 4px solid #ddd;
            padding-left: 20px;
            margin: 20px 0;
            color: #666;
        }
    </style>
</head>
<body>
${html}
</body>
</html>`;
      const blob = new Blob([fullHtml], { type: 'text/html;charset=utf-8' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `markdown-${Date.now()}.html`;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
    }

    // åˆå§‹åŒ–å­—ç¬¦è®¡æ•°
    updateCharCount();

    // Tab é”®æ”¯æŒï¼ˆæ’å…¥4ä¸ªç©ºæ ¼ï¼‰
    editor.addEventListener('keydown', (e) => {
      if (e.key === 'Tab') {
        e.preventDefault();
        const start = editor.selectionStart;
        const end = editor.selectionEnd;
        editor.value = editor.value.substring(0, start) + '    ' + editor.value.substring(end);
        editor.selectionStart = editor.selectionEnd = start + 4;
        updatePreview();
      }
    });
  </script>
</body>

</html>