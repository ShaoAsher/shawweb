<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>å›¾ç‰‡å‹ç¼©å·¥å…·</title>
    <!-- Google Fonts - è‰ºæœ¯å­—ä½“ -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;600;700&family=Rajdhani:wght@400;500;600;700&family=Inter:wght@400;500;600;700&family=Noto+Sans+SC:wght@400;500;600;700&family=Poppins:wght@400;500;600;700&family=Montserrat:wght@400;500;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="../../assets/css/theme.css">
  <style>
    /* ç»§æ‰¿theme.cssçš„åŸºç¡€æ ·å¼ */
    /* ä»¥ä¸‹æ˜¯å·¥å…·é¡µé¢ç‰¹å®šçš„æ ·å¼è¦†ç›– */

    .container {
      max-width: 1000px;
    }

    .home-btn {
      position: absolute;
      top: var(--spacing-lg);
      left: var(--spacing-lg);
      width: 40px;
      height: 40px;
      background: rgba(255, 255, 255, 0.2);
      border: 2px solid rgba(255, 255, 255, 0.3);
      border-radius: var(--radius-full);
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--color-text-on-primary);
      text-decoration: none;
      font-size: var(--font-size-large);
      transition: all .3s;
      z-index: 10;
    }

    .home-btn:hover {
      background: rgba(255, 255, 255, 0.3);
      border-color: rgba(255, 255, 255, 0.5);
      transform: scale(1.1);
    }

    .header h1 {
      font-size: var(--font-size-xlarge);
      margin-bottom: var(--spacing-sm);
    }

    .header p {
      opacity: .9;
      font-size: var(--font-size-small);
    }

    .content {
      padding: var(--spacing-xl);
    }

    .form-section {
      background: var(--color-background-alt);
      border-radius: var(--radius-md);
      padding: var(--spacing-lg);
      margin-bottom: var(--spacing-lg);
    }

    .form-section h2 {
      font-size: var(--font-size-large);
      color: var(--color-text);
      margin-bottom: var(--spacing-lg);
      border-bottom: 2px solid var(--color-primary);
      padding-bottom: var(--spacing-sm);
    }

    .form-group {
      margin-bottom: var(--spacing-lg);
    }

    .form-group label {
      display: block;
      font-weight: var(--font-weight-semibold);
      color: var(--color-text);
      margin-bottom: var(--spacing-sm);
      font-size: var(--font-size-small);
    }

    .form-group input,
    .form-group select {
      width: 100%;
      padding: var(--spacing-sm);
      border: 2px solid var(--color-border);
      border-radius: var(--radius-sm);
      font-size: var(--font-size-small);
      transition: border-color .3s;
      background: var(--color-surface);
      color: var(--color-text);
    }

    .form-group input:focus,
    .form-group select:focus {
      outline: none;
      border-color: var(--color-primary);
      box-shadow: 0 0 0 4px var(--color-shadow-primary);
    }

    .file-upload-area {
      border: 3px dashed var(--color-primary);
      border-radius: var(--radius-md);
      padding: var(--spacing-xxl);
      text-align: center;
      background: var(--color-hover);
      cursor: pointer;
      transition: all .3s;
    }

    .file-upload-area:hover {
      background: var(--color-surface-alt);
      border-color: var(--color-primary-dark);
    }

    .file-upload-area.dragover {
      background: var(--color-hover);
      border-color: var(--color-primary);
    }

    .file-upload-area input[type=file] {
      display: none;
    }

    .file-upload-icon {
      font-size: 48px;
      color: var(--color-primary);
      margin-bottom: var(--spacing-md);
    }

    .file-upload-text {
      color: var(--color-text-secondary);
      font-size: var(--font-size-base);
      margin-bottom: 10px
    }

    .file-upload-hint {
      color: var(--color-text-secondary);
      font-size: 12px
    }

    .btn {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: var(--color-text-on-primary);
      border: none;
      padding: 14px 35px;
      border-radius: var(--radius-sm);
      font-size: var(--font-size-base);
      font-weight: 600;
      cursor: pointer;
      transition: transform .2s;
      width: 100%
    }

    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(102, 126, 234, .4)
    }

    .btn:disabled {
      opacity: .6;
      cursor: not-allowed;
      transform: none
    }

    .btn-secondary {
      background: #6c757d
    
      color: var(--color-text-on-primary);}

    .btn-secondary:hover {
      background: #5a6268
    }

    .controls-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 15px
    }

    .range-wrapper {
      display: flex;
      align-items: center;
      gap: 10px
    }

    .range-wrapper input[type=range] {
      flex: 1
    }

    .info-box {
      background: var(--color-surface-alt);
      border-left: 4px solid var(--color-info);
      padding: var(--spacing-md);
      border-radius: var(--radius-sm);
      margin-bottom: 20px;
      font-size: 13px;
      color: #0c5460
    }

    .status-message {
      padding: 12px;
      border-radius: var(--radius-sm);
      margin-top: 15px;
      display: none
    }

    .status-message.success {
      background: var(--color-surface-alt);
      color: var(--color-success);
      border: 1px solid #c3e6cb;
      display: block
    }

    .status-message.error {
      background: var(--color-surface-alt);
      color: var(--color-error);
      border: 1px solid #f5c6cb;
      display: block
    }

    .loading {
      text-align: center;
      padding: 20px;
      display: none
    }

    .loading.show {
      display: block
    }

    .spinner {
      border: 4px solid var(--color-border);
      border-top: 4px solid var(--color-primary);
      border-radius: 50%;
      width: 40px;
      height: 40px;
      animation: spin 1s linear infinite;
      margin: 0 auto 15px
    }

    @keyframes spin {
      0% {
        transform: rotate(0)
      }

      100% {
        transform: rotate(360deg)
      }
    }

    .preview-section {
      margin-top: 20px
    }

    .preview-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 20px
    }

    .preview-card {
      background: var(--color-surface);
      border: 2px solid var(--color-border);
      border-radius: var(--radius-md);
      padding: 12px
    }

    .preview-title {
      font-size: var(--font-size-small);
      color: var(--color-text-secondary);
      margin-bottom: 8px
    }

    .preview-image {
      width: 100%;
      height: auto;
      border-radius: var(--radius-sm);
      box-shadow: 0 4px 12px rgba(0, 0, 0, .1)
    }

    .meta {
      font-size: var(--font-size-small);
      color: var(--color-text-secondary);
      margin-top: 8px
    }
  </style>
</head>

<body>
  <div class="container">
    <div class="header">
      <a href="../../index.html" class="home-btn" title="è¿”å›é¦–é¡µ">ğŸ </a>
      <h1>ğŸ—œï¸ å›¾ç‰‡å‹ç¼©å·¥å…·</h1>
      <p>ä¿æŒæ¯”ä¾‹ä¸æ¸…æ™°åº¦ï¼Œæ™ºèƒ½å‹ç¼©å¹¶é¢„è§ˆå¯¹æ¯”</p>
    </div>
    <div class="content">
      <div class="form-section">
        <h2>ä¸Šä¼ å›¾ç‰‡</h2>
        <div class="file-upload-area" id="uploadArea">
          <div class="file-upload-icon">ğŸ“</div>
          <div class="file-upload-text">ç‚¹å‡»æˆ–æ‹–æ‹½å›¾ç‰‡åˆ°æ­¤å¤„</div>
          <div class="file-upload-hint">æ”¯æŒ JPGã€PNGã€WEBP</div>
          <input type="file" id="imageInput" accept="image/*">
        </div>
        <div id="statusMessage" class="status-message"></div>
      </div>

      <div class="form-section" id="settingsSection" style="display:none;">
        <h2>å‹ç¼©è®¾ç½®</h2>
        <div class="info-box">é»˜è®¤ä»…åœ¨è¶…è¿‡é™åˆ¶æ—¶ç¼©å°å°ºå¯¸ï¼Œå§‹ç»ˆä¿æŒåŸå§‹å®½é«˜æ¯”ä¾‹ã€‚</div>
        <div class="controls-grid">
          <div class="form-group">
            <label for="maxWidth">æœ€å¤§å®½åº¦ï¼ˆåƒç´ ï¼Œå¯é€‰ï¼‰</label>
            <input type="number" id="maxWidth" placeholder="å¦‚ 1920" min="1">
          </div>
          <div class="form-group">
            <label for="maxHeight">æœ€å¤§é«˜åº¦ï¼ˆåƒç´ ï¼Œå¯é€‰ï¼‰</label>
            <input type="number" id="maxHeight" placeholder="å¦‚ 1080" min="1">
          </div>
          <div class="form-group">
            <label for="targetSizeKB">ç›®æ ‡å¤§å°ï¼ˆKBï¼Œå¯é€‰ï¼‰</label>
            <input type="number" id="targetSizeKB" placeholder="å¦‚ 300" min="1">
          </div>
          <div class="form-group">
            <label for="formatSelect">è¾“å‡ºæ ¼å¼</label>
            <select id="formatSelect">
              <option value="auto">è‡ªåŠ¨</option>
              <option value="jpeg">JPEGï¼ˆæœ‰æŸï¼‰</option>
              <option value="png">PNGï¼ˆæ— æŸï¼‰</option>
              <option value="webp">WEBPï¼ˆæœ‰æŸï¼‰</option>
            </select>
          </div>
          <div class="form-group">
            <label>è´¨é‡</label>
            <div class="range-wrapper">
              <input type="range" id="qualityRange" min="50" max="100" value="92">
              <span id="qualityLabel">92</span>
            </div>
          </div>
        </div>
        <div class="form-group">
          <label>
            <input type="checkbox" id="avoidUpscale" checked>
            ç¦æ­¢æ”¾å¤§ï¼ˆä»…ç¼©å°ï¼‰
          </label>
        </div>
        <button class="btn" id="compressBtn">å¼€å§‹å‹ç¼©</button>
      </div>

      <div class="loading" id="loading">
        <div class="spinner"></div>
        <div>æ­£åœ¨å‹ç¼©å›¾ç‰‡...</div>
      </div>

      <div class="form-section preview-section" id="previewSection" style="display:none;">
        <h2>é¢„è§ˆä¸å¯¹æ¯”</h2>
        <div class="preview-grid">
          <div class="preview-card">
            <div class="preview-title">åŸå›¾</div>
            <img id="originalPreview" class="preview-image" alt="åŸå›¾é¢„è§ˆ">
            <div class="meta" id="originalMeta">-</div>
          </div>
          <div class="preview-card">
            <div class="preview-title">å‹ç¼©å</div>
            <img id="compressedPreview" class="preview-image" alt="å‹ç¼©é¢„è§ˆ">
            <div class="meta" id="compressedMeta">-</div>
          </div>
        </div>
        <div style="display:flex;gap:10px;margin-top:15px;flex-wrap:wrap;">
          <button class="btn" id="downloadBtn">ä¸‹è½½å‹ç¼©å›¾ç‰‡</button>
          <button class="btn btn-secondary" id="resetBtn">é‡æ–°é€‰æ‹©å›¾ç‰‡</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    const uploadArea = document.getElementById('uploadArea');
    const imageInput = document.getElementById('imageInput');
    const statusMessage = document.getElementById('statusMessage');
    const settingsSection = document.getElementById('settingsSection');
    const compressBtn = document.getElementById('compressBtn');
    const loading = document.getElementById('loading');
    const maxWidthInput = document.getElementById('maxWidth');
    const maxHeightInput = document.getElementById('maxHeight');
    const targetSizeKBInput = document.getElementById('targetSizeKB');
    const formatSelect = document.getElementById('formatSelect');
    const qualityRange = document.getElementById('qualityRange');
    const qualityLabel = document.getElementById('qualityLabel');
    const avoidUpscale = document.getElementById('avoidUpscale');
    const previewSection = document.getElementById('previewSection');
    const originalPreview = document.getElementById('originalPreview');
    const compressedPreview = document.getElementById('compressedPreview');
    const originalMeta = document.getElementById('originalMeta');
    const compressedMeta = document.getElementById('compressedMeta');
    const downloadBtn = document.getElementById('downloadBtn');
    const resetBtn = document.getElementById('resetBtn');

    let originalImage = null;
    let originalBlob = null;
    let compressedBlob = null;
    let compressedExt = 'jpg';

    uploadArea.addEventListener('click', () => imageInput.click());
    uploadArea.addEventListener('dragover', e => { e.preventDefault(); uploadArea.classList.add('dragover') });
    uploadArea.addEventListener('dragleave', e => { e.preventDefault(); uploadArea.classList.remove('dragover') });
    uploadArea.addEventListener('drop', e => { e.preventDefault(); uploadArea.classList.remove('dragover'); const files = e.dataTransfer.files; if (files.length > 0) handleFile(files[0]) });
    imageInput.addEventListener('change', e => { const file = e.target.files[0]; if (file) handleFile(file) });

    qualityRange.addEventListener('input', () => { qualityLabel.textContent = qualityRange.value });
    formatSelect.addEventListener('change', () => { const v = formatSelect.value; const lossy = v === 'jpeg' || v === 'webp' || v === 'auto'; qualityRange.disabled = !(lossy); qualityLabel.style.opacity = qualityRange.disabled ? 0.5 : 1 });

    resetBtn.addEventListener('click', () => { resetState() });
    downloadBtn.addEventListener('click', () => { if (!compressedBlob) return; const url = URL.createObjectURL(compressedBlob); const name = `compressed_${Date.now()}.${compressedExt}`; const a = document.createElement('a'); a.href = url; a.download = name; document.body.appendChild(a); a.click(); document.body.removeChild(a); URL.revokeObjectURL(url) });

    compressBtn.addEventListener('click', async () => { if (!originalImage) return; loading.classList.add('show'); try { const result = await compressImage(originalImage); compressedBlob = result.blob; compressedExt = result.ext; const url = URL.createObjectURL(compressedBlob); compressedPreview.src = url; const sizeKB = (compressedBlob.size / 1024).toFixed(2); compressedMeta.textContent = `å°ºå¯¸: ${result.width}Ã—${result.height} | å¤§å°: ${sizeKB} KB | æ ¼å¼: ${compressedExt.toUpperCase()}`; previewSection.style.display = 'block' } catch (err) { showStatus('å‹ç¼©å¤±è´¥: ' + err.message, 'error') } finally { loading.classList.remove('show') } });

    function handleFile(file) { if (!file.type.startsWith('image/')) { showStatus('è¯·é€‰æ‹©å›¾ç‰‡æ–‡ä»¶', 'error'); return } const reader = new FileReader(); reader.onload = e => { const img = new Image(); img.onload = () => { originalImage = img; originalBlob = file; settingsSection.style.display = 'block'; uploadArea.style.display = 'none'; showStatus('å›¾ç‰‡åŠ è½½æˆåŠŸ', 'success'); const url = e.target.result; originalPreview.src = url; const sizeKB = (file.size / 1024).toFixed(2); originalMeta.textContent = `å°ºå¯¸: ${img.naturalWidth || img.width}Ã—${img.naturalHeight || img.height} | å¤§å°: ${sizeKB} KB`; previewSection.style.display = 'none' }; img.src = e.target.result }; reader.readAsDataURL(file) }

    function resetState() { originalImage = null; originalBlob = null; compressedBlob = null; compressedExt = 'jpg'; imageInput.value = ''; uploadArea.style.display = 'block'; settingsSection.style.display = 'none'; previewSection.style.display = 'none'; statusMessage.classList.remove('success', 'error'); statusMessage.style.display = 'none' }

    function showStatus(text, type) { statusMessage.textContent = text; statusMessage.className = 'status-message ' + (type || 'success'); statusMessage.style.display = 'block' }

    function getAutoFormat(img, originalType) { const hasAlpha = detectAlpha(img); if (hasAlpha) return 'png'; if (originalType && originalType.includes('png')) return 'png'; return 'jpeg' }

    function detectAlpha(img) { const c = document.createElement('canvas'); c.width = img.naturalWidth || img.width; c.height = img.naturalHeight || img.height; const ctx = c.getContext('2d'); ctx.drawImage(img, 0, 0); const data = ctx.getImageData(0, 0, c.width, c.height).data; for (let i = 3; i < data.length; i += 4) { if (data[i] !== 255) return true } return false }

    function computeTargetSize(w, h) { const mw = parseInt(maxWidthInput.value) || 0; const mh = parseInt(maxHeightInput.value) || 0; let tw = w, th = h; if (mw > 0 || mh > 0) { const sw = mw > 0 ? mw / w : Infinity; const sh = mh > 0 ? mh / h : Infinity; let scale = Math.min(sw, sh); if (scale === Infinity) scale = 1; if (avoidUpscale.checked) scale = Math.min(scale, 1); tw = Math.max(1, Math.floor(w * scale)); th = Math.max(1, Math.floor(h * scale)) } return { tw, th } }

    async function compressImage(img) { const ow = img.naturalWidth || img.width; const oh = img.naturalHeight || img.height; const { tw, th } = computeTargetSize(ow, oh); const c = document.createElement('canvas'); c.width = tw; c.height = th; const ctx = c.getContext('2d'); ctx.imageSmoothingEnabled = true; ctx.imageSmoothingQuality = 'high'; ctx.drawImage(img, 0, 0, ow, oh, 0, 0, tw, th); let fmt = formatSelect.value; if (fmt === 'auto') fmt = getAutoFormat(img, originalBlob ? originalBlob.type : null); const targetKB = parseInt(targetSizeKBInput.value) || 0; const targetBytes = targetKB > 0 ? targetKB * 1024 : 0; const maxQ = parseInt(qualityRange.value) / 100; const minQ = 0.7; function toBlobAsync(canvas, mime, quality) { return new Promise(res => canvas.toBlob(b => res(b), mime, quality)) } async function tryBinary(mime, ext) { let low = minQ, high = maxQ, best = null; for (let i = 0; i < 8; i++) { const mid = (low + high) / 2; const blob = await toBlobAsync(c, mime, mid); if (!blob) break; if (targetBytes > 0 && blob.size > targetBytes) { high = mid } else { best = blob; low = mid } } if (best) return { blob: best, ext }; const final = await toBlobAsync(c, mime, Math.max(minQ, Math.min(maxQ, high))); return { blob: final, ext } } if (fmt === 'png') { const pngBlob = await toBlobAsync(c, 'image/png'); if (!pngBlob) throw new Error('ç”Ÿæˆå›¾ç‰‡å¤±è´¥'); if (targetBytes > 0 && pngBlob.size > targetBytes) { const hasAlpha = detectAlpha(img); const webpRes = await tryBinary('image/webp', 'webp'); if (targetBytes > 0 && webpRes.blob.size > targetBytes) { showStatus('å·²å°½åŠ›å‹ç¼©ï¼Œæœªå®Œå…¨è¾¾åˆ°ç›®æ ‡å¤§å°', 'error') } else { if (hasAlpha) showStatus('ä¸ºè¾¾åˆ°ç›®æ ‡å¤§å°ï¼Œå·²åˆ‡æ¢ä¸º WEBPï¼ˆä¿ç•™é€æ˜ï¼‰', 'success') } return { blob: webpRes.blob, ext: webpRes.ext, width: tw, height: th } } return { blob: pngBlob, ext: 'png', width: tw, height: th } } if (fmt === 'jpeg') { const jpgRes = await tryBinary('image/jpeg', 'jpg'); if (targetBytes > 0 && jpgRes.blob.size > targetBytes) { const webpRes = await tryBinary('image/webp', 'webp'); if (webpRes.blob.size < jpgRes.blob.size) { showStatus('ä¸ºè¾¾åˆ°ç›®æ ‡å¤§å°ï¼Œå·²åˆ‡æ¢ä¸º WEBP', 'success'); return { blob: webpRes.blob, ext: webpRes.ext, width: tw, height: th } } else { showStatus('å·²å°½åŠ›å‹ç¼©ï¼Œæœªå®Œå…¨è¾¾åˆ°ç›®æ ‡å¤§å°', 'error') } } return { blob: jpgRes.blob, ext: jpgRes.ext, width: tw, height: th } } if (fmt === 'webp') { const webpRes = await tryBinary('image/webp', 'webp'); if (targetBytes > 0 && webpRes.blob.size > targetBytes) { showStatus('å·²å°½åŠ›å‹ç¼©ï¼Œæœªå®Œå…¨è¾¾åˆ°ç›®æ ‡å¤§å°', 'error') } return { blob: webpRes.blob, ext: webpRes.ext, width: tw, height: th } } const defaultRes = await tryBinary('image/jpeg', 'jpg'); return { blob: defaultRes.blob, ext: defaultRes.ext, width: tw, height: th } }
  </script>
  <script src="../../assets/js/tools.js"></script>
  <script src="../../assets/js/themes.js"></script>
  <script src="../../assets/js/theme-ui.js"></script>
</body>

</html>