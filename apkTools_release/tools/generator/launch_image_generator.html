<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>å¯åŠ¨å›¾ç”Ÿæˆå·¥å…· - iOS & Android</title>
  <link rel="stylesheet" href="../../assets/css/theme.css">
  <style>
    /* ç»§æ‰¿theme.cssçš„åŸºç¡€æ ·å¼ */
    /* ä»¥ä¸‹æ˜¯å·¥å…·é¡µé¢ç‰¹å®šçš„æ ·å¼è¦†ç›– */

    .container {
      max-width: 1200px;
    }

    .home-btn {
      position: absolute;
      top: var(--spacing-lg);
      left: var(--spacing-lg);
      width: 40px;
      height: 40px;
      background: rgba(255, 255, 255, 0.2);
      border: 2px solid rgba(255, 255, 255, 0.3);
      border-radius: var(--radius-full);
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--color-text-on-primary);
      text-decoration: none;
      font-size: var(--font-size-large);
      transition: all .3s;
      z-index: 10;
    }

    .home-btn:hover {
      background: rgba(255, 255, 255, 0.3);
      border-color: rgba(255, 255, 255, 0.5);
      transform: scale(1.1);
    }

    .header h1 {
      font-size: var(--font-size-xlarge);
      margin-bottom: var(--spacing-sm);
    }

    .header p {
      opacity: 0.9;
      font-size: var(--font-size-small);
    }

    .content {
      padding: var(--spacing-xl);
    }

    .form-section {
      background: var(--color-background-alt);
      border-radius: var(--radius-md);
      padding: var(--spacing-lg);
      margin-bottom: var(--spacing-lg);
    }

    .form-section h2 {
      font-size: var(--font-size-large);
      color: var(--color-text);
      margin-bottom: var(--spacing-lg);
      border-bottom: 2px solid var(--color-primary);
      padding-bottom: var(--spacing-sm);
    }

    .form-group {
      margin-bottom: var(--spacing-lg);
    }

    .form-group label {
      display: block;
      font-weight: var(--font-weight-semibold);
      color: var(--color-text);
      margin-bottom: var(--spacing-sm);
      font-size: var(--font-size-small);
    }

    .form-group input,
    .form-group select {
      width: 100%;
      padding: var(--spacing-sm);
      border: 2px solid var(--color-border);
      border-radius: var(--radius-sm);
      font-size: var(--font-size-small);
      transition: border-color 0.3s;
      background: var(--color-surface);
      color: var(--color-text);
    }

    .form-group input:focus,
    .form-group select:focus {
      outline: none;
      border-color: var(--color-primary);
      box-shadow: 0 0 0 4px var(--color-shadow-primary);
    }

    .form-group small {
      display: block;
      color: var(--color-text-secondary);
      margin-top: var(--spacing-xs);
      font-size: var(--font-size-small);
    }

    .file-upload-area {
      border: 3px dashed var(--color-primary);
      border-radius: var(--radius-md);
      padding: var(--spacing-xxl);
      text-align: center;
      background: var(--color-hover);
      cursor: pointer;
      transition: all 0.3s;
    }

    .file-upload-area:hover {
      background: var(--color-surface-alt);
      border-color: var(--color-primary-dark);
    }

    .file-upload-area.dragover {
      background: var(--color-hover);
      border-color: var(--color-primary);
    }

    .file-upload-area input[type="file"] {
      display: none;
    }

    .file-upload-icon {
      font-size: 48px;
      color: #667eea;
      margin-bottom: 15px;
    }

    .file-upload-text {
      color: #495057;
      font-size: var(--font-size-base);
      margin-bottom: 10px;
    }

    .file-upload-hint {
      color: var(--color-text-secondary);
      font-size: var(--font-size-small);
    }

    .preview-section {
      margin-top: var(--spacing-lg);
    }

    .preview-image {
      max-width: 100%;
      max-height: 400px;
      border-radius: var(--radius-sm);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      margin-bottom: 15px;
      display: block;
    }

    .image-preview-container {
      position: relative;
      display: inline-block;
      width: 100%;
    }

    .image-preview-container .delete-btn {
      position: absolute;
      top: 10px;
      right: 10px;
      background: rgba(220, 53, 69, 0.9);
      color: var(--color-text-on-primary);
      border: none;
      border-radius: 50%;
      width: 36px;
      height: 36px;
      font-size: var(--font-size-large);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.3s;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
    }

    .image-preview-container .delete-btn:hover {
      background: rgba(220, 53, 69, 1);
      transform: scale(1.1);
    }

    .platform-tabs {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
    }

    .platform-tab {
      flex: 1;
      padding: 12px;
      border: 2px solid #dee2e6;
      border-radius: var(--radius-sm);
      background: var(--color-surface);
      cursor: pointer;
      text-align: center;
      font-weight: 600;
      color: #495057;
      transition: all 0.3s;
    }

    .platform-tab.active {
      background: #667eea;
      color: var(--color-text-on-primary);
      border-color: #667eea;
    }

    .platform-tab:hover {
      border-color: #667eea;
    }

    .sizes-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: 15px;
      margin-top: 20px;
    }

    .size-item {
      background: var(--color-surface);
      border: 2px solid #dee2e6;
      border-radius: var(--radius-sm);
      padding: var(--spacing-md);
      text-align: center;
      transition: all 0.3s;
    }

    .size-item:hover {
      border-color: #667eea;
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.2);
    }

    .size-item.selected {
      border-color: #667eea;
      background: #f8f9ff;
    }

    .size-label {
      font-weight: 600;
      color: #495057;
      margin-bottom: 5px;
    }

    .size-dimensions {
      font-size: var(--font-size-small);
      color: var(--color-text-secondary);
      margin-bottom: 10px;
    }

    .size-radio {
      width: 20px;
      height: 20px;
      cursor: pointer;
    }

    .btn {
      padding: 12px 24px;
      border: none;
      border-radius: var(--radius-sm);
      font-size: var(--font-size-base);
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
      display: inline-block;
    }

    .btn-primary {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: var(--color-text-on-primary);
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
    }

    .btn-primary:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none;
    }

    .btn-secondary {
      background: #6c757d;
      color: var(--color-text-on-primary);
    }

    .btn-secondary:hover {
      background: #5a6268;
    }

    .btn-group {
      display: flex;
      gap: 10px;
      margin-top: 20px;
    }

    .color-picker-group {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .color-picker {
      width: 60px;
      height: 40px;
      border: 2px solid #dee2e6;
      border-radius: var(--radius-sm);
      cursor: pointer;
    }

    .color-picker input {
      width: 100%;
      height: 100%;
      border: none;
      border-radius: 6px;
      cursor: pointer;
    }

    .status-message {
      padding: 12px;
      border-radius: var(--radius-sm);
      margin-top: 15px;
      display: none;
    }

    .status-message.success {
      background: #d4edda;
      color: #155724;
      border: 1px solid #c3e6cb;
      display: block;
    }

    .status-message.error {
      background: #f8d7da;
      color: #721c24;
      border: 1px solid #f5c6cb;
      display: block;
    }

    .status-message.info {
      background: #d1ecf1;
      color: #0c5460;
      border: 1px solid #bee5eb;
      display: block;
    }

    .loading {
      display: none;
      text-align: center;
      padding: 20px;
    }

    .loading.active {
      display: block;
    }

    .spinner {
      border: 4px solid #f3f3f3;
      border-top: 4px solid #667eea;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      animation: spin 1s linear infinite;
      margin: 0 auto 10px;
    }

    @keyframes spin {
      0% {
        transform: rotate(0deg);
      }

      100% {
        transform: rotate(360deg);
      }
    }

    .preview-container {
      display: flex;
      gap: 20px;
      flex-wrap: wrap;
      margin-top: 20px;
    }

    .preview-item {
      text-align: center;
    }

    .preview-item canvas {
      border: none;
      border-radius: 0;
      max-width: 300px;
      max-height: 600px;
      width: auto !important;
      height: auto !important;
      display: block;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
      image-rendering: -webkit-optimize-contrast;
      image-rendering: crisp-edges;
    }

    .preview-item-label {
      margin-top: 8px;
      font-size: var(--font-size-small);
      color: var(--color-text-secondary);
    }

    .preview-item canvas {
      cursor: pointer;
      transition: transform 0.2s;
    }

    .preview-item canvas:hover {
      transform: scale(1.05);
    }

    /* å…¨å±é¢„è§ˆæ¨¡æ€æ¡† */
    .fullscreen-modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.95);
      z-index: 10000;
      cursor: pointer;
    }

    .fullscreen-modal.active {
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .fullscreen-modal img,
    .fullscreen-modal canvas {
      max-width: 90vw;
      max-height: 90vh;
      width: auto;
      height: auto;
      object-fit: contain;
      border-radius: 0;
      image-rendering: -webkit-optimize-contrast;
      image-rendering: crisp-edges;
      box-shadow: 0 8px 40px rgba(0, 0, 0, 0.5);
    }

    .fullscreen-modal .close-btn {
      position: absolute;
      top: 20px;
      right: 20px;
      background: rgba(255, 255, 255, 0.2);
      color: var(--color-text-on-primary);
      border: 2px solid white;
      border-radius: 50%;
      width: 50px;
      height: 50px;
      font-size: 24px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.3s;
    }

    .fullscreen-modal .close-btn:hover {
      background: rgba(255, 255, 255, 0.3);
      transform: rotate(90deg);
    }
  </style>
</head>

<body>
  <div class="container">
    <div class="header">
      <a href="../../index.html" class="home-btn" title="è¿”å›é¦–é¡µ">ğŸ </a>
      <h1>ğŸš€ å¯åŠ¨å›¾ç”Ÿæˆå·¥å…·</h1>
      <p>ä¸€é”®ç”Ÿæˆ iOS å’Œ Android å„æœºå‹å¯åŠ¨å›¾ï¼Œæ”¯æŒå›¾ç‰‡å±…ä¸­ã€ä¸å˜å½¢ã€èƒŒæ™¯å¡«å……</p>
    </div>

    <div class="content">
      <!-- å›¾ç‰‡ä¸Šä¼ åŒºåŸŸ -->
      <div class="form-section">
        <h2>ğŸ“¸ ä¸Šä¼ å›¾ç‰‡</h2>
        <div class="file-upload-area" id="uploadArea">
          <div class="file-upload-icon">ğŸ“</div>
          <div class="file-upload-text">ç‚¹å‡»æˆ–æ‹–æ‹½å›¾ç‰‡åˆ°æ­¤å¤„</div>
          <div class="file-upload-hint">æ”¯æŒ JPGã€PNGã€WEBP æ ¼å¼</div>
          <input type="file" id="imageInput" accept="image/*">
        </div>
        <div id="imagePreview" style="display: none;">
          <div class="image-preview-container">
            <img id="previewImage" class="preview-image" alt="é¢„è§ˆ">
            <button class="delete-btn" id="deleteImageBtn" title="åˆ é™¤å›¾ç‰‡">Ã—</button>
          </div>
        </div>
      </div>

      <!-- å¹³å°é€‰æ‹© -->
      <div class="form-section">
        <h2>ğŸ“± é€‰æ‹©å¹³å°</h2>
        <div class="platform-tabs">
          <div class="platform-tab active" data-platform="ios">iOS</div>
          <div class="platform-tab" data-platform="android">Android</div>
        </div>
      </div>

      <!-- èƒŒæ™¯è®¾ç½® -->
      <div class="form-section">
        <h2>ğŸ¨ å¡«å……è¯´æ˜</h2>
        <div class="form-group">
          <small style="color: var(--color-text-secondary);">å·¥å…·ä¼šè‡ªåŠ¨æ£€æµ‹å›¾ç‰‡è¾¹ç¼˜çš„ä¸»è¦é¢œè‰²ï¼Œå¹¶ä½¿ç”¨è¯¥é¢œè‰²å¡«å……ç©ºç™½åŒºåŸŸï¼Œç¡®ä¿å›¾ç‰‡å†…å®¹å±…ä¸­ä¸”ä¸å˜å½¢ã€‚</small>
        </div>
      </div>

      <!-- å°ºå¯¸é€‰æ‹© -->
      <div class="form-section">
        <h2>ğŸ“ é€‰æ‹©å°ºå¯¸ï¼ˆå•é€‰ï¼‰</h2>
        <div id="sizesContainer"></div>
      </div>

      <!-- è¾“å‡ºæ ¼å¼ -->
      <div class="form-section" id="outputFormatSection" style="display: none;">
        <h2>ğŸ§© è¾“å‡ºæ ¼å¼ï¼ˆAndroidï¼‰</h2>
        <div class="form-group">
          <label>
            <input type="radio" name="output-format" id="outputFormatPng" class="size-radio" value="png">
            æ™®é€š PNG
          </label>
          <label style="margin-left: 20px;">
            <input type="radio" name="output-format" id="outputFormatNine" class="size-radio" value="nine">
            .9.pngï¼ˆNineâ€‘Patchï¼‰
          </label>
        </div>
      </div>

      <!-- æ“ä½œæŒ‰é’® -->
      <div class="form-section">
        <button class="btn btn-primary" id="generateBtn" disabled>ç”Ÿæˆå¯åŠ¨å›¾</button>
        <button class="btn btn-secondary" id="downloadBtn" disabled style="margin-left: 10px;">ä¸‹è½½å›¾ç‰‡</button>
      </div>

      <!-- çŠ¶æ€æ¶ˆæ¯ -->
      <div class="status-message" id="statusMessage"></div>

      <!-- åŠ è½½åŠ¨ç”» -->
      <div class="loading" id="loading">
        <div class="spinner"></div>
        <div>æ­£åœ¨ç”Ÿæˆå¯åŠ¨å›¾...</div>
      </div>

      <!-- é¢„è§ˆåŒºåŸŸ -->
      <div class="form-section" id="previewSection" style="display: none;">
        <h2>ğŸ‘€ é¢„è§ˆï¼ˆç‚¹å‡»å›¾ç‰‡å¯å…¨å±æŸ¥çœ‹ï¼‰</h2>
        <div class="preview-container" id="previewContainer"></div>
      </div>
    </div>
  </div>

  <!-- å…¨å±é¢„è§ˆæ¨¡æ€æ¡† -->
  <div class="fullscreen-modal" id="fullscreenModal">
    <button class="close-btn" id="closeFullscreenBtn">Ã—</button>
    <div id="fullscreenContent"></div>
  </div>

  <script>
    // å¹³å°å°ºå¯¸é…ç½®
    const platformSizes = {
      ios: [
        { name: 'iPhone 14 Pro Max', width: 1290, height: 2796, scale: 3 },
        { name: 'iPhone 14 Pro', width: 1179, height: 2556, scale: 3 },
        { name: 'iPhone 14 Plus', width: 1284, height: 2778, scale: 3 },
        { name: 'iPhone 14', width: 1170, height: 2532, scale: 3 },
        { name: 'iPhone 13 Pro Max', width: 1284, height: 2778, scale: 3 },
        { name: 'iPhone 13 Pro', width: 1170, height: 2532, scale: 3 },
        { name: 'iPhone 13', width: 1170, height: 2532, scale: 3 },
        { name: 'iPhone 13 mini', width: 1080, height: 2340, scale: 3 },
        { name: 'iPhone 12 Pro Max', width: 1284, height: 2778, scale: 3 },
        { name: 'iPhone 12 Pro', width: 1170, height: 2532, scale: 3 },
        { name: 'iPhone 12', width: 1170, height: 2532, scale: 3 },
        { name: 'iPhone 12 mini', width: 1080, height: 2340, scale: 3 },
        { name: 'iPhone 11 Pro Max', width: 1242, height: 2688, scale: 3 },
        { name: 'iPhone 11 Pro', width: 1125, height: 2436, scale: 3 },
        { name: 'iPhone 11', width: 828, height: 1792, scale: 2 },
        { name: 'iPhone XS Max', width: 1242, height: 2688, scale: 3 },
        { name: 'iPhone XS', width: 1125, height: 2436, scale: 3 },
        { name: 'iPhone XR', width: 828, height: 1792, scale: 2 },
        { name: 'iPhone X', width: 1125, height: 2436, scale: 3 },
        { name: 'iPhone 8 Plus', width: 1242, height: 2208, scale: 3 },
        { name: 'iPhone 8', width: 750, height: 1334, scale: 2 },
        { name: 'iPad Pro 12.9"', width: 2048, height: 2732, scale: 2 },
        { name: 'iPad Pro 11"', width: 1668, height: 2388, scale: 2 },
        { name: 'iPad Air', width: 1640, height: 2360, scale: 2 },
        { name: 'iPad', width: 1620, height: 2160, scale: 2 },
        { name: 'iPad mini', width: 1536, height: 2048, scale: 2 }
      ],
      android: [
        { name: 'Android æ‰‹æœºç«–å± (480x762)', width: 480, height: 762 },
        { name: 'Android æ‰‹æœºç«–å± (720x1242)', width: 720, height: 1242 },
        { name: 'Android æ‰‹æœºç«–å± (1080x1882)', width: 1080, height: 1882 },
        { name: 'Android æ‰‹æœºç«–å± (1080x1920)', width: 1080, height: 1920 },
        { name: 'Android æ‰‹æœºæ¨ªå± (1920x1080)', width: 1920, height: 1080 },
        { name: 'Android å¹³æ¿ç«–å± (1200x1920)', width: 1200, height: 1920 },
        { name: 'Android å¹³æ¿æ¨ªå± (1920x1200)', width: 1920, height: 1200 }
      ]
    };

    let currentPlatform = 'ios';
    let originalImage = null;
    let selectedSize = null;
    let generatedImage = null;

    // DOM å…ƒç´ 
    const uploadArea = document.getElementById('uploadArea');
    const imageInput = document.getElementById('imageInput');
    const imagePreview = document.getElementById('imagePreview');
    const previewImage = document.getElementById('previewImage');
    const sizesContainer = document.getElementById('sizesContainer');
    const platformTabs = document.querySelectorAll('.platform-tab');
    const generateBtn = document.getElementById('generateBtn');
    const downloadBtn = document.getElementById('downloadBtn');
    const statusMessage = document.getElementById('statusMessage');
    const loading = document.getElementById('loading');
    const previewSection = document.getElementById('previewSection');
    const previewContainer = document.getElementById('previewContainer');
    const deleteImageBtn = document.getElementById('deleteImageBtn');
    const fullscreenModal = document.getElementById('fullscreenModal');
    const fullscreenContent = document.getElementById('fullscreenContent');
    const closeFullscreenBtn = document.getElementById('closeFullscreenBtn');
    const outputFormatSection = document.getElementById('outputFormatSection');
    const outputFormatPng = document.getElementById('outputFormatPng');
    const outputFormatNine = document.getElementById('outputFormatNine');
    let outputFormat = 'png';

    // åˆå§‹åŒ–
    function init() {
      renderSizes();
      setupEventListeners();
      updateOutputFormatVisibility();
    }

    // è®¾ç½®äº‹ä»¶ç›‘å¬
    function setupEventListeners() {
      // æ–‡ä»¶ä¸Šä¼ 
      uploadArea.addEventListener('click', () => imageInput.click());
      uploadArea.addEventListener('dragover', handleDragOver);
      uploadArea.addEventListener('dragleave', handleDragLeave);
      uploadArea.addEventListener('drop', handleDrop);
      imageInput.addEventListener('change', handleFileSelect);

      // å¹³å°åˆ‡æ¢
      platformTabs.forEach(tab => {
        tab.addEventListener('click', () => {
          platformTabs.forEach(t => t.classList.remove('active'));
          tab.classList.add('active');
          currentPlatform = tab.dataset.platform;
          renderSizes();
          outputFormat = currentPlatform === 'android' ? 'nine' : 'png';
          if (outputFormatPng && outputFormatNine) {
            outputFormatPng.checked = outputFormat === 'png';
            outputFormatNine.checked = outputFormat === 'nine';
          }
          updateOutputFormatVisibility();
          selectedSize = null;
          generatedImage = null;
          previewSection.style.display = 'none';
          previewContainer.innerHTML = '';
          downloadBtn.disabled = true;
          updateGenerateButton();
        });
      });

      // ç”ŸæˆæŒ‰é’®
      generateBtn.addEventListener('click', generateImage);
      downloadBtn.addEventListener('click', downloadImage);

      if (outputFormatPng && outputFormatNine) {
        outputFormatPng.addEventListener('change', () => {
          if (outputFormatPng.checked) outputFormat = 'png';
        });
        outputFormatNine.addEventListener('change', () => {
          if (outputFormatNine.checked) outputFormat = 'nine';
        });
      }

      // åˆ é™¤å›¾ç‰‡
      deleteImageBtn.addEventListener('click', (e) => {
        e.stopPropagation();
        resetImage();
      });

      // å…¨å±é¢„è§ˆ
      fullscreenModal.addEventListener('click', (e) => {
        if (e.target === fullscreenModal || e.target === closeFullscreenBtn) {
          closeFullscreen();
        }
      });

      // ESC é”®å…³é—­å…¨å±
      document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape' && fullscreenModal.classList.contains('active')) {
          closeFullscreen();
        }
      });
    }

    function updateOutputFormatVisibility() {
      if (!outputFormatSection) return;
      outputFormatSection.style.display = currentPlatform === 'android' ? 'block' : 'none';
      if (currentPlatform === 'android') {
        outputFormat = outputFormat || 'nine';
        outputFormatPng.checked = outputFormat === 'png';
        outputFormatNine.checked = outputFormat === 'nine';
      }
    }

    // æ‹–æ‹½å¤„ç†
    function handleDragOver(e) {
      e.preventDefault();
      uploadArea.classList.add('dragover');
    }

    function handleDragLeave(e) {
      e.preventDefault();
      uploadArea.classList.remove('dragover');
    }

    function handleDrop(e) {
      e.preventDefault();
      uploadArea.classList.remove('dragover');
      const files = e.dataTransfer.files;
      if (files.length > 0) {
        handleFile(files[0]);
      }
    }

    function handleFileSelect(e) {
      const file = e.target.files[0];
      if (file) {
        handleFile(file);
      }
    }

    function handleFile(file) {
      if (!file.type.startsWith('image/')) {
        showStatus('è¯·é€‰æ‹©å›¾ç‰‡æ–‡ä»¶', 'error');
        return;
      }

      const reader = new FileReader();
      reader.onload = (e) => {
        const img = new Image();
        img.onload = () => {
          originalImage = img;
          previewImage.src = e.target.result;
          // éšè—ä¸Šä¼ åŒºåŸŸï¼Œæ˜¾ç¤ºé¢„è§ˆ
          uploadArea.style.display = 'none';
          imagePreview.style.display = 'block';
          showStatus('å›¾ç‰‡åŠ è½½æˆåŠŸ', 'success');
          updateGenerateButton();
        };
        img.src = e.target.result;
      };
      reader.readAsDataURL(file);
    }

    function resetImage() {
      originalImage = null;
      previewImage.src = '';
      uploadArea.style.display = 'block';
      imagePreview.style.display = 'none';
      imageInput.value = '';
      selectedSize = null;
      generatedImage = null;
      previewSection.style.display = 'none';
      previewContainer.innerHTML = '';
      downloadBtn.disabled = true;
      // æ¸…é™¤æ‰€æœ‰radioé€‰ä¸­çŠ¶æ€
      const radios = document.querySelectorAll('.size-radio');
      radios.forEach(radio => radio.checked = false);
      updateGenerateButton();
      showStatus('å·²æ¸…é™¤å›¾ç‰‡', 'info');
    }

    // æ¸²æŸ“å°ºå¯¸åˆ—è¡¨
    function renderSizes() {
      const sizes = platformSizes[currentPlatform];
      sizesContainer.innerHTML = '<div class="sizes-grid"></div>';
      const grid = sizesContainer.querySelector('.sizes-grid');

      sizes.forEach((size, index) => {
        const sizeKey = `${size.width}x${size.height}`;
        const item = document.createElement('div');
        item.className = 'size-item';
        const radioId = `size-radio-${currentPlatform}-${index}`;
        item.innerHTML = `
                    <div class="size-label">${size.name}</div>
                    <div class="size-dimensions">${size.width} Ã— ${size.height}</div>
                    <input type="radio" class="size-radio" name="size-radio" id="${radioId}" data-index="${index}" data-key="${sizeKey}">
                    <label for="${radioId}" style="cursor: pointer; margin-left: 5px;">é€‰æ‹©</label>
                `;
        grid.appendChild(item);

        const radio = item.querySelector('.size-radio');
        radio.addEventListener('change', (e) => {
          if (e.target.checked) {
            selectedSize = sizeKey;
            updateGenerateButton();
          }
        });
      });
    }

    // æ›´æ–°ç”ŸæˆæŒ‰é’®çŠ¶æ€
    function updateGenerateButton() {
      const hasImage = originalImage !== null;
      const hasSelection = selectedSize !== null;
      generateBtn.disabled = !(hasImage && hasSelection);
    }

    // ç”Ÿæˆå›¾ç‰‡ï¼ˆå•é€‰ï¼Œä¸€æ¬¡åªç”Ÿæˆä¸€å¼ ï¼‰
    async function generateImage() {
      if (!originalImage || !selectedSize) {
        showStatus('è¯·å…ˆä¸Šä¼ å›¾ç‰‡å¹¶é€‰æ‹©å°ºå¯¸', 'error');
        return;
      }

      loading.classList.add('active');
      generateBtn.disabled = true;
      previewContainer.innerHTML = '';

      const sizes = platformSizes[currentPlatform];
      const size = sizes.find(s => `${s.width}x${s.height}` === selectedSize);

      if (!size) {
        showStatus('é€‰æ‹©çš„å°ºå¯¸æ— æ•ˆ', 'error');
        loading.classList.remove('active');
        generateBtn.disabled = false;
        return;
      }

      try {
        const { canvas, contentRect } = await generateLaunchImage(
          originalImage,
          size.width,
          size.height
        );

        // éªŒè¯ç”Ÿæˆçš„å›¾ç‰‡å°ºå¯¸ï¼ˆå¿…é¡»å®Œå…¨åŒ¹é…ï¼‰
        if (canvas.width !== size.width || canvas.height !== size.height) {
          console.error(`å°ºå¯¸ä¸åŒ¹é…: æœŸæœ› ${size.width}x${size.height}, å®é™… ${canvas.width}x${canvas.height}`);
          throw new Error(`å›¾ç‰‡å°ºå¯¸ä¸åŒ¹é…: æœŸæœ› ${size.width}x${size.height}, å®é™… ${canvas.width}x${canvas.height}`);
        }

        generatedImage = {
          canvas,
          name: size.name,
          width: size.width,
          height: size.height,
          contentRect
        };

        // æ·»åŠ é¢„è§ˆï¼ˆä½¿ç”¨æ‰‹æœºæ¨¡å‹æ¡†æ¶ï¼‰
        const previewItem = document.createElement('div');
        previewItem.className = 'preview-item';

        // åˆ›å»ºæ‰‹æœºæ¨¡å‹é¢„è§ˆ
        const previewCanvas = createPhonePreview(canvas, size, 300);

        // æ·»åŠ ç‚¹å‡»å…¨å±é¢„è§ˆ
        previewCanvas.addEventListener('click', () => {
          showFullscreen(canvas, size);
        });

        previewItem.appendChild(previewCanvas);
        const label = document.createElement('div');
        label.className = 'preview-item-label';
        label.textContent = `${size.name} (${size.width}Ã—${size.height})`;
        previewItem.appendChild(label);
        previewContainer.appendChild(previewItem);

        previewSection.style.display = 'block';
        downloadBtn.disabled = false;
        showStatus(`æˆåŠŸç”Ÿæˆå¯åŠ¨å›¾: ${size.name}`, 'success');
      } catch (error) {
        console.error('ç”Ÿæˆå¤±è´¥:', error);
        showStatus('ç”Ÿæˆå¤±è´¥: ' + error.message, 'error');
      } finally {
        loading.classList.remove('active');
        generateBtn.disabled = false;
      }
    }

    // ç”Ÿæˆå¯åŠ¨å›¾æ ¸å¿ƒå‡½æ•°
    // è¦æ±‚ï¼šä¸­é—´å†…å®¹ä¸å˜å½¢ã€ä¸æ‹‰ä¼¸ï¼Œé€šè¿‡è¾¹ç¼˜å¡«å……çº¯è‰²ï¼ˆç±»ä¼¼æ°”æ³¡çš„ä¸å˜å½¢æ‹‰ä¼¸æ•ˆæœï¼‰
    function generateLaunchImage(image, targetWidth, targetHeight) {
      return new Promise((resolve) => {
        // ç¡®ä¿ç›®æ ‡å°ºå¯¸æ˜¯æ•´æ•°
        const finalWidth = Math.floor(targetWidth);
        const finalHeight = Math.floor(targetHeight);

        const canvas = document.createElement('canvas');
        canvas.width = finalWidth;
        canvas.height = finalHeight;
        const ctx = canvas.getContext('2d');

        // è·å–åŸå§‹å›¾ç‰‡å°ºå¯¸
        const originalWidth = image.naturalWidth || image.width;
        const originalHeight = image.naturalHeight || image.height;

        // è®¡ç®—åŸå§‹å›¾ç‰‡çš„å®½é«˜æ¯”
        const originalAspect = originalWidth / originalHeight;

        // è®¡ç®—å®½åº¦å’Œé«˜åº¦çš„ç¼©æ”¾æ¯”ä¾‹
        const widthScale = finalWidth / originalWidth;
        const heightScale = finalHeight / originalHeight;

        // ä½¿ç”¨è¾ƒå°çš„ç¼©æ”¾æ¯”ä¾‹ï¼Œç¡®ä¿å›¾ç‰‡å®Œå…¨åœ¨ç›®æ ‡å°ºå¯¸å†…ï¼ˆcontain æ¨¡å¼ï¼‰
        // è¿™æ ·æ— è®ºåŸå›¾å¤§å°ï¼Œéƒ½ä¸ä¼šè¶…å‡ºç›®æ ‡å°ºå¯¸ï¼Œä¹Ÿä¸ä¼šå˜å½¢
        const scale = Math.min(widthScale, heightScale);

        // è®¡ç®—ç¼©æ”¾åçš„å°ºå¯¸ï¼ˆä¿æŒåŸå›¾æ¯”ä¾‹ï¼‰
        const scaledWidth = originalWidth * scale;
        const scaledHeight = originalHeight * scale;

        // éªŒè¯ï¼šç¡®ä¿ç¼©æ”¾åçš„å°ºå¯¸ä¸è¶…è¿‡ç›®æ ‡å°ºå¯¸
        if (scaledWidth > finalWidth || scaledHeight > finalHeight) {
          console.error('ç¼©æ”¾è®¡ç®—é”™è¯¯:', {
            original: `${originalWidth}x${originalHeight}`,
            target: `${finalWidth}x${finalHeight}`,
            scaled: `${scaledWidth}x${scaledHeight}`,
            scale: scale
          });
        }

        // è®¡ç®—å±…ä¸­ä½ç½®
        const drawX = (finalWidth - scaledWidth) / 2;
        const drawY = (finalHeight - scaledHeight) / 2;

        // å…ˆä»åŸå§‹å›¾ç‰‡æ£€æµ‹è¾¹ç¼˜é¢œè‰²ï¼ˆåœ¨ç¼©æ”¾å‰æ£€æµ‹ï¼Œç¡®ä¿å‡†ç¡®æ€§ï¼‰
        const edgeColor = detectEdgeColorFromOriginalImage(image);

        // å¡«å……èƒŒæ™¯è‰²ï¼ˆä½¿ç”¨æ£€æµ‹åˆ°çš„è¾¹ç¼˜é¢œè‰²ï¼‰
        ctx.fillStyle = `rgb(${edgeColor.r}, ${edgeColor.g}, ${edgeColor.b})`;
        ctx.fillRect(0, 0, finalWidth, finalHeight);

        // ä½¿ç”¨é«˜è´¨é‡å›¾åƒæ¸²æŸ“
        ctx.imageSmoothingEnabled = true;
        ctx.imageSmoothingQuality = 'high';

        // ç»˜åˆ¶åŸå›¾ï¼ˆå±…ä¸­ï¼Œä¸å˜å½¢ï¼Œä¸æ‹‰ä¼¸ï¼‰
        // ä½¿ç”¨ç²¾ç¡®çš„å°ºå¯¸å’Œä½ç½®ï¼Œç¡®ä¿ä¸å˜å½¢
        ctx.drawImage(
          image,
          0, 0, originalWidth, originalHeight,
          drawX, drawY, scaledWidth, scaledHeight
        );

        const contentRect = {
          x: Math.round(drawX),
          y: Math.round(drawY),
          width: Math.round(scaledWidth),
          height: Math.round(scaledHeight)
        };

        resolve({ canvas, contentRect });
      });
    }

    // ä»åŸå§‹å›¾ç‰‡æ£€æµ‹è¾¹ç¼˜çš„ä¸»è¦é¢œè‰²ï¼ˆçº¯è‰²ï¼‰
    // ç±»ä¼¼æ°”æ³¡æ•ˆæœï¼šæ£€æµ‹å›¾ç‰‡è¾¹ç¼˜åƒç´ ï¼Œè®¡ç®—å¹³å‡é¢œè‰²ç”¨äºå¡«å……
    function detectEdgeColorFromOriginalImage(image) {
      // åˆ›å»ºä¸€ä¸ªä¸´æ—¶canvasæ¥è¯»å–åŸå§‹å›¾ç‰‡çš„åƒç´ æ•°æ®
      const tempCanvas = document.createElement('canvas');
      tempCanvas.width = image.width;
      tempCanvas.height = image.height;
      const tempCtx = tempCanvas.getContext('2d');
      tempCtx.drawImage(image, 0, 0);

      const imageData = tempCtx.getImageData(0, 0, image.width, image.height);
      const data = imageData.data;

      let rSum = 0, gSum = 0, bSum = 0, count = 0;
      const edgeWidth = Math.max(1, Math.floor(Math.min(image.width, image.height) * 0.05)); // è¾¹ç¼˜å®½åº¦ä¸ºå›¾ç‰‡å°ºå¯¸çš„5%

      // é‡‡æ ·å·¦è¾¹ç¼˜
      for (let x = 0; x < edgeWidth && x < image.width; x++) {
        for (let y = 0; y < image.height; y++) {
          const index = (y * image.width + x) * 4;
          if (data[index + 3] > 0) { // éé€æ˜åƒç´ 
            rSum += data[index];
            gSum += data[index + 1];
            bSum += data[index + 2];
            count++;
          }
        }
      }

      // é‡‡æ ·å³è¾¹ç¼˜
      for (let x = Math.max(0, image.width - edgeWidth); x < image.width; x++) {
        for (let y = 0; y < image.height; y++) {
          const index = (y * image.width + x) * 4;
          if (data[index + 3] > 0) {
            rSum += data[index];
            gSum += data[index + 1];
            bSum += data[index + 2];
            count++;
          }
        }
      }

      // é‡‡æ ·é¡¶éƒ¨è¾¹ç¼˜ï¼ˆé¿å…ä¸å·¦å³è¾¹ç¼˜é‡å¤è®¡ç®—ï¼‰
      for (let y = 0; y < edgeWidth && y < image.height; y++) {
        for (let x = edgeWidth; x < image.width - edgeWidth; x++) {
          const index = (y * image.width + x) * 4;
          if (data[index + 3] > 0) {
            rSum += data[index];
            gSum += data[index + 1];
            bSum += data[index + 2];
            count++;
          }
        }
      }

      // é‡‡æ ·åº•éƒ¨è¾¹ç¼˜ï¼ˆé¿å…ä¸å·¦å³è¾¹ç¼˜é‡å¤è®¡ç®—ï¼‰
      for (let y = Math.max(0, image.height - edgeWidth); y < image.height; y++) {
        for (let x = edgeWidth; x < image.width - edgeWidth; x++) {
          const index = (y * image.width + x) * 4;
          if (data[index + 3] > 0) {
            rSum += data[index];
            gSum += data[index + 1];
            bSum += data[index + 2];
            count++;
          }
        }
      }

      // è®¡ç®—å¹³å‡é¢œè‰²
      if (count > 0) {
        return {
          r: Math.round(rSum / count),
          g: Math.round(gSum / count),
          b: Math.round(bSum / count)
        };
      }

      // å¦‚æœæ²¡æœ‰æ£€æµ‹åˆ°è¾¹ç¼˜é¢œè‰²ï¼Œè¿”å›ç™½è‰²
      return { r: 255, g: 255, b: 255 };
    }

    // ç”Ÿæˆ Android Nine-Patch (.9.png)
    function createNinePatchFromCanvas(imageCanvas, contentRect) {
      const w = imageCanvas.width;
      const h = imageCanvas.height;
      const nineCanvas = document.createElement('canvas');
      nineCanvas.width = w + 2;
      nineCanvas.height = h + 2;
      const ctx = nineCanvas.getContext('2d');

      ctx.imageSmoothingEnabled = true;
      ctx.imageSmoothingQuality = 'high';

      ctx.clearRect(0, 0, nineCanvas.width, nineCanvas.height);
      ctx.drawImage(imageCanvas, 1, 1);

      ctx.fillStyle = '#000';
      // åªæ ‡æ³¨è¾¹è·ä¸ºå¯æ‹‰ä¼¸åŒºåŸŸï¼Œé¿å…ä¸­å¿ƒå†…å®¹è¢«æ‹‰ä¼¸
      // æ·»åŠ 2åƒç´ çš„å®‰å…¨ç¼“å†²è·ç¦»ï¼Œé˜²æ­¢æ‹‰ä¼¸åˆ°æŠ—é”¯é½¿è¾¹ç¼˜
      const buffer = 2;

      const cx = Math.max(0, Math.min(w, Math.round(contentRect.x)));
      const cy = Math.max(0, Math.min(h, Math.round(contentRect.y)));
      const cw = Math.max(0, Math.min(w - cx, Math.round(contentRect.width)));
      const ch = Math.max(0, Math.min(h - cy, Math.round(contentRect.height)));

      const leftMargin = cx;
      const rightMargin = Math.max(0, w - (cx + cw));
      const topMargin = cy;
      const bottomMargin = Math.max(0, h - (cy + ch));

      // é¡¶éƒ¨ï¼ˆX æ–¹å‘å¯æ‹‰ä¼¸ï¼‰ï¼šå·¦è¾¹è·ä¸å³è¾¹è·ï¼ˆé¿å¼€Bufferï¼‰
      // å·¦ä¾§ stretchï¼šä» 0 åˆ° leftMargin - buffer
      if (leftMargin > buffer) {
        ctx.fillRect(1, 0, leftMargin - buffer, 1);
      } else if (leftMargin > 0) {
        ctx.fillRect(1, 0, leftMargin, 1);
      }

      // å³ä¾§ stretchï¼šä» cx + cw + buffer åˆ° w
      if (rightMargin > buffer) {
        ctx.fillRect(1 + cx + cw + buffer, 0, rightMargin - buffer, 1);
      } else if (rightMargin > 0) {
        ctx.fillRect(1 + cx + cw, 0, rightMargin, 1);
      }

      // å…œåº•ï¼šå¦‚æœæ²¡ç”»ä»»ä½•æ‹‰ä¼¸ç‚¹ï¼Œå°±åœ¨å·¦ä¸Šè§’ç”»ä¸€ä¸ªç‚¹
      if (leftMargin <= buffer && rightMargin <= buffer) {
        ctx.fillRect(1, 0, 1, 1);
      }

      // å·¦ä¾§ï¼ˆY æ–¹å‘å¯æ‹‰ä¼¸ï¼‰ï¼šä¸Šè¾¹è·ä¸ä¸‹è¾¹è·ï¼ˆé¿å¼€Bufferï¼‰
      // ä¸Šä¾§ stretch
      if (topMargin > buffer) {
        ctx.fillRect(0, 1, topMargin - buffer, 1);
      } else if (topMargin > 0) {
        ctx.fillRect(0, 1, topMargin, 1);
      }

      // ä¸‹ä¾§ stretch
      if (bottomMargin > buffer) {
        ctx.fillRect(0, 1 + cy + ch + buffer, 1, bottomMargin - buffer);
      } else if (bottomMargin > 0) {
        ctx.fillRect(0, 1 + cy + ch, 1, bottomMargin);
      }

      // å…œåº•
      if (topMargin <= buffer && bottomMargin <= buffer) {
        ctx.fillRect(0, 1, 1, 1);
      }

      // åº•éƒ¨å’Œå³ä¾§ï¼ˆå†…å®¹åŒºåŸŸï¼‰ï¼šè®¾ç½®ä¸ºå…¨å±ï¼Œé¿å…é™åˆ¶Appå†…éƒ¨å¸ƒå±€
      // é€šå¸¸å¯åŠ¨å›¾ä½œä¸ºèƒŒæ™¯ï¼Œä¸åº”è¯¥é™åˆ¶Content Padding
      ctx.fillRect(1, h + 1, w, 1);    // åº•éƒ¨ï¼šå…¨å®½
      ctx.fillRect(w + 1, 1, 1, h);    // å³ä¾§ï¼šå…¨é«˜

      return nineCanvas;
    }


    // åå…­è¿›åˆ¶é¢œè‰²è½¬RGB
    function hexToRgb(hex) {
      const result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
      return result ? {
        r: parseInt(result[1], 16),
        g: parseInt(result[2], 16),
        b: parseInt(result[3], 16)
      } : { r: 255, g: 255, b: 255 };
    }

    // å…¨å±é¢„è§ˆï¼ˆä½¿ç”¨æ‰‹æœºæ¨¡å‹æ¡†æ¶ï¼‰
    function showFullscreen(canvas, size) {
      fullscreenContent.innerHTML = '';

      // è®¡ç®—å…¨å±é¢„è§ˆå°ºå¯¸ï¼ˆæ ¹æ®å±å¹•å¤§å°è‡ªé€‚åº”ï¼‰
      const maxWidth = Math.min(window.innerWidth * 0.9, 600);
      const displayCanvas = createPhonePreview(canvas, size, maxWidth);

      fullscreenContent.appendChild(displayCanvas);
      fullscreenModal.classList.add('active');
    }

    // åˆ›å»ºæ‰‹æœºæ¨¡å‹é¢„è§ˆ
    function createPhonePreview(imageCanvas, size, maxWidth) {
      const canvasAspect = imageCanvas.width / imageCanvas.height;
      const isPortrait = canvasAspect < 1;

      // è®¡ç®—æ‰‹æœºæ¨¡å‹å°ºå¯¸ï¼ˆåŒ…æ‹¬è¾¹æ¡†ï¼‰
      const borderWidth = maxWidth * 0.08; // è¾¹æ¡†å®½åº¦
      const screenWidth = maxWidth - borderWidth * 2;
      const screenHeight = screenWidth / canvasAspect;
      const phoneWidth = screenWidth + borderWidth * 2;
      const phoneHeight = screenHeight + borderWidth * 2;

      // åˆ›å»ºcanvas
      const phoneCanvas = document.createElement('canvas');
      phoneCanvas.width = phoneWidth;
      phoneCanvas.height = phoneHeight;
      const ctx = phoneCanvas.getContext('2d');

      // ä½¿ç”¨é«˜è´¨é‡æ¸²æŸ“
      ctx.imageSmoothingEnabled = true;
      ctx.imageSmoothingQuality = 'high';

      // ç»˜åˆ¶æ‰‹æœºè¾¹æ¡†ï¼ˆå¤–æ¡†ï¼‰
      ctx.fillStyle = '#1a1a1a';
      ctx.fillRect(0, 0, phoneWidth, phoneHeight);

      // ç»˜åˆ¶æ‰‹æœºè¾¹æ¡†ï¼ˆå†…æ¡†ï¼Œæ›´äº®çš„è¾¹ç¼˜ï¼‰
      ctx.strokeStyle = '#333';
      ctx.lineWidth = borderWidth * 0.3;
      ctx.strokeRect(borderWidth * 0.5, borderWidth * 0.5, phoneWidth - borderWidth, phoneHeight - borderWidth);

      // ç»˜åˆ¶å±å¹•åŒºåŸŸï¼ˆåœ†è§’ï¼‰
      const cornerRadius = borderWidth * 0.3;
      ctx.fillStyle = '#000';
      if (ctx.roundRect) {
        ctx.beginPath();
        ctx.roundRect(borderWidth, borderWidth, screenWidth, screenHeight, cornerRadius);
        ctx.fill();
      } else {
        // å…¼å®¹æ€§ï¼šå¦‚æœroundRectä¸å­˜åœ¨ï¼Œä½¿ç”¨rect
        ctx.fillRect(borderWidth, borderWidth, screenWidth, screenHeight);
      }

      // ç»˜åˆ¶å¯åŠ¨å›¾åˆ°å±å¹•åŒºåŸŸ
      ctx.save();
      if (ctx.roundRect) {
        ctx.beginPath();
        ctx.roundRect(borderWidth, borderWidth, screenWidth, screenHeight, cornerRadius);
        ctx.clip();
      }
      ctx.drawImage(
        imageCanvas,
        0, 0, imageCanvas.width, imageCanvas.height,
        borderWidth, borderWidth, screenWidth, screenHeight
      );
      ctx.restore();

      // æ ¹æ®è®¾å¤‡ç±»å‹ç»˜åˆ¶ç‰¹æ®Šå…ƒç´ 
      if (currentPlatform === 'ios') {
        // å¦‚æœæ˜¯iPhoneä¸”æœ‰åˆ˜æµ·ï¼Œç»˜åˆ¶åˆ˜æµ·
        if (size.name.includes('iPhone') &&
          (size.name.includes('X') || size.name.includes('11') ||
            size.name.includes('12') || size.name.includes('13') ||
            size.name.includes('14'))) {
          drawNotch(ctx, phoneWidth, borderWidth, screenWidth);
        }

        // å¦‚æœæ˜¯iPhone 8æˆ–æ›´æ—©ï¼Œç»˜åˆ¶Homeé”®
        if (size.name.includes('iPhone 8') || size.name.includes('iPhone 7') ||
          size.name.includes('iPhone 6')) {
          drawHomeButton(ctx, phoneWidth, phoneHeight, borderWidth);
        }
      } else if (currentPlatform === 'android') {
        // Androidè®¾å¤‡å¯ä»¥æ·»åŠ ä¸€äº›æ ‡è¯†ï¼Œæ¯”å¦‚è™šæ‹ŸæŒ‰é”®åŒºåŸŸç­‰
        // è¿™é‡Œå¯ä»¥æ ¹æ®éœ€è¦æ·»åŠ 
      }

      // è®¾ç½®canvasæ ·å¼
      phoneCanvas.style.width = phoneWidth + 'px';
      phoneCanvas.style.height = phoneHeight + 'px';
      phoneCanvas.style.cursor = 'pointer';

      return phoneCanvas;
    }

    // ç»˜åˆ¶åˆ˜æµ·
    function drawNotch(ctx, phoneWidth, borderWidth, screenWidth) {
      const notchWidth = screenWidth * 0.25;
      const notchHeight = borderWidth * 0.6;
      const notchX = (phoneWidth - notchWidth) / 2;
      const notchY = borderWidth;

      ctx.fillStyle = '#1a1a1a';
      ctx.beginPath();
      ctx.arc(notchX, notchY + notchHeight, notchHeight, Math.PI, 0, false);
      ctx.arc(notchX + notchWidth, notchY + notchHeight, notchHeight, Math.PI, 0, true);
      ctx.closePath();
      ctx.fill();
    }

    // ç»˜åˆ¶Homeé”®
    function drawHomeButton(ctx, phoneWidth, phoneHeight, borderWidth) {
      const buttonSize = borderWidth * 0.8;
      const buttonX = (phoneWidth - buttonSize) / 2;
      const buttonY = phoneHeight - borderWidth * 1.5;

      ctx.fillStyle = '#333';
      ctx.beginPath();
      ctx.arc(buttonX + buttonSize / 2, buttonY + buttonSize / 2, buttonSize / 2, 0, Math.PI * 2);
      ctx.fill();

      ctx.strokeStyle = '#555';
      ctx.lineWidth = buttonSize * 0.1;
      ctx.stroke();
    }

    // æ‰©å±•CanvasRenderingContext2Dï¼Œæ·»åŠ roundRectæ–¹æ³•ï¼ˆå¦‚æœä¸å­˜åœ¨ï¼‰
    if (!CanvasRenderingContext2D.prototype.roundRect) {
      CanvasRenderingContext2D.prototype.roundRect = function (x, y, width, height, radius) {
        this.beginPath();
        this.moveTo(x + radius, y);
        this.lineTo(x + width - radius, y);
        this.quadraticCurveTo(x + width, y, x + width, y + radius);
        this.lineTo(x + width, y + height - radius);
        this.quadraticCurveTo(x + width, y + height, x + width - radius, y + height);
        this.lineTo(x + radius, y + height);
        this.quadraticCurveTo(x, y + height, x, y + height - radius);
        this.lineTo(x, y + radius);
        this.quadraticCurveTo(x, y, x + radius, y);
        this.closePath();
      };
    }

    function closeFullscreen() {
      fullscreenModal.classList.remove('active');
      fullscreenContent.innerHTML = '';
    }

    // ä¸‹è½½å›¾ç‰‡
    function downloadImage() {
      if (!generatedImage) {
        showStatus('æ²¡æœ‰å¯ä¸‹è½½çš„å›¾ç‰‡', 'error');
        return;
      }

      const platformName = currentPlatform === 'ios' ? 'iOS' : 'Android';
      const timestamp = new Date().toISOString().replace(/[:.]/g, '-').slice(0, -5);
      const link = document.createElement('a');
      if (currentPlatform === 'android') {
        if (outputFormat === 'nine') {
          const ninePatchCanvas = createNinePatchFromCanvas(generatedImage.canvas, generatedImage.contentRect || { x: 0, y: 0, width: generatedImage.width, height: generatedImage.height });
          link.download = `${platformName}_${generatedImage.name.replace(/\s+/g, '_')}_${generatedImage.width}x${generatedImage.height}_${timestamp}.9.png`;
          link.href = ninePatchCanvas.toDataURL('image/png');
        } else {
          link.download = `${platformName}_${generatedImage.name.replace(/\s+/g, '_')}_${generatedImage.width}x${generatedImage.height}_${timestamp}.png`;
          link.href = generatedImage.canvas.toDataURL('image/png');
        }
      } else {
        link.download = `${platformName}_${generatedImage.name.replace(/\s+/g, '_')}_${generatedImage.width}x${generatedImage.height}_${timestamp}.png`;
        link.href = generatedImage.canvas.toDataURL('image/png');
      }
      link.click();

      showStatus('å›¾ç‰‡ä¸‹è½½å·²å¼€å§‹', 'success');
    }

    // æ˜¾ç¤ºçŠ¶æ€æ¶ˆæ¯
    function showStatus(message, type) {
      statusMessage.textContent = message;
      statusMessage.className = `status-message ${type}`;
      setTimeout(() => {
        statusMessage.className = 'status-message';
      }, 5000);
    }

    // åˆå§‹åŒ–
    init();
  </script>
  <script src="../../assets/js/tools.js"></script>
  <script src="../../assets/js/themes.js"></script>
  <script src="../../assets/js/theme-ui.js"></script>
</body>

</html>