<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>IPåœ°å€æŸ¥è¯¢å·¥å…·</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
    }

    .container {
      max-width: 1000px;
      margin: 0 auto;
      background: #fff;
      border-radius: 16px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, .3);
      overflow: hidden;
    }

    .header {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: #fff;
      padding: 30px;
      text-align: center;
      position: relative;
    }

    .home-btn {
      position: absolute;
      top: 20px;
      left: 20px;
      width: 40px;
      height: 40px;
      background: rgba(255, 255, 255, 0.2);
      border: 2px solid rgba(255, 255, 255, 0.3);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #fff;
      text-decoration: none;
      font-size: 20px;
      transition: all .3s;
      z-index: 10;
    }

    .home-btn:hover {
      background: rgba(255, 255, 255, 0.3);
      border-color: rgba(255, 255, 255, 0.5);
      transform: scale(1.1);
    }

    .header h1 {
      font-size: 28px;
      margin-bottom: 10px;
    }

    .header p {
      opacity: .9;
      font-size: 14px;
    }

    .content {
      padding: 30px;
    }

    .query-section {
      background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
      border-radius: 12px;
      padding: 25px;
      margin-bottom: 25px;
      border: 1px solid #dee2e6;
    }

    .query-section h2 {
      font-size: 20px;
      color: #495057;
      margin-bottom: 20px;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .query-form {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
      align-items: flex-end;
    }

    .input-group {
      flex: 1;
      min-width: 200px;
    }

    .input-group label {
      display: block;
      font-weight: 600;
      color: #495057;
      margin-bottom: 8px;
      font-size: 14px;
    }

    .input-group input {
      width: 100%;
      padding: 12px 16px;
      border: 2px solid #dee2e6;
      border-radius: 8px;
      font-size: 16px;
      transition: all 0.3s;
    }

    .input-group input:focus {
      outline: none;
      border-color: #667eea;
      box-shadow: 0 0 0 4px rgba(102, 126, 234, .1);
    }

    .btn {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: #fff;
      border: none;
      padding: 12px 30px;
      border-radius: 8px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
      white-space: nowrap;
      height: fit-content;
    }

    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(102, 126, 234, .4);
    }

    .btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none;
    }

    .btn-secondary {
      background: linear-gradient(135deg, #6c757d 0%, #5a6268 100%);
    }

    .result-section {
      margin-top: 25px;
    }

    .result-card {
      background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
      border-radius: 12px;
      padding: 25px;
      margin-bottom: 20px;
      border: 2px solid #e9ecef;
      box-shadow: 0 4px 12px rgba(0, 0, 0, .08);
    }

    .result-card h3 {
      font-size: 18px;
      color: #2d3748;
      margin-bottom: 20px;
      display: flex;
      align-items: center;
      gap: 10px;
      padding-bottom: 12px;
      border-bottom: 2px solid #e9ecef;
    }

    .result-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 15px;
    }

    .result-item {
      background: #fff;
      padding: 15px;
      border-radius: 8px;
      border: 1px solid #e9ecef;
    }

    .result-label {
      font-size: 12px;
      color: #718096;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-bottom: 6px;
    }

    .result-value {
      font-size: 16px;
      color: #2d3748;
      font-weight: 600;
      word-break: break-all;
    }

    .result-value.empty {
      color: #adb5bd;
      font-style: italic;
    }

    .loading {
      text-align: center;
      padding: 40px;
      color: #718096;
    }

    .loading-spinner {
      display: inline-block;
      width: 40px;
      height: 40px;
      border: 4px solid #e9ecef;
      border-top-color: #667eea;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin-bottom: 15px;
    }

    @keyframes spin {
      to {
        transform: rotate(360deg);
      }
    }

    .error {
      background: #fff5f5;
      border-color: #fc8181;
      color: #c53030;
      padding: 15px;
      border-radius: 8px;
      margin-top: 15px;
    }

    .ip-badge {
      display: inline-block;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: #fff;
      padding: 6px 12px;
      border-radius: 20px;
      font-size: 14px;
      font-weight: 600;
      margin-left: 10px;
    }

    @media (max-width: 768px) {
      .query-form {
        flex-direction: column;
      }

      .btn {
        width: 100%;
      }

      .result-grid {
        grid-template-columns: 1fr;
      }
    }
  </style>
  <link rel="icon" href="data:,">
  <script src="./tools.js"></script>
</head>

<body>
  <div class="container">
    <div class="header">
      <a href="./index.html" class="home-btn">ğŸ </a>
      <h1></h1>
      <p></p>
    </div>
    <div class="content">
      <!-- å½“å‰IPæŸ¥è¯¢ -->
      <div class="query-section">
        <h2>
          <span>ğŸŒ</span>
          <span>å½“å‰IPåœ°å€æŸ¥è¯¢</span>
        </h2>
        <button class="btn" id="queryCurrentBtn">
          <span>æŸ¥è¯¢æˆ‘çš„IP</span>
        </button>
        <div id="currentIpResult"></div>
      </div>

      <!-- è¾“å…¥IPæŸ¥è¯¢ -->
      <div class="query-section">
        <h2>
          <span>ğŸ”</span>
          <span>IPåœ°å€å½’å±åœ°æŸ¥è¯¢</span>
        </h2>
        <div class="query-form">
          <div class="input-group">
            <label for="ipInput">IPåœ°å€</label>
            <input type="text" id="ipInput" placeholder="è¯·è¾“å…¥IPåœ°å€ï¼Œä¾‹å¦‚ï¼š8.8.8.8" />
          </div>
          <button class="btn" id="queryIpBtn">
            <span>æŸ¥è¯¢</span>
          </button>
        </div>
        <div id="ipResult"></div>
      </div>
    </div>
  </div>

  <script>
    // IPæŸ¥è¯¢APIï¼ˆä½¿ç”¨ip-api.comçš„JSONPæ¥å£ï¼Œæ”¯æŒCORSï¼‰
    // æ ¹æ®å½“å‰é¡µé¢åè®®è‡ªåŠ¨é€‰æ‹©HTTPæˆ–HTTPS
    const IP_API_BASE = window.location.protocol === 'https:'
      ? 'https://ip-api.com/json/'
      : 'http://ip-api.com/json/';

    // éªŒè¯IPåœ°å€æ ¼å¼
    function isValidIP(ip) {
      const ipRegex = /^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/;
      return ipRegex.test(ip);
    }

    // ä½¿ç”¨JSONPæ–¹å¼æŸ¥è¯¢IPä¿¡æ¯ï¼ˆç»•è¿‡CORSé™åˆ¶ï¼‰
    function queryIP(ip = '') {
      return new Promise((resolve, reject) => {
        // åˆ›å»ºå”¯ä¸€çš„å›è°ƒå‡½æ•°å
        const callbackName = 'ipQueryCallback_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);

        // åˆ›å»ºscriptæ ‡ç­¾
        const script = document.createElement('script');
        const targetUrl = ip
          ? `${IP_API_BASE}${ip}?fields=status,message,query,country,countryCode,region,regionName,city,zip,lat,lon,timezone,isp,org,as&callback=${callbackName}`
          : `${IP_API_BASE}?fields=status,message,query,country,countryCode,region,regionName,city,zip,lat,lon,timezone,isp,org,as&callback=${callbackName}`;

        script.src = targetUrl;

        // è®¾ç½®è¶…æ—¶
        const timeout = setTimeout(() => {
          if (document.head.contains(script)) {
            document.head.removeChild(script);
          }
          if (window[callbackName]) {
            delete window[callbackName];
          }
          reject(new Error('è¯·æ±‚è¶…æ—¶ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥'));
        }, 15000);

        // è®¾ç½®å…¨å±€å›è°ƒå‡½æ•°
        window[callbackName] = function (data) {
          // æ¸…ç†
          clearTimeout(timeout);
          if (document.head.contains(script)) {
            document.head.removeChild(script);
          }
          delete window[callbackName];

          if (data.status === 'fail') {
            reject(new Error(data.message || 'æŸ¥è¯¢å¤±è´¥'));
            return;
          }

          resolve({
            ip: data.query,
            country: data.country || 'æœªçŸ¥',
            countryCode: data.countryCode || '',
            region: data.regionName || data.region || 'æœªçŸ¥',
            city: data.city || 'æœªçŸ¥',
            zip: data.zip || 'æœªçŸ¥',
            lat: data.lat || 0,
            lon: data.lon || 0,
            timezone: data.timezone || 'æœªçŸ¥',
            isp: data.isp || 'æœªçŸ¥',
            org: data.org || 'æœªçŸ¥',
            as: data.as || 'æœªçŸ¥'
          });
        };

        // é”™è¯¯å¤„ç†
        script.onerror = () => {
          clearTimeout(timeout);
          if (document.head.contains(script)) {
            document.head.removeChild(script);
          }
          if (window[callbackName]) {
            delete window[callbackName];
          }
          reject(new Error('ç½‘ç»œè¯·æ±‚å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥'));
        };

        // æ·»åŠ åˆ°é¡µé¢
        document.head.appendChild(script);
      });
    }

    // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
    function showLoading(containerId) {
      const container = document.getElementById(containerId);
      container.innerHTML = `
        <div class="loading">
          <div class="loading-spinner"></div>
          <div>æ­£åœ¨æŸ¥è¯¢ä¸­...</div>
        </div>
      `;
    }

    // æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
    function showError(containerId, message) {
      const container = document.getElementById(containerId);
      container.innerHTML = `
        <div class="error">
          <strong>âŒ æŸ¥è¯¢å¤±è´¥</strong>
          <p>${message}</p>
        </div>
      `;
    }

    // æ˜¾ç¤ºæŸ¥è¯¢ç»“æœ
    function showResult(containerId, data, isCurrent = false) {
      const container = document.getElementById(containerId);
      const title = isCurrent ? 'å½“å‰IPä¿¡æ¯' : 'IPå½’å±åœ°ä¿¡æ¯';
      const icon = isCurrent ? 'ğŸŒ' : 'ğŸ“';

      container.innerHTML = `
        <div class="result-card">
          <h3>
            <span>${icon}</span>
            <span>${title}</span>
            <span class="ip-badge">${data.ip}</span>
          </h3>
          <div class="result-grid">
            <div class="result-item">
              <div class="result-label">å›½å®¶/åœ°åŒº</div>
              <div class="result-value">${data.country} ${data.countryCode ? `(${data.countryCode})` : ''}</div>
            </div>
            <div class="result-item">
              <div class="result-label">çœä»½/å·</div>
              <div class="result-value">${data.region}</div>
            </div>
            <div class="result-item">
              <div class="result-label">åŸå¸‚</div>
              <div class="result-value">${data.city}</div>
            </div>
            <div class="result-item">
              <div class="result-label">é‚®æ”¿ç¼–ç </div>
              <div class="result-value ${data.zip === 'æœªçŸ¥' ? 'empty' : ''}">${data.zip}</div>
            </div>
            <div class="result-item">
              <div class="result-label">æ—¶åŒº</div>
              <div class="result-value">${data.timezone}</div>
            </div>
            <div class="result-item">
              <div class="result-label">ISPæœåŠ¡å•†</div>
              <div class="result-value">${data.isp}</div>
            </div>
            <div class="result-item">
              <div class="result-label">ç»„ç»‡</div>
              <div class="result-value ${data.org === 'æœªçŸ¥' ? 'empty' : ''}">${data.org}</div>
            </div>
            <div class="result-item">
              <div class="result-label">ASç¼–å·</div>
              <div class="result-value ${data.as === 'æœªçŸ¥' ? 'empty' : ''}">${data.as}</div>
            </div>
            ${data.lat && data.lon ? `
            <div class="result-item">
              <div class="result-label">ç»çº¬åº¦</div>
              <div class="result-value">${data.lat}, ${data.lon}</div>
            </div>
            ` : ''}
          </div>
        </div>
      `;
    }

    // æŸ¥è¯¢å½“å‰IP
    document.getElementById('queryCurrentBtn').addEventListener('click', async () => {
      const btn = document.getElementById('queryCurrentBtn');
      const originalText = btn.innerHTML;

      btn.disabled = true;
      btn.innerHTML = '<span>æŸ¥è¯¢ä¸­...</span>';
      showLoading('currentIpResult');

      try {
        const data = await queryIP();
        showResult('currentIpResult', data, true);
      } catch (error) {
        showError('currentIpResult', error.message || 'æ— æ³•è·å–å½“å‰IPä¿¡æ¯ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥');
      } finally {
        btn.disabled = false;
        btn.innerHTML = originalText;
      }
    });

    // æŸ¥è¯¢è¾“å…¥IP
    document.getElementById('queryIpBtn').addEventListener('click', async () => {
      const ipInput = document.getElementById('ipInput');
      const ip = ipInput.value.trim();
      const btn = document.getElementById('queryIpBtn');
      const originalText = btn.innerHTML;

      if (!ip) {
        showError('ipResult', 'è¯·è¾“å…¥IPåœ°å€');
        return;
      }

      if (!isValidIP(ip)) {
        showError('ipResult', 'IPåœ°å€æ ¼å¼ä¸æ­£ç¡®ï¼Œè¯·è¾“å…¥æœ‰æ•ˆçš„IPv4åœ°å€');
        return;
      }

      btn.disabled = true;
      btn.innerHTML = '<span>æŸ¥è¯¢ä¸­...</span>';
      showLoading('ipResult');

      try {
        const data = await queryIP(ip);
        showResult('ipResult', data, false);
      } catch (error) {
        showError('ipResult', error.message || 'æŸ¥è¯¢å¤±è´¥ï¼Œè¯·æ£€æŸ¥IPåœ°å€æ˜¯å¦æ­£ç¡®');
      } finally {
        btn.disabled = false;
        btn.innerHTML = originalText;
      }
    });

    // æ”¯æŒå›è½¦é”®æŸ¥è¯¢
    document.getElementById('ipInput').addEventListener('keypress', (e) => {
      if (e.key === 'Enter') {
        document.getElementById('queryIpBtn').click();
      }
    });

    // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æŸ¥è¯¢å½“å‰IP
    window.addEventListener('DOMContentLoaded', () => {
      // å»¶è¿Ÿä¸€ä¸‹ï¼Œç¡®ä¿é¡µé¢å®Œå…¨åŠ è½½
      setTimeout(() => {
        document.getElementById('queryCurrentBtn').click();
      }, 500);
    });
  </script>
</body>

</html>