<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>JSON æ ¼å¼åŒ–å·¥å…·</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px
    }

    .container {
      max-width: 1400px;
      margin: 0 auto;
      background: #fff;
      border-radius: 16px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, .3);
      overflow: hidden
    }

    .header {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: #fff;
      padding: 30px;
      text-align: center
    }

    .header h1 {
      font-size: 28px;
      margin-bottom: 10px
    }

    .header p {
      opacity: .9;
      font-size: 14px
    }

    .content {
      padding: 30px
    }

    .editor-container {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      margin-bottom: 20px
    }

    @media (max-width: 768px) {
      .editor-container {
        grid-template-columns: 1fr
      }
    }

    .editor-section {
      background: #f8f9fa;
      border-radius: 12px;
      padding: 20px
    }

    .editor-section h2 {
      font-size: 18px;
      color: #495057;
      margin-bottom: 15px;
      display: flex;
      justify-content: space-between;
      align-items: center
    }

    .editor-section h2 .status {
      font-size: 12px;
      font-weight: normal;
      padding: 4px 8px;
      border-radius: 4px;
      background: #dc3545;
      color: #fff
    }

    .editor-section h2 .status.valid {
      background: #28a745
    }

    textarea {
      width: 100%;
      min-height: 400px;
      padding: 15px;
      border: 2px solid #dee2e6;
      border-radius: 8px;
      font-family: 'Courier New', Consolas, monospace;
      font-size: 14px;
      line-height: 1.6;
      resize: vertical;
      transition: border-color .3s
    }

    textarea:focus {
      outline: none;
      border-color: #667eea
    }

    .preview-section {
      background: #fff;
      border: 2px solid #dee2e6;
      border-radius: 8px;
      padding: 15px;
      min-height: 400px;
      max-height: 600px;
      overflow: auto;
      font-family: 'Courier New', Consolas, monospace;
      font-size: 14px;
      line-height: 1.6
    }

    .json-collapsible {
      cursor: pointer;
      user-select: none;
    }

    .json-collapsible:hover {
      background: #f8f9fa;
    }

    .json-collapsible::before {
      content: 'â–¶';
      display: inline-block;
      width: 12px;
      margin-right: 4px;
      transition: transform 0.2s;
      color: #6c757d;
    }

    .json-collapsible.collapsed::before {
      transform: rotate(0deg);
    }

    .json-collapsible.expanded::before {
      transform: rotate(90deg);
    }

    .json-children {
      margin-left: 20px;
      border-left: 1px solid #e9ecef;
      padding-left: 10px;
    }

    .json-collapsible.collapsed+.json-children {
      display: none;
    }

    .json-count {
      color: #6c757d;
      font-size: 12px;
      font-weight: normal;
      margin-left: 5px;
    }

    .preview-section .json-key {
      color: #0969da;
      font-weight: 600
    }

    .preview-section .json-string {
      color: #0a3069
    }

    .preview-section .json-number {
      color: #0550ae
    }

    .preview-section .json-boolean {
      color: #cf222e
    }

    .preview-section .json-null {
      color: #6e7781
    }

    .preview-section .json-error {
      color: #dc3545;
      background: #f8d7da;
      padding: 10px;
      border-radius: 4px;
      border-left: 3px solid #dc3545
    }

    .btn-group {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
      flex-wrap: wrap
    }

    .btn {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: #fff;
      border: none;
      padding: 12px 24px;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: transform .2s
    }

    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(102, 126, 234, .4)
    }

    .btn-secondary {
      background: linear-gradient(135deg, #6c757d 0%, #5a6268 100%);
    }

    .btn-success {
      background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
    }

    .btn-danger {
      background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
    }

    .back-link {
      display: inline-block;
      margin-bottom: 20px;
      color: #fff;
      text-decoration: none;
      opacity: .9;
      transition: opacity .3s
    }

    .back-link:hover {
      opacity: 1
    }

    .stats {
      display: flex;
      gap: 15px;
      margin-top: 15px;
      padding: 10px;
      background: #f8f9fa;
      border-radius: 6px;
      font-size: 12px;
      color: #6c757d
    }

    .stat-item {
      display: flex;
      gap: 5px
    }

    .stat-item strong {
      color: #495057
    }
  </style>
</head>

<body>
  <div class="container">
    <div class="header">
      <a href="./index.html" class="back-link">â† è¿”å›é¦–é¡µ</a>
      <h1>ğŸ“„ JSON æ ¼å¼åŒ–å·¥å…·</h1>
      <p>JSON æ ¼å¼åŒ–ã€éªŒè¯å’Œå¯è§†åŒ–é¢„è§ˆ</p>
    </div>
    <div class="content">
      <div class="btn-group">
        <button class="btn" onclick="formatJSON()">æ ¼å¼åŒ–</button>
        <button class="btn btn-secondary" onclick="validateJSON()">éªŒè¯</button>
        <button class="btn" onclick="copyJSON()">å¤åˆ¶ç»“æœ</button>
        <button class="btn btn-danger" onclick="clearJSON()">æ¸…ç©º</button>
      </div>

      <div class="editor-container">
        <div class="editor-section">
          <h2>
            <span>ç¼–è¾‘åŒºåŸŸ</span>
            <span class="status" id="editStatus">æœªéªŒè¯</span>
          </h2>
          <textarea id="jsonInput"
            placeholder='è¯·è¾“å…¥ JSON å†…å®¹ï¼Œä¾‹å¦‚ï¼š&#10;{&#10;  "name": "ç¤ºä¾‹",&#10;  "age": 25,&#10;  "items": [1, 2, 3]&#10;}'></textarea>
          <div class="stats" id="inputStats"></div>
        </div>

        <div class="editor-section">
          <h2>
            <span>é¢„è§ˆåŒºåŸŸ</span>
            <span class="status valid" id="previewStatus">å°±ç»ª</span>
          </h2>
          <div class="preview-section" id="jsonPreview">
            <div style="color: #6c757d; text-align: center; padding: 40px;">
              æ ¼å¼åŒ–åçš„ JSON å°†æ˜¾ç¤ºåœ¨è¿™é‡Œ
            </div>
          </div>
          <div class="stats" id="outputStats"></div>
        </div>
      </div>
    </div>
  </div>

  <script>
    const jsonInput = document.getElementById('jsonInput');
    const jsonPreview = document.getElementById('jsonPreview');
    const editStatus = document.getElementById('editStatus');
    const previewStatus = document.getElementById('previewStatus');
    const inputStats = document.getElementById('inputStats');
    const outputStats = document.getElementById('outputStats');

    // æ ¼å¼åŒ– JSON
    function formatJSON() {
      const input = jsonInput.value.trim();
      if (!input) {
        alert('è¯·è¾“å…¥ JSON å†…å®¹');
        return;
      }

      try {
        const parsed = JSON.parse(input);
        const formatted = JSON.stringify(parsed, null, 2);
        jsonInput.value = formatted;
        displayPreview(parsed);
        updateStatus(true);
        updateStats(input, formatted);
      } catch (e) {
        showError(e.message);
        updateStatus(false);
      }
    }

    // éªŒè¯ JSON
    function validateJSON() {
      const input = jsonInput.value.trim();
      if (!input) {
        alert('è¯·è¾“å…¥ JSON å†…å®¹');
        return;
      }

      try {
        const parsed = JSON.parse(input);
        displayPreview(parsed);
        updateStatus(true);
        alert('âœ“ JSON æ ¼å¼æ­£ç¡®ï¼');
      } catch (e) {
        showError(e.message);
        updateStatus(false);
        alert('âœ— JSON æ ¼å¼é”™è¯¯ï¼š' + e.message);
      }
    }

    // æ˜¾ç¤ºé¢„è§ˆ
    function displayPreview(parsedObj) {
      const html = renderJSON(parsedObj, 0);
      jsonPreview.innerHTML = html;
      previewStatus.textContent = 'å·²æ ¼å¼åŒ–';
      previewStatus.className = 'status valid';

      // ç»‘å®šæŠ˜å å±•å¼€äº‹ä»¶
      setTimeout(() => {
        bindCollapseEvents();
      }, 0);
    }

    // æ¸²æŸ“JSONï¼ˆæ”¯æŒæŠ˜å å±•å¼€ï¼‰
    function renderJSON(obj, indent = 0) {
      const indentStr = '&nbsp;'.repeat(indent * 2);
      const nextIndent = indent + 1;
      const nextIndentStr = '&nbsp;'.repeat(nextIndent * 2);

      if (obj === null) {
        return `<span class="json-null">null</span>`;
      }

      if (typeof obj === 'string') {
        return `<span class="json-string">"${escapeHtml(obj)}"</span>`;
      }

      if (typeof obj === 'number') {
        return `<span class="json-number">${obj}</span>`;
      }

      if (typeof obj === 'boolean') {
        return `<span class="json-boolean">${obj}</span>`;
      }

      if (Array.isArray(obj)) {
        if (obj.length === 0) {
          return `[]`;
        }
        const id = 'arr_' + Math.random().toString(36).substr(2, 9);
        let html = `<div>${indentStr}<span class="json-collapsible collapsed" data-id="${id}">[<span class="json-count">${obj.length} items</span>]</span>`;
        html += `<div class="json-children" id="${id}" style="display: none;">`;
        obj.forEach((item, index) => {
          html += `${nextIndentStr}${renderJSON(item, nextIndent)}`;
          if (index < obj.length - 1) html += ',';
          html += '<br>';
        });
        html += `${indentStr}]</div></div>`;
        return html;
      }

      if (typeof obj === 'object') {
        const keys = Object.keys(obj);
        if (keys.length === 0) {
          return `{}`;
        }
        const id = 'obj_' + Math.random().toString(36).substr(2, 9);
        let html = `<div>${indentStr}<span class="json-collapsible collapsed" data-id="${id}">{<span class="json-count">${keys.length} keys</span>}</span>`;
        html += `<div class="json-children" id="${id}" style="display: none;">`;
        keys.forEach((key, index) => {
          html += `${nextIndentStr}<span class="json-key">"${escapeHtml(key)}"</span>: ${renderJSON(obj[key], nextIndent)}`;
          if (index < keys.length - 1) html += ',';
          html += '<br>';
        });
        html += `${indentStr}}</div></div>`;
        return html;
      }

      return escapeHtml(String(obj));
    }

    // ç»‘å®šæŠ˜å å±•å¼€äº‹ä»¶
    function bindCollapseEvents() {
      document.querySelectorAll('.json-collapsible').forEach(el => {
        el.addEventListener('click', function () {
          const id = this.dataset.id;
          const children = document.getElementById(id);
          if (children) {
            if (this.classList.contains('collapsed')) {
              this.classList.remove('collapsed');
              this.classList.add('expanded');
              children.style.display = 'block';
            } else {
              this.classList.remove('expanded');
              this.classList.add('collapsed');
              children.style.display = 'none';
            }
          }
        });
      });
    }

    // HTMLè½¬ä¹‰
    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }

    // æ˜¾ç¤ºé”™è¯¯
    function showError(message) {
      jsonPreview.innerHTML = `<div class="json-error">JSON æ ¼å¼é”™è¯¯ï¼š${escapeHtml(message)}</div>`;
      previewStatus.textContent = 'æ ¼å¼é”™è¯¯';
      previewStatus.className = 'status';
    }

    // æ›´æ–°çŠ¶æ€
    function updateStatus(isValid) {
      if (isValid) {
        editStatus.textContent = 'æ ¼å¼æ­£ç¡®';
        editStatus.className = 'status valid';
      } else {
        editStatus.textContent = 'æ ¼å¼é”™è¯¯';
        editStatus.className = 'status';
      }
    }

    // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
    function updateStats(input, output) {
      const inputLength = input.length;
      const outputLength = output.length;
      const inputLines = input.split('\n').length;
      const outputLines = output.split('\n').length;

      inputStats.innerHTML = `
        <div class="stat-item">
          <strong>å­—ç¬¦æ•°:</strong> ${inputLength.toLocaleString()}
        </div>
        <div class="stat-item">
          <strong>è¡Œæ•°:</strong> ${inputLines}
        </div>
      `;

      outputStats.innerHTML = `
        <div class="stat-item">
          <strong>å­—ç¬¦æ•°:</strong> ${outputLength.toLocaleString()}
        </div>
        <div class="stat-item">
          <strong>è¡Œæ•°:</strong> ${outputLines}
        </div>
      `;
    }

    // å¤åˆ¶ JSON
    function copyJSON() {
      const text = jsonInput.value;
      if (!text.trim()) {
        alert('æ²¡æœ‰å†…å®¹å¯å¤åˆ¶');
        return;
      }

      navigator.clipboard.writeText(text).then(() => {
        alert('å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼');
      }).catch(() => {
        const textarea = document.createElement('textarea');
        textarea.value = text;
        document.body.appendChild(textarea);
        textarea.select();
        document.execCommand('copy');
        document.body.removeChild(textarea);
        alert('å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼');
      });
    }

    // æ¸…ç©º
    function clearJSON() {
      if (confirm('ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰å†…å®¹å—ï¼Ÿ')) {
        jsonInput.value = '';
        jsonPreview.innerHTML = '<div style="color: #6c757d; text-align: center; padding: 40px;">æ ¼å¼åŒ–åçš„ JSON å°†æ˜¾ç¤ºåœ¨è¿™é‡Œ</div>';
        editStatus.textContent = 'æœªéªŒè¯';
        editStatus.className = 'status';
        previewStatus.textContent = 'å°±ç»ª';
        previewStatus.className = 'status valid';
        inputStats.innerHTML = '';
        outputStats.innerHTML = '';
      }
    }

    // HTML è½¬ä¹‰
    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }

    // å®æ—¶éªŒè¯ï¼ˆå¯é€‰ï¼Œåœ¨è¾“å…¥æ—¶è‡ªåŠ¨éªŒè¯ï¼‰
    let validateTimer;
    jsonInput.addEventListener('input', function () {
      clearTimeout(validateTimer);
      validateTimer = setTimeout(() => {
        const input = this.value.trim();
        if (input) {
          try {
            JSON.parse(input);
            updateStatus(true);
          } catch (e) {
            updateStatus(false);
          }
        } else {
          editStatus.textContent = 'æœªéªŒè¯';
          editStatus.className = 'status';
        }
      }, 500);
    });

    // ç¤ºä¾‹ JSON
    const exampleJSON = {
      "name": "JSON æ ¼å¼åŒ–å·¥å…·",
      "version": "1.0.0",
      "features": ["æ ¼å¼åŒ–", "éªŒè¯", "é¢„è§ˆ"],
      "author": {
        "name": "å¼€å‘è€…",
        "email": "dev@example.com"
      },
      "numbers": [1, 2, 3, 4, 5],
      "active": true,
      "metadata": null
    };

    // åˆå§‹åŒ–ç¤ºä¾‹
    jsonInput.value = JSON.stringify(exampleJSON, null, 2);
    formatJSON();
  </script>
</body>

</html>