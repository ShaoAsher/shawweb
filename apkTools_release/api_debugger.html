<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>API è°ƒè¯•å·¥å…·</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px
    }

    .container {
      max-width: 1600px;
      margin: 0 auto;
      background: #fff;
      border-radius: 16px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, .3);
      overflow: hidden;
      display: flex;
      flex-direction: column;
      height: calc(100vh - 40px)
    }

    .header {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: #fff;
      padding: 20px 30px;
      text-align: center;
      flex-shrink: 0;
      position: relative
    }

    .home-btn {
      position: absolute;
      top: 15px;
      left: 20px;
      width: 40px;
      height: 40px;
      background: rgba(255, 255, 255, 0.2);
      border: 2px solid rgba(255, 255, 255, 0.3);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #fff;
      text-decoration: none;
      font-size: 20px;
      transition: all .3s;
      z-index: 10;
    }

    .home-btn:hover {
      background: rgba(255, 255, 255, 0.3);
      border-color: rgba(255, 255, 255, 0.5);
      transform: scale(1.1);
    }

    .header h1 {
      font-size: 24px;
      margin-bottom: 5px
    }

    .header p {
      opacity: .9;
      font-size: 13px
    }

    .main-content {
      flex: 1;
      display: flex;
      flex-direction: column;
      overflow: hidden
    }

    .request-section {
      flex: 1;
      display: flex;
      flex-direction: column;
      overflow: hidden;
      border-bottom: 2px solid #dee2e6
    }

    .request-toolbar {
      padding: 15px 20px;
      background: #f8f9fa;
      border-bottom: 1px solid #dee2e6;
      display: flex;
      gap: 10px;
      align-items: center;
      flex-shrink: 0
    }

    .method-select {
      padding: 10px 15px;
      background: linear-gradient(135deg, #07C160 0%, #42BD56 100%);
      color: #fff;
      border: none;
      border-radius: 8px;
      font-weight: 600;
      font-size: 14px;
      cursor: pointer;
      min-width: 80px;
      position: relative
    }

    .method-select::after {
      content: 'â–¼';
      margin-left: 8px;
      font-size: 10px
    }

    .url-input {
      flex: 1;
      padding: 10px 15px;
      border: 2px solid #dee2e6;
      border-radius: 8px;
      font-size: 14px;
      font-family: 'Courier New', monospace
    }

    .url-input:focus {
      outline: none;
      border-color: #667eea
    }

    .toolbar-buttons {
      display: flex;
      gap: 10px
    }

    .btn {
      padding: 10px 20px;
      border: none;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all .2s
    }

    .btn-primary {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: #fff
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(102, 126, 234, .4)
    }

    .btn-secondary {
      background: #6c757d;
      color: #fff
    }

    .tabs-container {
      background: #fff;
      border-bottom: 1px solid #dee2e6;
      flex-shrink: 0
    }

    .main-tabs {
      display: flex;
      gap: 0;
      padding: 0 20px;
      overflow-x: auto
    }

    .main-tab {
      padding: 12px 20px;
      background: transparent;
      border: none;
      border-bottom: 3px solid transparent;
      cursor: pointer;
      font-size: 14px;
      color: #6c757d;
      transition: all .2s;
      white-space: nowrap
    }

    .main-tab:hover {
      color: #667eea;
      background: #f8f9fa
    }

    .main-tab.active {
      color: #667eea;
      border-bottom-color: #667eea;
      font-weight: 600
    }

    .tab-panel {
      display: none;
      padding: 20px;
      overflow-y: auto;
      flex: 1
    }

    .tab-panel.active {
      display: block
    }

    .body-type-tabs {
      display: flex;
      gap: 5px;
      margin-bottom: 20px;
      padding-bottom: 10px;
      border-bottom: 1px solid #dee2e6;
      overflow-x: auto
    }

    .body-type-tab {
      padding: 8px 16px;
      background: transparent;
      border: none;
      border-bottom: 2px solid transparent;
      cursor: pointer;
      font-size: 13px;
      color: #6c757d;
      transition: all .2s;
      white-space: nowrap
    }

    .body-type-tab:hover {
      color: #667eea
    }

    .body-type-tab.active {
      color: #667eea;
      border-bottom-color: #667eea;
      font-weight: 600
    }

    .params-table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 15px
    }

    .params-table th {
      text-align: left;
      padding: 12px;
      background: #f8f9fa;
      border-bottom: 2px solid #dee2e6;
      font-size: 13px;
      font-weight: 600;
      color: #495057
    }

    .params-table td {
      padding: 10px 12px;
      border-bottom: 1px solid #e9ecef
    }

    .params-table input,
    .params-table select {
      width: 100%;
      padding: 8px;
      border: 1px solid #dee2e6;
      border-radius: 4px;
      font-size: 13px
    }

    .params-table input:focus,
    .params-table select:focus {
      outline: none;
      border-color: #667eea
    }

    .param-checkbox {
      width: 18px;
      height: 18px;
      cursor: pointer
    }

    .file-input-wrapper {
      display: flex;
      gap: 8px;
      align-items: center
    }

    .file-input-wrapper input[type="file"] {
      display: none
    }

    .file-select-btn {
      padding: 6px 12px;
      background: #667eea;
      color: #fff;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 12px;
      white-space: nowrap
    }

    .file-name {
      font-size: 12px;
      color: #6c757d;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
      max-width: 150px
    }

    .action-buttons {
      display: flex;
      gap: 10px;
      align-items: center;
      margin-top: 10px
    }

    .add-param-btn {
      color: #667eea;
      background: none;
      border: none;
      cursor: pointer;
      font-size: 13px;
      text-decoration: underline;
      padding: 5px
    }

    .batch-edit-btn {
      display: flex;
      gap: 5px;
      align-items: center;
      color: #6c757d;
      background: none;
      border: none;
      cursor: pointer;
      font-size: 12px;
      padding: 5px
    }

    .batch-edit-btn:hover {
      color: #667eea
    }

    .response-section {
      flex: 1;
      display: flex;
      flex-direction: column;
      overflow: hidden;
      background: #f8f9fa
    }

    .response-header {
      padding: 15px 20px;
      background: #fff;
      border-bottom: 1px solid #dee2e6;
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-shrink: 0
    }

    .response-header h3 {
      font-size: 16px;
      color: #495057
    }

    .response-status {
      display: flex;
      gap: 15px;
      align-items: center
    }

    .status-badge {
      padding: 6px 12px;
      border-radius: 6px;
      font-size: 13px;
      font-weight: 600
    }

    .status-success {
      background: #d4edda;
      color: #155724
    }

    .response-body {
      flex: 1;
      padding: 20px;
      overflow-y: auto;
      background: #fff;
      font-family: 'Courier New', monospace;
      font-size: 13px;
      white-space: pre-wrap;
      word-break: break-all
    }

    .empty-response {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100%;
      color: #6c757d
    }

    .empty-response-icon {
      font-size: 48px;
      margin-bottom: 15px;
      opacity: .5
    }

    .modal {
      display: none;
      position: fixed;
      z-index: 1000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      align-items: center;
      justify-content: center
    }

    .modal.active {
      display: flex
    }

    .modal-content {
      background: #fff;
      border-radius: 12px;
      padding: 0;
      max-width: 700px;
      width: 90%;
      max-height: 80vh;
      display: flex;
      flex-direction: column;
      box-shadow: 0 20px 60px rgba(0, 0, 0, .3)
    }

    .modal-header {
      padding: 20px 25px;
      border-bottom: 1px solid #dee2e6;
      display: flex;
      justify-content: space-between;
      align-items: center
    }

    .modal-header h3 {
      font-size: 18px;
      color: #495057
    }

    .modal-close {
      background: none;
      border: none;
      font-size: 24px;
      cursor: pointer;
      color: #6c757d;
      width: 30px;
      height: 30px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 4px;
      transition: all .2s
    }

    .modal-close:hover {
      background: #f8f9fa;
      color: #495057
    }

    .modal-body {
      padding: 25px;
      flex: 1;
      overflow-y: auto
    }

    .batch-mode-tabs {
      display: flex;
      gap: 0;
      margin-bottom: 20px;
      border-bottom: 1px solid #dee2e6
    }

    .batch-mode-tab {
      padding: 10px 20px;
      background: transparent;
      border: none;
      border-bottom: 2px solid transparent;
      cursor: pointer;
      font-size: 14px;
      color: #6c757d;
      transition: all .2s
    }

    .batch-mode-tab.active {
      color: #667eea;
      border-bottom-color: #667eea;
      font-weight: 600
    }

    .batch-format-hint {
      background: #f8f9fa;
      padding: 12px;
      border-radius: 6px;
      margin-bottom: 15px;
      font-size: 12px;
      color: #6c757d;
      line-height: 1.6
    }

    .batch-textarea {
      width: 100%;
      min-height: 200px;
      padding: 12px;
      border: 2px solid #dee2e6;
      border-radius: 8px;
      font-family: 'Courier New', monospace;
      font-size: 13px;
      resize: vertical
    }

    .batch-textarea:focus {
      outline: none;
      border-color: #667eea
    }

    .modal-footer {
      padding: 15px 25px;
      border-top: 1px solid #dee2e6;
      display: flex;
      justify-content: flex-end;
      gap: 10px
    }

    .remove-btn {
      background: #dc3545;
      color: #fff;
      border: none;
      padding: 6px 12px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 12px
    }

    .remove-btn:hover {
      background: #c82333
    }

    .textarea-body {
      width: 100%;
      min-height: 200px;
      padding: 12px;
      border: 2px solid #dee2e6;
      border-radius: 8px;
      font-family: 'Courier New', monospace;
      font-size: 13px;
      resize: vertical
    }

    .textarea-body:focus {
      outline: none;
      border-color: #667eea
    }
  </style>
</head>

<body>
  <div class="container">
    <div class="header">
      <a href="./index.html" class="home-btn" title="è¿”å›é¦–é¡µ">ğŸ </a>
      <h1>ğŸŒ API è°ƒè¯•å·¥å…·</h1>
      <p>æ”¯æŒ HTTP è¯·æ±‚å’Œ WebSocket (WSS) è¿æ¥è°ƒè¯•ï¼Œç±»ä¼¼ APIFOXï¼ŒåŒ…å«è¯·æ±‚å†å²è®°å½•ã€‚</p>
    </div>

    <div class="main-content">
      <!-- è¯·æ±‚åŒºåŸŸ -->
      <div class="request-section">
        <div class="request-toolbar">
          <select class="method-select" id="httpMethod">
            <option value="GET">GET</option>
            <option value="POST">POST</option>
            <option value="PUT">PUT</option>
            <option value="DELETE">DELETE</option>
            <option value="PATCH">PATCH</option>
            <option value="HEAD">HEAD</option>
            <option value="OPTIONS">OPTIONS</option>
          </select>
          <input type="text" class="url-input" id="httpUrl" placeholder='æ¥å£è·¯å¾„, "/"èµ·å§‹'>
          <div class="toolbar-buttons">
            <button class="btn btn-primary" id="sendBtn">å‘é€</button>
            <button class="btn btn-secondary" id="historyBtn">å†å²</button>
          </div>
        </div>

        <div class="tabs-container">
          <div class="main-tabs">
            <button class="main-tab active" data-tab="params">Params</button>
            <button class="main-tab" data-tab="body">Body</button>
            <button class="main-tab" data-tab="headers">Headers</button>
          </div>
        </div>

        <!-- Params æ ‡ç­¾é¡µ -->
        <div class="tab-panel active" id="paramsPanel">
          <h3 style="margin-bottom: 15px; font-size: 16px; color: #495057;">Query å‚æ•°</h3>
          <table class="params-table">
            <thead>
              <tr>
                <th style="width: 30px;"></th>
                <th>å‚æ•°å</th>
                <th>å‚æ•°å€¼</th>
                <th>ç±»å‹</th>
                <th>è¯´æ˜</th>
                <th style="width: 80px;"></th>
              </tr>
            </thead>
            <tbody id="paramsTableBody">
              <tr>
                <td><input type="checkbox" class="param-checkbox" checked></td>
                <td><input type="text" placeholder="å‚æ•°å" class="param-key"></td>
                <td><input type="text" placeholder="å‚æ•°å€¼" class="param-value"></td>
                <td>
                  <select class="param-type">
                    <option value="text">Text</option>
                    <option value="number">Number</option>
                    <option value="boolean">Boolean</option>
                  </select>
                </td>
                <td><input type="text" placeholder="è¯´æ˜" class="param-desc"></td>
                <td><button class="remove-btn" onclick="removeParamRow(this)">åˆ é™¤</button></td>
              </tr>
            </tbody>
          </table>
          <div class="action-buttons">
            <button class="add-param-btn" onclick="addParamRow()">æ·»åŠ å‚æ•°</button>
            <button class="batch-edit-btn" onclick="openBatchEditModal('params')">
              <span>â‹¯</span>
              <span>æ‰¹é‡ç¼–è¾‘</span>
            </button>
          </div>
        </div>

        <!-- Body æ ‡ç­¾é¡µ -->
        <div class="tab-panel" id="bodyPanel">
          <div class="body-type-tabs">
            <button class="body-type-tab active" data-body-type="none">none</button>
            <button class="body-type-tab" data-body-type="form-data">form-data</button>
            <button class="body-type-tab" data-body-type="x-www-form-urlencoded">x-www-form-urlencoded</button>
            <button class="body-type-tab" data-body-type="json">JSON</button>
            <button class="body-type-tab" data-body-type="xml">XML</button>
            <button class="body-type-tab" data-body-type="text">Text</button>
            <button class="body-type-tab" data-body-type="binary">Binary</button>
            <button class="body-type-tab" data-body-type="graphql">GraphQL</button>
            <button class="body-type-tab" data-body-type="msgpack">msgpack</button>
          </div>

          <div id="bodyContent">
            <div id="bodyNone" style="padding: 40px; text-align: center; color: #6c757d; display: block;">
              è¯¥è¯·æ±‚æ²¡æœ‰ Body
            </div>

            <div id="bodyFormData" style="display: none;">
              <h3 style="margin-bottom: 15px; font-size: 16px; color: #495057;">Form Data</h3>
              <table class="params-table">
                <thead>
                  <tr>
                    <th style="width: 30px;"></th>
                    <th>å‚æ•°å</th>
                    <th>å‚æ•°å€¼</th>
                    <th>ç±»å‹</th>
                    <th>è¯´æ˜</th>
                    <th style="width: 80px;"></th>
                  </tr>
                </thead>
                <tbody id="formDataTableBody">
                  <tr>
                    <td><input type="checkbox" class="param-checkbox" checked></td>
                    <td><input type="text" placeholder="å‚æ•°å" class="param-key"></td>
                    <td>
                      <div class="file-input-wrapper">
                        <input type="text" placeholder="å‚æ•°å€¼" class="param-value">
                        <button class="file-select-btn" onclick="selectFile(this)" style="display: none;">é€‰æ‹©æ–‡ä»¶</button>
                        <input type="file" class="param-file" style="display: none;" onchange="handleFileSelect(this)">
                        <span class="file-name"></span>
                      </div>
                    </td>
                    <td>
                      <select class="param-type" onchange="handleFormDataTypeChange(this)">
                        <option value="string">string</option>
                        <option value="integer">integer</option>
                        <option value="boolean">boolean</option>
                        <option value="number">number</option>
                        <option value="file">file</option>
                        <option value="array">array</option>
                      </select>
                    </td>
                    <td><input type="text" placeholder="è¯´æ˜" class="param-desc"></td>
                    <td><button class="remove-btn" onclick="removeParamRow(this)">åˆ é™¤</button></td>
                  </tr>
                </tbody>
              </table>
              <div class="action-buttons">
                <button class="add-param-btn" onclick="addFormDataRow()">æ·»åŠ å‚æ•°</button>
                <button class="batch-edit-btn" onclick="openBatchEditModal('form-data')">
                  <span>â‹¯</span>
                  <span>æ‰¹é‡ç¼–è¾‘</span>
                </button>
              </div>
            </div>

            <div id="bodyXForm" style="display: none;">
              <h3 style="margin-bottom: 15px; font-size: 16px; color: #495057;">x-www-form-urlencoded</h3>
              <table class="params-table">
                <thead>
                  <tr>
                    <th style="width: 30px;"></th>
                    <th>å‚æ•°å</th>
                    <th>å‚æ•°å€¼</th>
                    <th>ç±»å‹</th>
                    <th>è¯´æ˜</th>
                    <th style="width: 80px;"></th>
                  </tr>
                </thead>
                <tbody id="xFormTableBody">
                  <tr>
                    <td><input type="checkbox" class="param-checkbox" checked></td>
                    <td><input type="text" placeholder="å‚æ•°å" class="param-key"></td>
                    <td><input type="text" placeholder="å‚æ•°å€¼" class="param-value"></td>
                    <td>
                      <select class="param-type">
                        <option value="string">string</option>
                        <option value="integer">integer</option>
                        <option value="boolean">boolean</option>
                        <option value="number">number</option>
                      </select>
                    </td>
                    <td><input type="text" placeholder="è¯´æ˜" class="param-desc"></td>
                    <td><button class="remove-btn" onclick="removeParamRow(this)">åˆ é™¤</button></td>
                  </tr>
                </tbody>
              </table>
              <div class="action-buttons">
                <button class="add-param-btn" onclick="addXFormRow()">æ·»åŠ å‚æ•°</button>
                <button class="batch-edit-btn" onclick="openBatchEditModal('x-form')">
                  <span>â‹¯</span>
                  <span>æ‰¹é‡ç¼–è¾‘</span>
                </button>
              </div>
            </div>

            <div id="bodyJson" style="display: none;">
              <textarea class="textarea-body" id="jsonBody" placeholder='{"key": "value"}'></textarea>
            </div>

            <div id="bodyText" style="display: none;">
              <textarea class="textarea-body" id="textBody" placeholder="è¾“å…¥æ–‡æœ¬å†…å®¹"></textarea>
            </div>
          </div>
        </div>

        <!-- Headers æ ‡ç­¾é¡µ -->
        <div class="tab-panel" id="headersPanel">
          <h3 style="margin-bottom: 15px; font-size: 16px; color: #495057;">è¯·æ±‚å¤´</h3>
          <table class="params-table">
            <thead>
              <tr>
                <th style="width: 30px;"></th>
                <th>Key</th>
                <th>Value</th>
                <th>è¯´æ˜</th>
                <th style="width: 80px;"></th>
              </tr>
            </thead>
            <tbody id="headersTableBody">
              <tr>
                <td><input type="checkbox" class="param-checkbox" checked></td>
                <td><input type="text" placeholder="Key" class="header-key" value="Content-Type"></td>
                <td><input type="text" placeholder="Value" class="header-value" value="application/json"></td>
                <td><input type="text" placeholder="è¯´æ˜" class="header-desc"></td>
                <td><button class="remove-btn" onclick="removeHeaderRow(this)">åˆ é™¤</button></td>
              </tr>
            </tbody>
          </table>
          <div class="action-buttons">
            <button class="add-param-btn" onclick="addHeaderRow()">æ·»åŠ è¯·æ±‚å¤´</button>
            <button class="batch-edit-btn" onclick="openBatchEditModal('headers')">
              <span>â‹¯</span>
              <span>æ‰¹é‡ç¼–è¾‘</span>
            </button>
          </div>
        </div>

      </div>

      <!-- å“åº”åŒºåŸŸ -->
      <div class="response-section">
        <div class="response-header">
          <h3>è¿”å›å“åº”</h3>
          <div class="response-status">
            <span>æ ¡éªŒå“åº”</span>
            <label style="display: flex; align-items: center; gap: 5px;">
              <input type="checkbox" id="validateResponse">
            </label>
            <span class="status-badge status-success" id="responseStatusBadge">æˆåŠŸ (200)</span>
          </div>
        </div>
        <div class="response-body" id="responseBody">
          <div class="empty-response">
            <div class="empty-response-icon">ğŸš€</div>
            <div>ç‚¹å‡»"å‘é€"æŒ‰é’®è·å–è¿”å›ç»“æœ</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- æ‰¹é‡ç¼–è¾‘å¼¹çª— -->
  <div class="modal" id="batchEditModal">
    <div class="modal-content">
      <div class="modal-header">
        <h3>æ‰¹é‡ç¼–è¾‘</h3>
        <button class="modal-close" onclick="closeBatchEditModal()">&times;</button>
      </div>
      <div class="modal-body">
        <div class="batch-mode-tabs">
          <button class="batch-mode-tab active" data-mode="comma">é€—å·æ¨¡å¼</button>
          <button class="batch-mode-tab" data-mode="colon">å†’å·æ¨¡å¼</button>
        </div>
        <div class="batch-format-hint" id="formatHint">
          æ ¼å¼: å¯ç”¨,å‚æ•°å,å‚æ•°å€¼,ç±»å‹,å¿…éœ€,Content-Type,è¯´æ˜<br>
          æ•°æ®æ ¼å¼éµå¾ªã€Šæ ‡å‡† CSV è§„èŒƒã€‹å­—æ®µä¹‹é—´ä»¥è‹±æ–‡é€—å·(,)åˆ†éš”,å¤šæ¡è®°å½•ä»¥æ¢è¡Œåˆ†éš”
        </div>
        <textarea class="batch-textarea" id="batchEditInput" placeholder="è¾“å…¥æ‰¹é‡æ•°æ®..."></textarea>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="closeBatchEditModal()">å–æ¶ˆ</button>
        <button class="btn btn-primary" onclick="applyBatchEdit()">ç¡®å®š</button>
      </div>
    </div>
  </div>

  <script>
    let currentBatchType = 'params';
    let currentBodyType = 'none';

    // åˆå§‹åŒ–ï¼šæ˜¾ç¤º body none å†…å®¹
    window.addEventListener('DOMContentLoaded', () => {
      showBodyContent('none');
    });

    // ç¡®ä¿åœ¨é¡µé¢åŠ è½½ååˆå§‹åŒ–
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', () => {
        showBodyContent('none');
      });
    } else {
      showBodyContent('none');
    }

    // æ ‡ç­¾é¡µåˆ‡æ¢
    document.querySelectorAll('.main-tab').forEach(tab => {
      tab.addEventListener('click', () => {
        const tabName = tab.dataset.tab;
        document.querySelectorAll('.main-tab').forEach(t => t.classList.remove('active'));
        document.querySelectorAll('.tab-panel').forEach(p => p.classList.remove('active'));
        tab.classList.add('active');
        const panel = document.getElementById(tabName + 'Panel');
        if (panel) {
          panel.classList.add('active');

          // å¦‚æœæ˜¯ body æ ‡ç­¾é¡µï¼Œç¡®ä¿æ˜¾ç¤º body å†…å®¹
          if (tabName === 'body') {
            // ä½¿ç”¨ setTimeout ç¡®ä¿ DOM æ›´æ–°åå†æ˜¾ç¤ºå†…å®¹
            setTimeout(() => {
              showBodyContent(currentBodyType);
            }, 0);
          }
        }
      });
    });

    function showBodyContent(bodyType) {
      // éšè—æ‰€æœ‰ body å†…å®¹
      const bodyNone = document.getElementById('bodyNone');
      const bodyFormData = document.getElementById('bodyFormData');
      const bodyXForm = document.getElementById('bodyXForm');
      const bodyJson = document.getElementById('bodyJson');
      const bodyText = document.getElementById('bodyText');

      // éšè—æ‰€æœ‰
      if (bodyNone) bodyNone.style.display = 'none';
      if (bodyFormData) bodyFormData.style.display = 'none';
      if (bodyXForm) bodyXForm.style.display = 'none';
      if (bodyJson) bodyJson.style.display = 'none';
      if (bodyText) bodyText.style.display = 'none';

      // æ˜¾ç¤ºå¯¹åº”çš„ body å†…å®¹
      if (bodyType === 'none') {
        if (bodyNone) bodyNone.style.display = 'block';
      } else if (bodyType === 'form-data') {
        if (bodyFormData) bodyFormData.style.display = 'block';
      } else if (bodyType === 'x-www-form-urlencoded') {
        if (bodyXForm) bodyXForm.style.display = 'block';
      } else if (bodyType === 'json') {
        if (bodyJson) bodyJson.style.display = 'block';
      } else if (bodyType === 'text' || bodyType === 'xml' || bodyType === 'binary' || bodyType === 'graphql' || bodyType === 'msgpack') {
        if (bodyText) bodyText.style.display = 'block';
      }
    }

    // Body ç±»å‹åˆ‡æ¢
    document.querySelectorAll('.body-type-tab').forEach(tab => {
      tab.addEventListener('click', () => {
        const bodyType = tab.dataset.bodyType;
        document.querySelectorAll('.body-type-tab').forEach(t => t.classList.remove('active'));
        tab.classList.add('active');
        currentBodyType = bodyType;
        showBodyContent(bodyType);
      });
    });

    // æ‰¹é‡ç¼–è¾‘æ¨¡å¼åˆ‡æ¢
    document.querySelectorAll('.batch-mode-tab').forEach(tab => {
      tab.addEventListener('click', () => {
        document.querySelectorAll('.batch-mode-tab').forEach(t => t.classList.remove('active'));
        tab.classList.add('active');
        const mode = tab.dataset.mode;
        const hint = document.getElementById('formatHint');
        if (mode === 'comma') {
          hint.innerHTML = 'æ ¼å¼: å¯ç”¨,å‚æ•°å,å‚æ•°å€¼,ç±»å‹,å¿…éœ€,Content-Type,è¯´æ˜<br>æ•°æ®æ ¼å¼éµå¾ªã€Šæ ‡å‡† CSV è§„èŒƒã€‹å­—æ®µä¹‹é—´ä»¥è‹±æ–‡é€—å·(,)åˆ†éš”,å¤šæ¡è®°å½•ä»¥æ¢è¡Œåˆ†éš”';
        } else {
          hint.innerHTML = 'æ ¼å¼: å‚æ•°å:å‚æ•°å€¼<br>æ¯è¡Œä¸€ä¸ªå‚æ•°ï¼Œå‚æ•°åå’Œå‚æ•°å€¼ç”¨å†’å·åˆ†éš”';
        }
      });
    });

    // å‚æ•°è¡Œç®¡ç†
    function addParamRow() {
      const tbody = document.getElementById('paramsTableBody');
      const row = createParamRow();
      tbody.appendChild(row);
    }

    function addFormDataRow() {
      const tbody = document.getElementById('formDataTableBody');
      const row = createFormDataRow();
      tbody.appendChild(row);
    }

    function createParamRow() {
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td><input type="checkbox" class="param-checkbox" checked></td>
        <td><input type="text" placeholder="å‚æ•°å" class="param-key"></td>
        <td><input type="text" placeholder="å‚æ•°å€¼" class="param-value"></td>
        <td>
          <select class="param-type">
            <option value="text">Text</option>
            <option value="number">Number</option>
            <option value="boolean">Boolean</option>
          </select>
        </td>
        <td><input type="text" placeholder="è¯´æ˜" class="param-desc"></td>
        <td><button class="remove-btn" onclick="removeParamRow(this)">åˆ é™¤</button></td>
      `;
      return tr;
    }

    function createFormDataRow() {
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td><input type="checkbox" class="param-checkbox" checked></td>
        <td><input type="text" placeholder="å‚æ•°å" class="param-key"></td>
        <td>
          <div class="file-input-wrapper">
            <input type="text" placeholder="å‚æ•°å€¼" class="param-value">
            <button class="file-select-btn" onclick="selectFile(this)" style="display: none;">é€‰æ‹©æ–‡ä»¶</button>
            <input type="file" class="param-file" style="display: none;" onchange="handleFileSelect(this)">
            <span class="file-name"></span>
          </div>
        </td>
        <td>
          <select class="param-type" onchange="handleFormDataTypeChange(this)">
            <option value="string">string</option>
            <option value="integer">integer</option>
            <option value="boolean">boolean</option>
            <option value="number">number</option>
            <option value="file">file</option>
            <option value="array">array</option>
          </select>
        </td>
        <td><input type="text" placeholder="è¯´æ˜" class="param-desc"></td>
        <td><button class="remove-btn" onclick="removeParamRow(this)">åˆ é™¤</button></td>
      `;
      return tr;
    }

    function addXFormRow() {
      const tbody = document.getElementById('xFormTableBody');
      const row = createXFormRow();
      tbody.appendChild(row);
    }

    function createXFormRow() {
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td><input type="checkbox" class="param-checkbox" checked></td>
        <td><input type="text" placeholder="å‚æ•°å" class="param-key"></td>
        <td><input type="text" placeholder="å‚æ•°å€¼" class="param-value"></td>
        <td>
          <select class="param-type">
            <option value="string">string</option>
            <option value="integer">integer</option>
            <option value="boolean">boolean</option>
            <option value="number">number</option>
          </select>
        </td>
        <td><input type="text" placeholder="è¯´æ˜" class="param-desc"></td>
        <td><button class="remove-btn" onclick="removeParamRow(this)">åˆ é™¤</button></td>
      `;
      return tr;
    }

    function handleFormDataTypeChange(select) {
      const row = select.closest('tr');
      const valueCell = row.querySelector('td:nth-child(3)');
      const wrapper = valueCell.querySelector('.file-input-wrapper');
      const fileBtn = wrapper?.querySelector('.file-select-btn');

      if (select.value === 'file') {
        if (fileBtn) {
          fileBtn.style.display = 'inline-block';
        } else {
          valueCell.innerHTML = `
            <div class="file-input-wrapper">
              <input type="text" placeholder="å‚æ•°å€¼" class="param-value" readonly>
              <button class="file-select-btn" onclick="selectFile(this)">é€‰æ‹©æ–‡ä»¶</button>
              <input type="file" class="param-file" style="display: none;" onchange="handleFileSelect(this)">
              <span class="file-name"></span>
            </div>
          `;
        }
      } else {
        if (fileBtn) {
          fileBtn.style.display = 'none';
          const valueInput = wrapper.querySelector('.param-value');
          if (valueInput) {
            valueInput.readOnly = false;
            valueInput.placeholder = 'å‚æ•°å€¼';
          }
        }
      }
    }

    function removeParamRow(btn) {
      btn.closest('tr').remove();
    }

    function selectFile(btn) {
      const fileInput = btn.nextElementSibling;
      fileInput.click();
    }

    function handleFileSelect(input) {
      const file = input.files[0];
      if (file) {
        const wrapper = input.closest('.file-input-wrapper');
        const fileName = wrapper.querySelector('.file-name');
        fileName.textContent = file.name;
        const valueInput = wrapper.querySelector('.param-value');
        valueInput.value = file.name;
        // è®¾ç½®ç±»å‹ä¸º file
        const typeSelect = input.closest('tr').querySelector('.param-type');
        typeSelect.value = 'file';
      }
    }


    // è¯·æ±‚å¤´ç®¡ç†
    function addHeaderRow() {
      const tbody = document.getElementById('headersTableBody');
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td><input type="checkbox" class="param-checkbox" checked></td>
        <td><input type="text" placeholder="Key" class="header-key"></td>
        <td><input type="text" placeholder="Value" class="header-value"></td>
        <td><input type="text" placeholder="è¯´æ˜" class="header-desc"></td>
        <td><button class="remove-btn" onclick="removeHeaderRow(this)">åˆ é™¤</button></td>
      `;
      tbody.appendChild(tr);
    }

    function removeHeaderRow(btn) {
      btn.closest('tr').remove();
    }

    // æ‰¹é‡ç¼–è¾‘
    function openBatchEditModal(type) {
      currentBatchType = type;
      const modal = document.getElementById('batchEditModal');
      modal.classList.add('active');
      exportBatchData();
    }

    function closeBatchEditModal() {
      const modal = document.getElementById('batchEditModal');
      modal.classList.remove('active');
    }

    function exportBatchData() {
      const input = document.getElementById('batchEditInput');
      let lines = [];

      if (currentBatchType === 'params') {
        document.querySelectorAll('#paramsTableBody tr').forEach(row => {
          const checkbox = row.querySelector('.param-checkbox');
          const key = row.querySelector('.param-key').value.trim();
          const value = row.querySelector('.param-value').value.trim();
          const type = row.querySelector('.param-type').value;
          const desc = row.querySelector('.param-desc').value.trim();
          if (key && value) {
            lines.push(`${checkbox.checked ? '1' : '0'},${key},${value},${type},,${desc}`);
          }
        });
      } else if (currentBatchType === 'form-data') {
        document.querySelectorAll('#formDataTableBody tr').forEach(row => {
          const checkbox = row.querySelector('.param-checkbox');
          const key = row.querySelector('.param-key').value.trim();
          const valueInput = row.querySelector('.param-value');
          const value = valueInput ? valueInput.value.trim() : '';
          const type = row.querySelector('.param-type').value;
          const desc = row.querySelector('.param-desc').value.trim();
          if (key) {
            lines.push(`${checkbox.checked ? '1' : '0'},${key},${value},${type},,${desc}`);
          }
        });
      } else if (currentBatchType === 'x-form') {
        document.querySelectorAll('#xFormTableBody tr').forEach(row => {
          const checkbox = row.querySelector('.param-checkbox');
          const key = row.querySelector('.param-key').value.trim();
          const value = row.querySelector('.param-value').value.trim();
          const type = row.querySelector('.param-type').value;
          const desc = row.querySelector('.param-desc').value.trim();
          if (key && value) {
            lines.push(`${checkbox.checked ? '1' : '0'},${key},${value},${type},,${desc}`);
          }
        });
      } else if (currentBatchType === 'headers') {
        document.querySelectorAll('#headersTableBody tr').forEach(row => {
          const checkbox = row.querySelector('.param-checkbox');
          const key = row.querySelector('.header-key').value.trim();
          const value = row.querySelector('.header-value').value.trim();
          const desc = row.querySelector('.header-desc').value.trim();
          if (key && value) {
            lines.push(`${checkbox.checked ? '1' : '0'},${key},${value},,,${desc}`);
          }
        });
      }

      input.value = lines.join('\n');
    }

    function applyBatchEdit() {
      const input = document.getElementById('batchEditInput').value.trim();
      if (!input) {
        alert('è¯·è¾“å…¥è¦å¯¼å…¥çš„æ•°æ®');
        return;
      }

      const mode = document.querySelector('.batch-mode-tab.active').dataset.mode;
      const lines = input.split('\n').filter(line => line.trim());

      if (currentBatchType === 'params') {
        const tbody = document.getElementById('paramsTableBody');
        tbody.innerHTML = '';
        lines.forEach(line => {
          if (mode === 'comma') {
            const parts = line.split(',');
            if (parts.length >= 3) {
              const row = createParamRow();
              row.querySelector('.param-checkbox').checked = parts[0] === '1';
              row.querySelector('.param-key').value = parts[1] || '';
              row.querySelector('.param-value').value = parts[2] || '';
              if (parts[3]) row.querySelector('.param-type').value = parts[3];
              if (parts[6]) row.querySelector('.param-desc').value = parts[6];
              tbody.appendChild(row);
            }
          } else {
            const [key, value] = line.split(':').map(s => s.trim());
            if (key && value) {
              const row = createParamRow();
              row.querySelector('.param-key').value = key;
              row.querySelector('.param-value').value = value;
              tbody.appendChild(row);
            }
          }
        });
      } else if (currentBatchType === 'form-data') {
        const tbody = document.getElementById('formDataTableBody');
        tbody.innerHTML = '';
        lines.forEach(line => {
          if (mode === 'comma') {
            const parts = line.split(',');
            if (parts.length >= 3) {
              const row = createFormDataRow();
              row.querySelector('.param-checkbox').checked = parts[0] === '1';
              row.querySelector('.param-key').value = parts[1] || '';
              row.querySelector('.param-value').value = parts[2] || '';
              if (parts[3]) {
                row.querySelector('.param-type').value = parts[3];
                handleFormDataTypeChange(row.querySelector('.param-type'));
              }
              if (parts[6]) row.querySelector('.param-desc').value = parts[6];
              tbody.appendChild(row);
            }
          } else {
            const [key, value] = line.split(':').map(s => s.trim());
            if (key && value) {
              const row = createFormDataRow();
              row.querySelector('.param-key').value = key;
              row.querySelector('.param-value').value = value;
              tbody.appendChild(row);
            }
          }
        });
      } else if (currentBatchType === 'x-form') {
        const tbody = document.getElementById('xFormTableBody');
        tbody.innerHTML = '';
        lines.forEach(line => {
          if (mode === 'comma') {
            const parts = line.split(',');
            if (parts.length >= 3) {
              const row = createXFormRow();
              row.querySelector('.param-checkbox').checked = parts[0] === '1';
              row.querySelector('.param-key').value = parts[1] || '';
              row.querySelector('.param-value').value = parts[2] || '';
              if (parts[3]) row.querySelector('.param-type').value = parts[3];
              if (parts[6]) row.querySelector('.param-desc').value = parts[6];
              tbody.appendChild(row);
            }
          } else {
            const [key, value] = line.split(':').map(s => s.trim());
            if (key && value) {
              const row = createXFormRow();
              row.querySelector('.param-key').value = key;
              row.querySelector('.param-value').value = value;
              tbody.appendChild(row);
            }
          }
        });
      } else if (currentBatchType === 'headers') {
        const tbody = document.getElementById('headersTableBody');
        tbody.innerHTML = '';
        lines.forEach(line => {
          if (mode === 'comma') {
            const parts = line.split(',');
            if (parts.length >= 3) {
              const tr = document.createElement('tr');
              tr.innerHTML = `
                <td><input type="checkbox" class="param-checkbox" ${parts[0] === '1' ? 'checked' : ''}></td>
                <td><input type="text" placeholder="Key" class="header-key" value="${parts[1] || ''}"></td>
                <td><input type="text" placeholder="Value" class="header-value" value="${parts[2] || ''}"></td>
                <td><input type="text" placeholder="è¯´æ˜" class="header-desc" value="${parts[6] || ''}"></td>
                <td><button class="remove-btn" onclick="removeHeaderRow(this)">åˆ é™¤</button></td>
              `;
              tbody.appendChild(tr);
            }
          } else {
            const [key, value] = line.split(':').map(s => s.trim());
            if (key && value) {
              const tr = document.createElement('tr');
              tr.innerHTML = `
                <td><input type="checkbox" class="param-checkbox" checked></td>
                <td><input type="text" placeholder="Key" class="header-key" value="${key}"></td>
                <td><input type="text" placeholder="Value" class="header-value" value="${value}"></td>
                <td><input type="text" placeholder="è¯´æ˜" class="header-desc"></td>
                <td><button class="remove-btn" onclick="removeHeaderRow(this)">åˆ é™¤</button></td>
              `;
              tbody.appendChild(tr);
            }
          }
        });
      }

      closeBatchEditModal();
    }

    // ç‚¹å‡»å¼¹çª—å¤–éƒ¨å…³é—­
    document.getElementById('batchEditModal').addEventListener('click', (e) => {
      if (e.target.id === 'batchEditModal') {
        closeBatchEditModal();
      }
    });

    // å†å²è®°å½•
    let requestHistory = JSON.parse(localStorage.getItem('apiDebuggerHistory') || '[]');

    document.getElementById('historyBtn').addEventListener('click', () => {
      showHistoryModal();
    });

    function showHistoryModal() {
      const modal = document.createElement('div');
      modal.className = 'modal active';
      modal.innerHTML = `
        <div class="modal-content" style="max-width: 800px;">
          <div class="modal-header">
            <h3>å†å²è®°å½•</h3>
            <button class="modal-close" onclick="this.closest('.modal').remove()">&times;</button>
          </div>
          <div class="modal-body" style="max-height: 500px; overflow-y: auto;">
            ${requestHistory.length === 0 ? '<p style="text-align: center; color: #6c757d; padding: 40px;">æš‚æ— å†å²è®°å½•</p>' : ''}
            ${requestHistory.map((item, index) => `
              <div style="padding: 15px; margin-bottom: 10px; background: #f8f9fa; border-radius: 8px; border-left: 3px solid #667eea; cursor: pointer;" onclick="loadHistoryItem(${index})">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                  <span style="display: inline-block; padding: 4px 12px; background: ${getMethodColor(item.method)}; color: #fff; border-radius: 4px; font-size: 12px; font-weight: 600;">${item.method}</span>
                  <span style="font-size: 11px; color: #6c757d;">${new Date(item.timestamp).toLocaleString()}</span>
                </div>
                <div style="font-size: 13px; color: #495057; margin-bottom: 5px;">${item.url}</div>
                <div style="font-size: 12px; color: #6c757d;">çŠ¶æ€: ${item.status} ${item.statusText || ''}</div>
              </div>
            `).join('')}
          </div>
          <div class="modal-footer">
            <button class="btn btn-secondary" onclick="clearHistory()">æ¸…ç©ºå†å²</button>
            <button class="btn btn-primary" onclick="this.closest('.modal').remove()">å…³é—­</button>
          </div>
        </div>
      `;
      document.body.appendChild(modal);
      modal.addEventListener('click', (e) => {
        if (e.target === modal) {
          modal.remove();
        }
      });
    }

    function getMethodColor(method) {
      const colors = {
        'GET': '#07C160',
        'POST': '#1677FF',
        'PUT': '#FFA500',
        'DELETE': '#FF0050',
        'PATCH': '#FFA500'
      };
      return colors[method] || '#6c757d';
    }

    function loadHistoryItem(index) {
      const item = requestHistory[index];
      document.getElementById('httpMethod').value = item.method;
      document.getElementById('httpUrl').value = item.url;
      document.querySelector('.modal.active')?.remove();
    }

    function clearHistory() {
      if (confirm('ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰å†å²è®°å½•å—ï¼Ÿ')) {
        requestHistory = [];
        localStorage.setItem('apiDebuggerHistory', JSON.stringify(requestHistory));
        document.querySelector('.modal.active')?.remove();
        showHistoryModal();
      }
    }

    // å‘é€è¯·æ±‚
    document.getElementById('sendBtn').addEventListener('click', async () => {
      const method = document.getElementById('httpMethod').value;
      let url = document.getElementById('httpUrl').value.trim();

      if (!url) {
        alert('è¯·è¾“å…¥æ¥å£è·¯å¾„');
        return;
      }

      // Headers æ˜¯å¿…é¡»çš„ï¼Œå§‹ç»ˆè·å–
      const headers = {};
      document.querySelectorAll('#headersTableBody tr').forEach(row => {
        const checkbox = row.querySelector('.param-checkbox');
        if (!checkbox.checked) return;
        const key = row.querySelector('.header-key').value.trim();
        const value = row.querySelector('.header-value').value.trim();
        if (key && value) {
          headers[key] = value;
        }
      });

      const requestConfig = {
        method: method,
        headers: headers
      };

      // åˆ¤æ–­å½“å‰é€‰ä¸­çš„æ ‡ç­¾é¡µ
      const activeTab = document.querySelector('.main-tab.active').dataset.tab;

      // å¤„ç† Query å‚æ•°ï¼ˆåªåœ¨ Params æ ‡ç­¾é¡µæ—¶ï¼Œæˆ– Body æ ‡ç­¾é¡µé€‰æ‹© none æ—¶ï¼‰
      if (activeTab === 'params' || (activeTab === 'body' && currentBodyType === 'none')) {
        try {
          const baseUrl = url.startsWith('http') ? url : (url.startsWith('/') ? 'https://example.com' + url : 'https://example.com/' + url);
          const urlObj = new URL(baseUrl);
          document.querySelectorAll('#paramsTableBody tr').forEach(row => {
            const checkbox = row.querySelector('.param-checkbox');
            if (!checkbox.checked) return;
            const key = row.querySelector('.param-key').value.trim();
            const value = row.querySelector('.param-value').value.trim();
            if (key && value) {
              urlObj.searchParams.append(key, value);
            }
          });
          url = url.startsWith('http') ? urlObj.toString() : urlObj.pathname + urlObj.search;
        } catch (e) {
          // URL è§£æå¤±è´¥ï¼Œä½¿ç”¨åŸå§‹ URL
          console.warn('URL è§£æå¤±è´¥:', e);
        }
      }

      // å¦‚æœé€‰ä¸­çš„æ˜¯ Body æ ‡ç­¾é¡µä¸”ä¸æ˜¯ noneï¼Œå¤„ç† Body
      if (activeTab === 'body' && currentBodyType !== 'none') {
        if (currentBodyType === 'form-data') {
          const formData = new FormData();
          document.querySelectorAll('#formDataTableBody tr').forEach(row => {
            const checkbox = row.querySelector('.param-checkbox');
            if (!checkbox.checked) return;
            const key = row.querySelector('.param-key').value.trim();
            const type = row.querySelector('.param-type').value;
            if (!key) return;

            if (type === 'file') {
              const fileInput = row.querySelector('.param-file');
              if (fileInput && fileInput.files.length > 0) {
                formData.append(key, fileInput.files[0]);
              }
            } else {
              const value = row.querySelector('.param-value').value.trim();
              formData.append(key, value);
            }
          });
          requestConfig.body = formData;
          delete requestConfig.headers['Content-Type'];
        } else if (currentBodyType === 'json') {
          const jsonBody = document.getElementById('jsonBody').value.trim();
          if (jsonBody) {
            try {
              JSON.parse(jsonBody);
              requestConfig.body = jsonBody;
            } catch (e) {
              alert('JSON æ ¼å¼é”™è¯¯ï¼š' + e.message);
              return;
            }
          }
        } else if (currentBodyType === 'text') {
          const textBody = document.getElementById('textBody').value.trim();
          if (textBody) {
            requestConfig.body = textBody;
          }
        } else if (currentBodyType === 'x-www-form-urlencoded') {
          const formData = new URLSearchParams();
          document.querySelectorAll('#xFormTableBody tr').forEach(row => {
            const checkbox = row.querySelector('.param-checkbox');
            if (!checkbox.checked) return;
            const key = row.querySelector('.param-key').value.trim();
            const value = row.querySelector('.param-value').value.trim();
            if (key && value) {
              formData.append(key, value);
            }
          });
          requestConfig.body = formData.toString();
          if (!requestConfig.headers['Content-Type']) {
            requestConfig.headers['Content-Type'] = 'application/x-www-form-urlencoded';
          }
        }
      }

      // ç¡®ä¿ URL æ ¼å¼æ­£ç¡®
      let finalUrl = url;
      if (!url.startsWith('http://') && !url.startsWith('https://')) {
        if (url.startsWith('/')) {
          finalUrl = 'https://example.com' + url;
        } else {
          finalUrl = 'https://' + url;
        }
      }

      try {
        const startTime = Date.now();
        const response = await fetch(finalUrl, requestConfig);
        const duration = Date.now() - startTime;

        // ä¿å­˜åˆ°å†å²
        const historyItem = {
          method,
          url: finalUrl,
          timestamp: new Date().toISOString(),
          status: response.status,
          statusText: response.statusText
        };
        requestHistory.unshift(historyItem);
        if (requestHistory.length > 50) requestHistory.pop();
        localStorage.setItem('apiDebuggerHistory', JSON.stringify(requestHistory));

        const responseHeaders = {};
        response.headers.forEach((value, key) => {
          responseHeaders[key] = value;
        });

        let responseBody = '';
        const contentType = response.headers.get('content-type') || '';
        if (contentType.includes('application/json')) {
          try {
            const json = await response.json();
            responseBody = JSON.stringify(json, null, 2);
          } catch (e) {
            responseBody = await response.text();
          }
        } else {
          responseBody = await response.text();
        }

        displayResponse(response.status, response.statusText, responseHeaders, responseBody, duration);
      } catch (error) {
        const duration = Date.now() - startTime;
        displayResponse(0, 'Error', {}, 'è¯·æ±‚å¤±è´¥ï¼š' + error.message + '\n\né”™è¯¯è¯¦æƒ…ï¼š\n' + (error.stack || ''), duration);
      }
    });

    function displayResponse(status, statusText, headers, body, duration) {
      const responseBody = document.getElementById('responseBody');
      const statusBadge = document.getElementById('responseStatusBadge');

      if (status >= 200 && status < 300) {
        statusBadge.className = 'status-badge status-success';
        statusBadge.textContent = `æˆåŠŸ (${status})`;
        responseBody.style.color = '';
      } else if (status >= 400) {
        statusBadge.className = 'status-badge';
        statusBadge.style.background = '#f8d7da';
        statusBadge.style.color = '#721c24';
        statusBadge.textContent = `é”™è¯¯ (${status})`;
        responseBody.style.color = '#dc3545';
      } else if (status === 0) {
        statusBadge.className = 'status-badge';
        statusBadge.style.background = '#f8d7da';
        statusBadge.style.color = '#721c24';
        statusBadge.textContent = 'Error';
        responseBody.style.color = '#dc3545';
      } else {
        statusBadge.className = 'status-badge';
        statusBadge.style.background = '#e2e3e5';
        statusBadge.style.color = '#383d41';
        statusBadge.textContent = status ? `${status} ${statusText}` : 'Error';
        responseBody.style.color = '';
      }

      let html = '';
      if (Object.keys(headers).length > 0) {
        html += '<div style="margin-bottom: 15px; padding-bottom: 15px; border-bottom: 1px solid #dee2e6;"><strong style="font-size: 14px; color: #495057;">å“åº”å¤´ï¼š</strong><br>';
        Object.entries(headers).forEach(([key, value]) => {
          html += `<div style="font-size: 12px; color: #6c757d; margin: 5px 0;">${key}: ${value}</div>`;
        });
        html += '</div>';
      }
      html += `<div style="margin-top: 15px;">${body ? body.replace(/</g, '&lt;').replace(/>/g, '&gt;') : '(æ— å“åº”ä½“)'}</div>`;

      responseBody.innerHTML = html;
    }
  </script>
  <script src="./tools.js"></script>
</body>

</html>