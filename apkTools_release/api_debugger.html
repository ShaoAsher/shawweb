<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>API è°ƒè¯•å·¥å…·</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px
    }

    .container {
      max-width: 1600px;
      margin: 0 auto;
      background: #fff;
      border-radius: 16px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, .3);
      overflow: hidden;
      display: flex;
      flex-direction: column;
      height: calc(100vh - 40px)
    }

    .header {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: #fff;
      padding: 20px 30px;
      text-align: center;
      flex-shrink: 0
    }

    .header h1 {
      font-size: 24px;
      margin-bottom: 5px
    }

    .header p {
      opacity: .9;
      font-size: 13px
    }

    .main-content {
      flex: 1;
      display: flex;
      flex-direction: column;
      overflow: hidden
    }

    .request-section {
      flex: 1;
      display: flex;
      flex-direction: column;
      overflow: hidden;
      border-bottom: 2px solid #dee2e6
    }

    .request-toolbar {
      padding: 15px 20px;
      background: #f8f9fa;
      border-bottom: 1px solid #dee2e6;
      display: flex;
      gap: 10px;
      align-items: center;
      flex-shrink: 0
    }

    .method-select {
      padding: 10px 15px;
      background: linear-gradient(135deg, #07C160 0%, #42BD56 100%);
      color: #fff;
      border: none;
      border-radius: 8px;
      font-weight: 600;
      font-size: 14px;
      cursor: pointer;
      min-width: 80px;
      position: relative
    }

    .method-select::after {
      content: 'â–¼';
      margin-left: 8px;
      font-size: 10px
    }

    .url-input {
      flex: 1;
      padding: 10px 15px;
      border: 2px solid #dee2e6;
      border-radius: 8px;
      font-size: 14px;
      font-family: 'Courier New', monospace
    }

    .url-input:focus {
      outline: none;
      border-color: #667eea
    }

    .toolbar-buttons {
      display: flex;
      gap: 10px
    }

    .btn {
      padding: 10px 20px;
      border: none;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all .2s
    }

    .btn-primary {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: #fff
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(102, 126, 234, .4)
    }

    .btn-secondary {
      background: #6c757d;
      color: #fff
    }

    .tabs-container {
      background: #fff;
      border-bottom: 1px solid #dee2e6;
      flex-shrink: 0
    }

    .main-tabs {
      display: flex;
      gap: 0;
      padding: 0 20px;
      overflow-x: auto
    }

    .main-tab {
      padding: 12px 20px;
      background: transparent;
      border: none;
      border-bottom: 3px solid transparent;
      cursor: pointer;
      font-size: 14px;
      color: #6c757d;
      transition: all .2s;
      white-space: nowrap
    }

    .main-tab:hover {
      color: #667eea;
      background: #f8f9fa
    }

    .main-tab.active {
      color: #667eea;
      border-bottom-color: #667eea;
      font-weight: 600
    }

    .tab-panel {
      display: none;
      padding: 20px;
      overflow-y: auto;
      flex: 1
    }

    .tab-panel.active {
      display: block
    }

    .body-type-tabs {
      display: flex;
      gap: 5px;
      margin-bottom: 20px;
      padding-bottom: 10px;
      border-bottom: 1px solid #dee2e6;
      overflow-x: auto
    }

    .body-type-tab {
      padding: 8px 16px;
      background: transparent;
      border: none;
      border-bottom: 2px solid transparent;
      cursor: pointer;
      font-size: 13px;
      color: #6c757d;
      transition: all .2s;
      white-space: nowrap
    }

    .body-type-tab:hover {
      color: #667eea
    }

    .body-type-tab.active {
      color: #667eea;
      border-bottom-color: #667eea;
      font-weight: 600
    }

    .params-table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 15px
    }

    .params-table th {
      text-align: left;
      padding: 12px;
      background: #f8f9fa;
      border-bottom: 2px solid #dee2e6;
      font-size: 13px;
      font-weight: 600;
      color: #495057
    }

    .params-table td {
      padding: 10px 12px;
      border-bottom: 1px solid #e9ecef
    }

    .params-table input,
    .params-table select {
      width: 100%;
      padding: 8px;
      border: 1px solid #dee2e6;
      border-radius: 4px;
      font-size: 13px
    }

    .params-table input:focus,
    .params-table select:focus {
      outline: none;
      border-color: #667eea
    }

    .param-checkbox {
      width: 18px;
      height: 18px;
      cursor: pointer
    }

    .file-input-wrapper {
      display: flex;
      gap: 8px;
      align-items: center
    }

    .file-input-wrapper input[type="file"] {
      display: none
    }

    .file-select-btn {
      padding: 6px 12px;
      background: #667eea;
      color: #fff;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 12px;
      white-space: nowrap
    }

    .file-name {
      font-size: 12px;
      color: #6c757d;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
      max-width: 150px
    }

    .action-buttons {
      display: flex;
      gap: 10px;
      align-items: center;
      margin-top: 10px
    }

    .add-param-btn {
      color: #667eea;
      background: none;
      border: none;
      cursor: pointer;
      font-size: 13px;
      text-decoration: underline;
      padding: 5px
    }

    .batch-edit-btn {
      display: flex;
      gap: 5px;
      align-items: center;
      color: #6c757d;
      background: none;
      border: none;
      cursor: pointer;
      font-size: 12px;
      padding: 5px
    }

    .batch-edit-btn:hover {
      color: #667eea
    }

    .response-section {
      flex: 1;
      display: flex;
      flex-direction: column;
      overflow: hidden;
      background: #f8f9fa
    }

    .response-header {
      padding: 15px 20px;
      background: #fff;
      border-bottom: 1px solid #dee2e6;
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-shrink: 0
    }

    .response-header h3 {
      font-size: 16px;
      color: #495057
    }

    .response-status {
      display: flex;
      gap: 15px;
      align-items: center
    }

    .status-badge {
      padding: 6px 12px;
      border-radius: 6px;
      font-size: 13px;
      font-weight: 600
    }

    .status-success {
      background: #d4edda;
      color: #155724
    }

    .response-body {
      flex: 1;
      padding: 20px;
      overflow-y: auto;
      background: #fff;
      font-family: 'Courier New', monospace;
      font-size: 13px;
      white-space: pre-wrap;
      word-break: break-all
    }

    .empty-response {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100%;
      color: #6c757d
    }

    .empty-response-icon {
      font-size: 48px;
      margin-bottom: 15px;
      opacity: .5
    }

    .modal {
      display: none;
      position: fixed;
      z-index: 1000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      align-items: center;
      justify-content: center
    }

    .modal.active {
      display: flex
    }

    .modal-content {
      background: #fff;
      border-radius: 12px;
      padding: 0;
      max-width: 700px;
      width: 90%;
      max-height: 80vh;
      display: flex;
      flex-direction: column;
      box-shadow: 0 20px 60px rgba(0, 0, 0, .3)
    }

    .modal-header {
      padding: 20px 25px;
      border-bottom: 1px solid #dee2e6;
      display: flex;
      justify-content: space-between;
      align-items: center
    }

    .modal-header h3 {
      font-size: 18px;
      color: #495057
    }

    .modal-close {
      background: none;
      border: none;
      font-size: 24px;
      cursor: pointer;
      color: #6c757d;
      width: 30px;
      height: 30px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 4px;
      transition: all .2s
    }

    .modal-close:hover {
      background: #f8f9fa;
      color: #495057
    }

    .modal-body {
      padding: 25px;
      flex: 1;
      overflow-y: auto
    }

    .batch-mode-tabs {
      display: flex;
      gap: 0;
      margin-bottom: 20px;
      border-bottom: 1px solid #dee2e6
    }

    .batch-mode-tab {
      padding: 10px 20px;
      background: transparent;
      border: none;
      border-bottom: 2px solid transparent;
      cursor: pointer;
      font-size: 14px;
      color: #6c757d;
      transition: all .2s
    }

    .batch-mode-tab.active {
      color: #667eea;
      border-bottom-color: #667eea;
      font-weight: 600
    }

    .batch-format-hint {
      background: #f8f9fa;
      padding: 12px;
      border-radius: 6px;
      margin-bottom: 15px;
      font-size: 12px;
      color: #6c757d;
      line-height: 1.6
    }

    .batch-textarea {
      width: 100%;
      min-height: 200px;
      padding: 12px;
      border: 2px solid #dee2e6;
      border-radius: 8px;
      font-family: 'Courier New', monospace;
      font-size: 13px;
      resize: vertical
    }

    .batch-textarea:focus {
      outline: none;
      border-color: #667eea
    }

    .modal-footer {
      padding: 15px 25px;
      border-top: 1px solid #dee2e6;
      display: flex;
      justify-content: flex-end;
      gap: 10px
    }

    .remove-btn {
      background: #dc3545;
      color: #fff;
      border: none;
      padding: 6px 12px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 12px
    }

    .remove-btn:hover {
      background: #c82333
    }

    .textarea-body {
      width: 100%;
      min-height: 200px;
      padding: 12px;
      border: 2px solid #dee2e6;
      border-radius: 8px;
      font-family: 'Courier New', monospace;
      font-size: 13px;
      resize: vertical
    }

    .textarea-body:focus {
      outline: none;
      border-color: #667eea
    }
  </style>
</head>

<body>
  <div class="container">
    <div class="header">
      <h1>ğŸ”§ API è°ƒè¯•å·¥å…·</h1>
      <p>æ”¯æŒ HTTP è¯·æ±‚å’Œ WebSocket (WSS) è¿æ¥è°ƒè¯•</p>
    </div>

    <div class="main-content">
      <!-- è¯·æ±‚åŒºåŸŸ -->
      <div class="request-section">
        <div class="request-toolbar">
          <select class="method-select" id="httpMethod">
            <option value="GET">GET</option>
            <option value="POST">POST</option>
            <option value="PUT">PUT</option>
            <option value="DELETE">DELETE</option>
            <option value="PATCH">PATCH</option>
            <option value="HEAD">HEAD</option>
            <option value="OPTIONS">OPTIONS</option>
          </select>
          <input type="text" class="url-input" id="httpUrl" placeholder='æ¥å£è·¯å¾„, "/"èµ·å§‹'>
          <div class="toolbar-buttons">
            <button class="btn btn-primary" id="sendBtn">å‘é€</button>
            <button class="btn btn-secondary" id="saveBtn">ä¿å­˜</button>
          </div>
        </div>

        <div class="tabs-container">
          <div class="main-tabs">
            <button class="main-tab active" data-tab="params">Params</button>
            <button class="main-tab" data-tab="body">Body</button>
            <button class="main-tab" data-tab="headers">Headers</button>
            <button class="main-tab" data-tab="cookies">Cookies</button>
            <button class="main-tab" data-tab="auth">Auth</button>
            <button class="main-tab" data-tab="pre-script">å‰ç½®æ“ä½œ</button>
            <button class="main-tab" data-tab="post-script">åç½®æ“ä½œ</button>
            <button class="main-tab" data-tab="settings">è®¾ç½®</button>
          </div>
        </div>

        <!-- Params æ ‡ç­¾é¡µ -->
        <div class="tab-panel active" id="paramsPanel">
          <h3 style="margin-bottom: 15px; font-size: 16px; color: #495057;">Query å‚æ•°</h3>
          <table class="params-table">
            <thead>
              <tr>
                <th style="width: 30px;"></th>
                <th>å‚æ•°å</th>
                <th>å‚æ•°å€¼</th>
                <th>ç±»å‹</th>
                <th>è¯´æ˜</th>
                <th style="width: 80px;"></th>
              </tr>
            </thead>
            <tbody id="paramsTableBody">
              <tr>
                <td><input type="checkbox" class="param-checkbox" checked></td>
                <td><input type="text" placeholder="å‚æ•°å" class="param-key"></td>
                <td><input type="text" placeholder="å‚æ•°å€¼" class="param-value"></td>
                <td>
                  <select class="param-type">
                    <option value="text">Text</option>
                    <option value="number">Number</option>
                    <option value="boolean">Boolean</option>
                  </select>
                </td>
                <td><input type="text" placeholder="è¯´æ˜" class="param-desc"></td>
                <td><button class="remove-btn" onclick="removeParamRow(this)">åˆ é™¤</button></td>
              </tr>
            </tbody>
          </table>
          <div class="action-buttons">
            <button class="add-param-btn" onclick="addParamRow()">æ·»åŠ å‚æ•°</button>
            <button class="batch-edit-btn" onclick="openBatchEditModal('params')">
              <span>â‹¯</span>
              <span>æ‰¹é‡ç¼–è¾‘</span>
            </button>
          </div>
        </div>

        <!-- Body æ ‡ç­¾é¡µ -->
        <div class="tab-panel" id="bodyPanel">
          <div class="body-type-tabs">
            <button class="body-type-tab active" data-body-type="none">none</button>
            <button class="body-type-tab" data-body-type="form-data">form-data</button>
            <button class="body-type-tab" data-body-type="x-www-form-urlencoded">x-www-form-urlencoded</button>
            <button class="body-type-tab" data-body-type="json">JSON</button>
            <button class="body-type-tab" data-body-type="xml">XML</button>
            <button class="body-type-tab" data-body-type="text">Text</button>
            <button class="body-type-tab" data-body-type="binary">Binary</button>
            <button class="body-type-tab" data-body-type="graphql">GraphQL</button>
            <button class="body-type-tab" data-body-type="msgpack">msgpack</button>
          </div>

          <div id="bodyContent">
            <div id="bodyNone" style="padding: 40px; text-align: center; color: #6c757d;">
              è¯¥è¯·æ±‚æ²¡æœ‰ Body
            </div>

            <div id="bodyFormData" style="display: none;">
              <h3 style="margin-bottom: 15px; font-size: 16px; color: #495057;">Form Data</h3>
              <table class="params-table">
                <thead>
                  <tr>
                    <th style="width: 30px;"></th>
                    <th>å‚æ•°å</th>
                    <th>å‚æ•°å€¼</th>
                    <th>ç±»å‹</th>
                    <th>è¯´æ˜</th>
                    <th style="width: 80px;"></th>
                  </tr>
                </thead>
                <tbody id="formDataTableBody">
                  <tr>
                    <td><input type="checkbox" class="param-checkbox" checked></td>
                    <td><input type="text" placeholder="å‚æ•°å" class="param-key"></td>
                    <td>
                      <div class="file-input-wrapper">
                        <input type="text" placeholder="å‚æ•°å€¼" class="param-value">
                        <button class="file-select-btn" onclick="selectFile(this)">é€‰æ‹©æ–‡ä»¶</button>
                        <input type="file" class="param-file" style="display: none;" onchange="handleFileSelect(this)">
                        <span class="file-name"></span>
                      </div>
                    </td>
                    <td>
                      <select class="param-type">
                        <option value="text">Text</option>
                        <option value="file">File</option>
                      </select>
                    </td>
                    <td><input type="text" placeholder="è¯´æ˜" class="param-desc"></td>
                    <td><button class="remove-btn" onclick="removeParamRow(this)">åˆ é™¤</button></td>
                  </tr>
                </tbody>
              </table>
              <div class="action-buttons">
                <button class="add-param-btn" onclick="addFormDataRow()">æ·»åŠ å‚æ•°</button>
                <button class="batch-edit-btn" onclick="openBatchEditModal('form-data')">
                  <span>â‹¯</span>
                  <span>æ‰¹é‡ç¼–è¾‘</span>
                </button>
              </div>
            </div>

            <div id="bodyJson" style="display: none;">
              <textarea class="textarea-body" id="jsonBody" placeholder='{"key": "value"}'></textarea>
            </div>

            <div id="bodyText" style="display: none;">
              <textarea class="textarea-body" id="textBody" placeholder="è¾“å…¥æ–‡æœ¬å†…å®¹"></textarea>
            </div>
          </div>
        </div>

        <!-- Headers æ ‡ç­¾é¡µ -->
        <div class="tab-panel" id="headersPanel">
          <h3 style="margin-bottom: 15px; font-size: 16px; color: #495057;">è¯·æ±‚å¤´</h3>
          <table class="params-table">
            <thead>
              <tr>
                <th style="width: 30px;"></th>
                <th>Key</th>
                <th>Value</th>
                <th>è¯´æ˜</th>
                <th style="width: 80px;"></th>
              </tr>
            </thead>
            <tbody id="headersTableBody">
              <tr>
                <td><input type="checkbox" class="param-checkbox" checked></td>
                <td><input type="text" placeholder="Key" class="header-key" value="Content-Type"></td>
                <td><input type="text" placeholder="Value" class="header-value" value="application/json"></td>
                <td><input type="text" placeholder="è¯´æ˜" class="header-desc"></td>
                <td><button class="remove-btn" onclick="removeHeaderRow(this)">åˆ é™¤</button></td>
              </tr>
            </tbody>
          </table>
          <div class="action-buttons">
            <button class="add-param-btn" onclick="addHeaderRow()">æ·»åŠ è¯·æ±‚å¤´</button>
            <button class="batch-edit-btn" onclick="openBatchEditModal('headers')">
              <span>â‹¯</span>
              <span>æ‰¹é‡ç¼–è¾‘</span>
            </button>
          </div>
        </div>

        <!-- å…¶ä»–æ ‡ç­¾é¡µ -->
        <div class="tab-panel" id="cookiesPanel">
          <p style="color: #6c757d; padding: 40px; text-align: center;">Cookies åŠŸèƒ½å¼€å‘ä¸­...</p>
        </div>
        <div class="tab-panel" id="authPanel">
          <p style="color: #6c757d; padding: 40px; text-align: center;">Auth åŠŸèƒ½å¼€å‘ä¸­...</p>
        </div>
        <div class="tab-panel" id="pre-scriptPanel">
          <p style="color: #6c757d; padding: 40px; text-align: center;">å‰ç½®æ“ä½œåŠŸèƒ½å¼€å‘ä¸­...</p>
        </div>
        <div class="tab-panel" id="post-scriptPanel">
          <p style="color: #6c757d; padding: 40px; text-align: center;">åç½®æ“ä½œåŠŸèƒ½å¼€å‘ä¸­...</p>
        </div>
        <div class="tab-panel" id="settingsPanel">
          <p style="color: #6c757d; padding: 40px; text-align: center;">è®¾ç½®åŠŸèƒ½å¼€å‘ä¸­...</p>
        </div>
      </div>

      <!-- å“åº”åŒºåŸŸ -->
      <div class="response-section">
        <div class="response-header">
          <h3>è¿”å›å“åº”</h3>
          <div class="response-status">
            <span>æ ¡éªŒå“åº”</span>
            <label style="display: flex; align-items: center; gap: 5px;">
              <input type="checkbox" id="validateResponse">
            </label>
            <span class="status-badge status-success" id="responseStatusBadge">æˆåŠŸ (200)</span>
          </div>
        </div>
        <div class="response-body" id="responseBody">
          <div class="empty-response">
            <div class="empty-response-icon">ğŸš€</div>
            <div>ç‚¹å‡»"å‘é€"æŒ‰é’®è·å–è¿”å›ç»“æœ</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- æ‰¹é‡ç¼–è¾‘å¼¹çª— -->
  <div class="modal" id="batchEditModal">
    <div class="modal-content">
      <div class="modal-header">
        <h3>æ‰¹é‡ç¼–è¾‘</h3>
        <button class="modal-close" onclick="closeBatchEditModal()">&times;</button>
      </div>
      <div class="modal-body">
        <div class="batch-mode-tabs">
          <button class="batch-mode-tab active" data-mode="comma">é€—å·æ¨¡å¼</button>
          <button class="batch-mode-tab" data-mode="colon">å†’å·æ¨¡å¼</button>
        </div>
        <div class="batch-format-hint" id="formatHint">
          æ ¼å¼: å¯ç”¨,å‚æ•°å,å‚æ•°å€¼,ç±»å‹,å¿…éœ€,Content-Type,è¯´æ˜<br>
          æ•°æ®æ ¼å¼éµå¾ªã€Šæ ‡å‡† CSV è§„èŒƒã€‹å­—æ®µä¹‹é—´ä»¥è‹±æ–‡é€—å·(,)åˆ†éš”,å¤šæ¡è®°å½•ä»¥æ¢è¡Œåˆ†éš”
        </div>
        <textarea class="batch-textarea" id="batchEditInput" placeholder="è¾“å…¥æ‰¹é‡æ•°æ®..."></textarea>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="closeBatchEditModal()">å–æ¶ˆ</button>
        <button class="btn btn-primary" onclick="applyBatchEdit()">ç¡®å®š</button>
      </div>
    </div>
  </div>

  <script>
    let currentBatchType = 'params';
    let currentBodyType = 'none';

    // æ ‡ç­¾é¡µåˆ‡æ¢
    document.querySelectorAll('.main-tab').forEach(tab => {
      tab.addEventListener('click', () => {
        const tabName = tab.dataset.tab;
        document.querySelectorAll('.main-tab').forEach(t => t.classList.remove('active'));
        document.querySelectorAll('.tab-panel').forEach(p => p.classList.remove('active'));
        tab.classList.add('active');
        document.getElementById(tabName + 'Panel').classList.add('active');
      });
    });

    // Body ç±»å‹åˆ‡æ¢
    document.querySelectorAll('.body-type-tab').forEach(tab => {
      tab.addEventListener('click', () => {
        const bodyType = tab.dataset.bodyType;
        document.querySelectorAll('.body-type-tab').forEach(t => t.classList.remove('active'));
        document.querySelectorAll('[id^="body"]').forEach(p => p.style.display = 'none');
        tab.classList.add('active');
        currentBodyType = bodyType;

        if (bodyType === 'none') {
          document.getElementById('bodyNone').style.display = 'block';
        } else if (bodyType === 'form-data') {
          document.getElementById('bodyFormData').style.display = 'block';
        } else if (bodyType === 'json') {
          document.getElementById('bodyJson').style.display = 'block';
        } else if (bodyType === 'text') {
          document.getElementById('bodyText').style.display = 'block';
        }
      });
    });

    // æ‰¹é‡ç¼–è¾‘æ¨¡å¼åˆ‡æ¢
    document.querySelectorAll('.batch-mode-tab').forEach(tab => {
      tab.addEventListener('click', () => {
        document.querySelectorAll('.batch-mode-tab').forEach(t => t.classList.remove('active'));
        tab.classList.add('active');
        const mode = tab.dataset.mode;
        const hint = document.getElementById('formatHint');
        if (mode === 'comma') {
          hint.innerHTML = 'æ ¼å¼: å¯ç”¨,å‚æ•°å,å‚æ•°å€¼,ç±»å‹,å¿…éœ€,Content-Type,è¯´æ˜<br>æ•°æ®æ ¼å¼éµå¾ªã€Šæ ‡å‡† CSV è§„èŒƒã€‹å­—æ®µä¹‹é—´ä»¥è‹±æ–‡é€—å·(,)åˆ†éš”,å¤šæ¡è®°å½•ä»¥æ¢è¡Œåˆ†éš”';
        } else {
          hint.innerHTML = 'æ ¼å¼: å‚æ•°å:å‚æ•°å€¼<br>æ¯è¡Œä¸€ä¸ªå‚æ•°ï¼Œå‚æ•°åå’Œå‚æ•°å€¼ç”¨å†’å·åˆ†éš”';
        }
      });
    });

    // å‚æ•°è¡Œç®¡ç†
    function addParamRow() {
      const tbody = document.getElementById('paramsTableBody');
      const row = createParamRow();
      tbody.appendChild(row);
    }

    function addFormDataRow() {
      const tbody = document.getElementById('formDataTableBody');
      const row = createFormDataRow();
      tbody.appendChild(row);
    }

    function createParamRow() {
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td><input type="checkbox" class="param-checkbox" checked></td>
        <td><input type="text" placeholder="å‚æ•°å" class="param-key"></td>
        <td><input type="text" placeholder="å‚æ•°å€¼" class="param-value"></td>
        <td>
          <select class="param-type">
            <option value="text">Text</option>
            <option value="number">Number</option>
            <option value="boolean">Boolean</option>
          </select>
        </td>
        <td><input type="text" placeholder="è¯´æ˜" class="param-desc"></td>
        <td><button class="remove-btn" onclick="removeParamRow(this)">åˆ é™¤</button></td>
      `;
      return tr;
    }

    function createFormDataRow() {
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td><input type="checkbox" class="param-checkbox" checked></td>
        <td><input type="text" placeholder="å‚æ•°å" class="param-key"></td>
        <td>
          <div class="file-input-wrapper">
            <input type="text" placeholder="å‚æ•°å€¼" class="param-value">
            <button class="file-select-btn" onclick="selectFile(this)">é€‰æ‹©æ–‡ä»¶</button>
            <input type="file" class="param-file" style="display: none;" onchange="handleFileSelect(this)">
            <span class="file-name"></span>
          </div>
        </td>
        <td>
          <select class="param-type" onchange="handleTypeChange(this)">
            <option value="text">Text</option>
            <option value="file">File</option>
          </select>
        </td>
        <td><input type="text" placeholder="è¯´æ˜" class="param-desc"></td>
        <td><button class="remove-btn" onclick="removeParamRow(this)">åˆ é™¤</button></td>
      `;
      return tr;
    }

    function removeParamRow(btn) {
      btn.closest('tr').remove();
    }

    function selectFile(btn) {
      const fileInput = btn.nextElementSibling;
      fileInput.click();
    }

    function handleFileSelect(input) {
      const file = input.files[0];
      if (file) {
        const wrapper = input.closest('.file-input-wrapper');
        const fileName = wrapper.querySelector('.file-name');
        fileName.textContent = file.name;
        const valueInput = wrapper.querySelector('.param-value');
        valueInput.value = file.name;
        // è®¾ç½®ç±»å‹ä¸º file
        const typeSelect = input.closest('tr').querySelector('.param-type');
        typeSelect.value = 'file';
      }
    }

    function handleTypeChange(select) {
      const row = select.closest('tr');
      const valueCell = row.querySelector('td:nth-child(3)');
      if (select.value === 'file') {
        if (!valueCell.querySelector('.file-select-btn')) {
          valueCell.innerHTML = `
            <div class="file-input-wrapper">
              <input type="text" placeholder="å‚æ•°å€¼" class="param-value" readonly>
              <button class="file-select-btn" onclick="selectFile(this)">é€‰æ‹©æ–‡ä»¶</button>
              <input type="file" class="param-file" style="display: none;" onchange="handleFileSelect(this)">
              <span class="file-name"></span>
            </div>
          `;
        }
      } else {
        const valueInput = valueCell.querySelector('.param-value');
        if (valueInput) {
          valueCell.innerHTML = `<input type="text" placeholder="å‚æ•°å€¼" class="param-value">`;
        }
      }
    }

    // è¯·æ±‚å¤´ç®¡ç†
    function addHeaderRow() {
      const tbody = document.getElementById('headersTableBody');
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td><input type="checkbox" class="param-checkbox" checked></td>
        <td><input type="text" placeholder="Key" class="header-key"></td>
        <td><input type="text" placeholder="Value" class="header-value"></td>
        <td><input type="text" placeholder="è¯´æ˜" class="header-desc"></td>
        <td><button class="remove-btn" onclick="removeHeaderRow(this)">åˆ é™¤</button></td>
      `;
      tbody.appendChild(tr);
    }

    function removeHeaderRow(btn) {
      btn.closest('tr').remove();
    }

    // æ‰¹é‡ç¼–è¾‘
    function openBatchEditModal(type) {
      currentBatchType = type;
      const modal = document.getElementById('batchEditModal');
      modal.classList.add('active');
      exportBatchData();
    }

    function closeBatchEditModal() {
      const modal = document.getElementById('batchEditModal');
      modal.classList.remove('active');
    }

    function exportBatchData() {
      const input = document.getElementById('batchEditInput');
      let lines = [];

      if (currentBatchType === 'params') {
        document.querySelectorAll('#paramsTableBody tr').forEach(row => {
          const checkbox = row.querySelector('.param-checkbox');
          const key = row.querySelector('.param-key').value.trim();
          const value = row.querySelector('.param-value').value.trim();
          const type = row.querySelector('.param-type').value;
          const desc = row.querySelector('.param-desc').value.trim();
          if (key && value) {
            lines.push(`${checkbox.checked ? '1' : '0'},${key},${value},${type},,${desc}`);
          }
        });
      } else if (currentBatchType === 'form-data') {
        document.querySelectorAll('#formDataTableBody tr').forEach(row => {
          const checkbox = row.querySelector('.param-checkbox');
          const key = row.querySelector('.param-key').value.trim();
          const value = row.querySelector('.param-value').value.trim();
          const type = row.querySelector('.param-type').value;
          const desc = row.querySelector('.param-desc').value.trim();
          if (key && value) {
            lines.push(`${checkbox.checked ? '1' : '0'},${key},${value},${type},,${desc}`);
          }
        });
      } else if (currentBatchType === 'headers') {
        document.querySelectorAll('#headersTableBody tr').forEach(row => {
          const checkbox = row.querySelector('.param-checkbox');
          const key = row.querySelector('.header-key').value.trim();
          const value = row.querySelector('.header-value').value.trim();
          const desc = row.querySelector('.header-desc').value.trim();
          if (key && value) {
            lines.push(`${checkbox.checked ? '1' : '0'},${key},${value},,,${desc}`);
          }
        });
      }

      input.value = lines.join('\n');
    }

    function applyBatchEdit() {
      const input = document.getElementById('batchEditInput').value.trim();
      if (!input) {
        alert('è¯·è¾“å…¥è¦å¯¼å…¥çš„æ•°æ®');
        return;
      }

      const mode = document.querySelector('.batch-mode-tab.active').dataset.mode;
      const lines = input.split('\n').filter(line => line.trim());

      if (currentBatchType === 'params') {
        const tbody = document.getElementById('paramsTableBody');
        tbody.innerHTML = '';
        lines.forEach(line => {
          if (mode === 'comma') {
            const parts = line.split(',');
            if (parts.length >= 3) {
              const row = createParamRow();
              row.querySelector('.param-checkbox').checked = parts[0] === '1';
              row.querySelector('.param-key').value = parts[1] || '';
              row.querySelector('.param-value').value = parts[2] || '';
              if (parts[3]) row.querySelector('.param-type').value = parts[3];
              if (parts[6]) row.querySelector('.param-desc').value = parts[6];
              tbody.appendChild(row);
            }
          } else {
            const [key, value] = line.split(':').map(s => s.trim());
            if (key && value) {
              const row = createParamRow();
              row.querySelector('.param-key').value = key;
              row.querySelector('.param-value').value = value;
              tbody.appendChild(row);
            }
          }
        });
      } else if (currentBatchType === 'form-data') {
        const tbody = document.getElementById('formDataTableBody');
        tbody.innerHTML = '';
        lines.forEach(line => {
          if (mode === 'comma') {
            const parts = line.split(',');
            if (parts.length >= 3) {
              const row = createFormDataRow();
              row.querySelector('.param-checkbox').checked = parts[0] === '1';
              row.querySelector('.param-key').value = parts[1] || '';
              row.querySelector('.param-value').value = parts[2] || '';
              if (parts[3]) {
                row.querySelector('.param-type').value = parts[3];
                handleTypeChange(row.querySelector('.param-type'));
              }
              if (parts[6]) row.querySelector('.param-desc').value = parts[6];
              tbody.appendChild(row);
            }
          } else {
            const [key, value] = line.split(':').map(s => s.trim());
            if (key && value) {
              const row = createFormDataRow();
              row.querySelector('.param-key').value = key;
              row.querySelector('.param-value').value = value;
              tbody.appendChild(row);
            }
          }
        });
      } else if (currentBatchType === 'headers') {
        const tbody = document.getElementById('headersTableBody');
        tbody.innerHTML = '';
        lines.forEach(line => {
          if (mode === 'comma') {
            const parts = line.split(',');
            if (parts.length >= 3) {
              const tr = document.createElement('tr');
              tr.innerHTML = `
                <td><input type="checkbox" class="param-checkbox" ${parts[0] === '1' ? 'checked' : ''}></td>
                <td><input type="text" placeholder="Key" class="header-key" value="${parts[1] || ''}"></td>
                <td><input type="text" placeholder="Value" class="header-value" value="${parts[2] || ''}"></td>
                <td><input type="text" placeholder="è¯´æ˜" class="header-desc" value="${parts[6] || ''}"></td>
                <td><button class="remove-btn" onclick="removeHeaderRow(this)">åˆ é™¤</button></td>
              `;
              tbody.appendChild(tr);
            }
          } else {
            const [key, value] = line.split(':').map(s => s.trim());
            if (key && value) {
              const tr = document.createElement('tr');
              tr.innerHTML = `
                <td><input type="checkbox" class="param-checkbox" checked></td>
                <td><input type="text" placeholder="Key" class="header-key" value="${key}"></td>
                <td><input type="text" placeholder="Value" class="header-value" value="${value}"></td>
                <td><input type="text" placeholder="è¯´æ˜" class="header-desc"></td>
                <td><button class="remove-btn" onclick="removeHeaderRow(this)">åˆ é™¤</button></td>
              `;
              tbody.appendChild(tr);
            }
          }
        });
      }

      closeBatchEditModal();
    }

    // ç‚¹å‡»å¼¹çª—å¤–éƒ¨å…³é—­
    document.getElementById('batchEditModal').addEventListener('click', (e) => {
      if (e.target.id === 'batchEditModal') {
        closeBatchEditModal();
      }
    });

    // å‘é€è¯·æ±‚
    document.getElementById('sendBtn').addEventListener('click', async () => {
      const method = document.getElementById('httpMethod').value;
      const url = document.getElementById('httpUrl').value.trim();

      if (!url) {
        alert('è¯·è¾“å…¥æ¥å£è·¯å¾„');
        return;
      }

      const headers = {};
      document.querySelectorAll('#headersTableBody tr').forEach(row => {
        const checkbox = row.querySelector('.param-checkbox');
        if (!checkbox.checked) return;
        const key = row.querySelector('.header-key').value.trim();
        const value = row.querySelector('.header-value').value.trim();
        if (key && value) {
          headers[key] = value;
        }
      });

      const requestConfig = {
        method: method,
        headers: headers
      };

      // å¤„ç† Body
      if (currentBodyType === 'form-data') {
        const formData = new FormData();
        document.querySelectorAll('#formDataTableBody tr').forEach(row => {
          const checkbox = row.querySelector('.param-checkbox');
          if (!checkbox.checked) return;
          const key = row.querySelector('.param-key').value.trim();
          const type = row.querySelector('.param-type').value;
          if (!key) return;

          if (type === 'file') {
            const fileInput = row.querySelector('.param-file');
            if (fileInput && fileInput.files.length > 0) {
              formData.append(key, fileInput.files[0]);
            }
          } else {
            const value = row.querySelector('.param-value').value.trim();
            formData.append(key, value);
          }
        });
        requestConfig.body = formData;
        delete requestConfig.headers['Content-Type'];
      } else if (currentBodyType === 'json') {
        const jsonBody = document.getElementById('jsonBody').value.trim();
        if (jsonBody) {
          try {
            JSON.parse(jsonBody);
            requestConfig.body = jsonBody;
          } catch (e) {
            alert('JSON æ ¼å¼é”™è¯¯ï¼š' + e.message);
            return;
          }
        }
      } else if (currentBodyType === 'text') {
        const textBody = document.getElementById('textBody').value.trim();
        if (textBody) {
          requestConfig.body = textBody;
        }
      }

      // å¤„ç† Query å‚æ•°
      const urlObj = new URL(url.startsWith('http') ? url : 'https://example.com' + url);
      document.querySelectorAll('#paramsTableBody tr').forEach(row => {
        const checkbox = row.querySelector('.param-checkbox');
        if (!checkbox.checked) return;
        const key = row.querySelector('.param-key').value.trim();
        const value = row.querySelector('.param-value').value.trim();
        if (key && value) {
          urlObj.searchParams.append(key, value);
        }
      });

      const finalUrl = url.startsWith('http') ? urlObj.toString() : urlObj.pathname + urlObj.search;

      try {
        const startTime = Date.now();
        const response = await fetch(finalUrl, requestConfig);
        const duration = Date.now() - startTime;

        const responseHeaders = {};
        response.headers.forEach((value, key) => {
          responseHeaders[key] = value;
        });

        let responseBody = '';
        const contentType = response.headers.get('content-type') || '';
        if (contentType.includes('application/json')) {
          try {
            const json = await response.json();
            responseBody = JSON.stringify(json, null, 2);
          } catch (e) {
            responseBody = await response.text();
          }
        } else {
          responseBody = await response.text();
        }

        displayResponse(response.status, response.statusText, responseHeaders, responseBody, duration);
      } catch (error) {
        displayResponse(0, 'Error', {}, 'è¯·æ±‚å¤±è´¥ï¼š' + error.message, 0);
      }
    });

    function displayResponse(status, statusText, headers, body, duration) {
      const responseBody = document.getElementById('responseBody');
      const statusBadge = document.getElementById('responseStatusBadge');

      if (status >= 200 && status < 300) {
        statusBadge.className = 'status-badge status-success';
        statusBadge.textContent = `æˆåŠŸ (${status})`;
      } else if (status >= 400) {
        statusBadge.className = 'status-badge';
        statusBadge.style.background = '#f8d7da';
        statusBadge.style.color = '#721c24';
        statusBadge.textContent = `é”™è¯¯ (${status})`;
      } else {
        statusBadge.className = 'status-badge';
        statusBadge.style.background = '#e2e3e5';
        statusBadge.style.color = '#383d41';
        statusBadge.textContent = status ? `${status} ${statusText}` : 'Error';
      }

      let html = '';
      if (Object.keys(headers).length > 0) {
        html += '<div style="margin-bottom: 15px;"><strong>å“åº”å¤´ï¼š</strong><br>';
        Object.entries(headers).forEach(([key, value]) => {
          html += `<div style="font-size: 12px; color: #6c757d; margin: 5px 0;">${key}: ${value}</div>`;
        });
        html += '</div>';
      }
      html += `<div>${body || '(æ— å“åº”ä½“)'}</div>`;

      responseBody.innerHTML = html;
      responseBody.style.color = status >= 400 ? '#dc3545' : '';
    }
  </script>
</body>

</html>
