<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>å›¾æ ‡å·¥å‚ - iOS & Android</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
  <style>
    *{margin:0;padding:0;box-sizing:border-box}
    body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,'Helvetica Neue',Arial,sans-serif;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);min-height:100vh;padding:20px}
    .container{max-width:1100px;margin:0 auto;background:#fff;border-radius:16px;box-shadow:0 20px 60px rgba(0,0,0,.3);overflow:hidden}
    .header{background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);color:#fff;padding:30px;text-align:center}
    .header h1{font-size:28px;margin-bottom:10px}
    .header p{opacity:.9;font-size:14px}
    .content{padding:30px}
    .form-section{background:#f8f9fa;border-radius:12px;padding:25px;margin-bottom:25px}
    .form-section h2{font-size:20px;color:#495057;margin-bottom:20px;border-bottom:2px solid #667eea;padding-bottom:10px}
    .form-group{margin-bottom:18px}
    .form-group label{display:block;font-weight:600;color:#495057;margin-bottom:8px;font-size:14px}
    .form-group input,.form-group select{width:100%;padding:12px;border:2px solid #dee2e6;border-radius:8px;font-size:14px;transition:border-color .3s}
    .form-group input:focus,.form-group select:focus{outline:none;border-color:#667eea}
    .file-upload-area{border:3px dashed #667eea;border-radius:12px;padding:40px;text-align:center;background:#f8f9ff;cursor:pointer;transition:all .3s}
    .file-upload-area:hover{background:#f0f2ff;border-color:#5568d3}
    .file-upload-area.dragover{background:#e8ebff;border-color:#4456c3}
    .file-upload-area input[type=file]{display:none}
    .btn{background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);color:#fff;border:none;padding:14px 35px;border-radius:8px;font-size:16px;font-weight:600;cursor:pointer;transition:transform .2s;width:100%}
    .btn:hover{transform:translateY(-2px);box-shadow:0 5px 15px rgba(102,126,234,.4)}
    .btn:disabled{opacity:.6;cursor:not-allowed}
    .controls-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:15px}
    .loading{text-align:center;padding:20px;display:none}
    .loading.show{display:block}
    .spinner{border:4px solid #f3f3f3;border-top:4px solid #667eea;border-radius:50%;width:40px;height:40px;animation:spin 1s linear infinite;margin:0 auto 15px}
    @keyframes spin{0%{transform:rotate(0)}100%{transform:rotate(360deg)}}
    .preview-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(130px,1fr));gap:12px}
    .preview-card{background:#fff;border:2px solid #dee2e6;border-radius:12px;padding:12px;text-align:center}
    .preview-title{font-size:13px;color:#6c757d;margin-bottom:8px}
    .preview-image{width:96px;height:96px;border-radius:16px;object-fit:contain;background:#f8f9fa;border:1px dashed #e9ecef}
    .status{display:none;margin-top:12px;padding:10px;border-radius:8px}
    .status.show{display:block}
    .status.success{background:#d4edda;color:#155724;border:1px solid #c3e6cb}
    .status.error{background:#f8d7da;color:#721c24;border:1px solid #f5c6cb}
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>ğŸ¨ å›¾æ ‡å·¥å‚</h1>
      <p>ä¸Šä¼ ä¸€ä¸ªå›¾æ ‡ï¼Œç”Ÿæˆ iOS ä¸ Android æ ‡å‡†å°ºå¯¸ä¸æ–‡ä»¶å¤¹ç»“æ„</p>
    </div>
    <div class="content">
      <div class="form-section">
        <h2>ä¸Šä¼ å›¾æ ‡</h2>
        <div class="file-upload-area" id="uploadArea">
          <div style="font-size:42px;color:#667eea;margin-bottom:10px">ğŸ“</div>
          <div style="color:#495057;font-size:16px;margin-bottom:6px">ç‚¹å‡»æˆ–æ‹–æ‹½å›¾æ ‡åˆ°æ­¤å¤„</div>
          <div style="color:#6c757d;font-size:12px">å»ºè®®ä¸Šä¼ æ­£æ–¹å½¢ PNGï¼Œå°ºå¯¸â‰¥1024Ã—1024</div>
          <input type="file" id="iconInput" accept="image/*">
        </div>
        <div class="status" id="uploadStatus"></div>
      </div>

      <div class="form-section">
        <h2>ç”Ÿæˆè®¾ç½®</h2>
        <div class="controls-grid">
          <div class="form-group">
            <label for="bgColor">èƒŒæ™¯é¢œè‰²ï¼ˆç”¨äºéæ­£æ–¹å½¢å›¾æ ‡è¡¥è¾¹ï¼‰</label>
            <input type="color" id="bgColor" value="#FFFFFF">
          </div>
          <div class="form-group">
            <label for="padding">å†…è¾¹è·ï¼ˆç™¾åˆ†æ¯”ï¼Œ0-30ï¼‰</label>
            <input type="number" id="padding" min="0" max="30" value="0">
          </div>
          <div class="form-group">
            <label>
              <input type="checkbox" id="generateRound">
              ç”Ÿæˆåœ†å½¢å›¾æ ‡ï¼ˆic_launcher_roundï¼‰
            </label>
          </div>
          <div class="form-group">
            <label for="platformSelect">å¹³å°</label>
            <select id="platformSelect">
              <option value="both">iOS + Android</option>
              <option value="ios">ä»… iOS</option>
              <option value="android">ä»… Android</option>
            </select>
          </div>
        </div>
        <button class="btn" id="generateBtn" disabled>ç”Ÿæˆå¹¶ä¸‹è½½ ZIP</button>
      </div>

      <div class="loading" id="loading">
        <div class="spinner"></div>
        <div>æ­£åœ¨ç”Ÿæˆå›¾æ ‡åŠç›®å½•ç»“æ„...</div>
      </div>

      <div class="form-section">
        <h2>é¢„è§ˆï¼ˆéƒ¨åˆ†å°ºå¯¸ï¼‰</h2>
        <div class="preview-grid" id="previewGrid"></div>
      </div>
    </div>
  </div>

  <script>
    const uploadArea=document.getElementById('uploadArea');
    const iconInput=document.getElementById('iconInput');
    const uploadStatus=document.getElementById('uploadStatus');
    const bgColorInput=document.getElementById('bgColor');
    const paddingInput=document.getElementById('padding');
    const platformSelect=document.getElementById('platformSelect');
    const generateBtn=document.getElementById('generateBtn');
    const loading=document.getElementById('loading');
    const previewGrid=document.getElementById('previewGrid');

    let baseImage=null;

    uploadArea.addEventListener('click',()=>iconInput.click());
    uploadArea.addEventListener('dragover',e=>{e.preventDefault();uploadArea.classList.add('dragover')});
    uploadArea.addEventListener('dragleave',e=>{e.preventDefault();uploadArea.classList.remove('dragover')});
    uploadArea.addEventListener('drop',e=>{e.preventDefault();uploadArea.classList.remove('dragover');const files=e.dataTransfer.files;if(files.length>0)handleFile(files[0])});
    iconInput.addEventListener('change',e=>{const file=e.target.files[0];if(file)handleFile(file)});

    function showStatus(text,type){uploadStatus.textContent=text;uploadStatus.className='status show '+(type||'success')}

    function handleFile(file){
      if(!file.type.startsWith('image/')){showStatus('è¯·é€‰æ‹©å›¾ç‰‡æ–‡ä»¶','error');return}
      const reader=new FileReader();
      reader.onload=e=>{
        const img=new Image();
        img.onload=()=>{
          baseImage=img;
          generateBtn.disabled=false;
          showStatus('å›¾æ ‡åŠ è½½æˆåŠŸ','success');
          renderPreview();
        };
        img.src=e.target.result;
      };
      reader.readAsDataURL(file);
    }

    function drawIconToCanvas(size,bgColor,padding){
      const c=document.createElement('canvas');
      c.width=size;c.height=size;
      const ctx=c.getContext('2d');
      ctx.fillStyle=bgColor;ctx.fillRect(0,0,size,size);
      const iw=baseImage.naturalWidth||baseImage.width;
      const ih=baseImage.naturalHeight||baseImage.height;
      const inset=size*(padding/100);
      const target=size-2*inset;
      const scale=Math.min(Math.min(target/iw,target/ih),1);
      const dw=iw*scale;
      const dh=ih*scale;
      const dx=(size-dw)/2;
      const dy=(size-dh)/2;
      ctx.imageSmoothingEnabled=true;
      ctx.imageSmoothingQuality='high';
      ctx.drawImage(baseImage,dx,dy,dw,dh);
      return c;
    }

    function drawRoundIconToCanvas(size,bgColor,padding){
      const c=document.createElement('canvas');
      c.width=size;c.height=size;
      const ctx=c.getContext('2d');
      ctx.fillStyle=bgColor;ctx.fillRect(0,0,size,size);
      ctx.save();
      ctx.beginPath();
      ctx.arc(size/2,size/2,size/2,0,Math.PI*2);
      ctx.closePath();
      ctx.clip();
      const iw=baseImage.naturalWidth||baseImage.width;
      const ih=baseImage.naturalHeight||baseImage.height;
      const inset=size*(padding/100);
      const target=size-2*inset;
      const scale=Math.min(Math.min(target/iw,target/ih),1);
      const dw=iw*scale;
      const dh=ih*scale;
      const dx=(size-dw)/2;
      const dy=(size-dh)/2;
      ctx.imageSmoothingEnabled=true;
      ctx.imageSmoothingQuality='high';
      ctx.drawImage(baseImage,dx,dy,dw,dh);
      ctx.restore();
      return c;
    }

    function canvasToBlob(canvas,mime='image/png',quality=1){
      return new Promise(res=>canvas.toBlob(b=>res(b),mime,quality));
    }

    async function encodePngNative(canvas){
      return canvasToBlob(canvas,'image/png',1);
    }

    function renderPreview(){
      previewGrid.innerHTML='';
      if(!baseImage)return;
      const bg=bgColorInput.value;
      const pad=parseInt(paddingInput.value)||0;
      const previewSizes=[1024,180,120,80,60,48,192];
      previewSizes.forEach(async s=>{
        const card=document.createElement('div');
        card.className='preview-card';
        const title=document.createElement('div');
        title.className='preview-title';
        title.textContent=`${s}Ã—${s}`;
        const imgEl=document.createElement('img');
        imgEl.className='preview-image';
        const c=drawIconToCanvas(s,bg,pad);
        imgEl.src=c.toDataURL('image/png');
        card.appendChild(title);
        card.appendChild(imgEl);
        previewGrid.appendChild(card);
      });
    }

    const iosSpecs=[
      {size:40,name:'icon-20@2x.png',idiom:'iphone',scale:'2x',pt:'20x20'},
      {size:60,name:'icon-20@3x.png',idiom:'iphone',scale:'3x',pt:'20x20'},
      {size:58,name:'icon-29@2x.png',idiom:'iphone',scale:'2x',pt:'29x29'},
      {size:87,name:'icon-29@3x.png',idiom:'iphone',scale:'3x',pt:'29x29'},
      {size:80,name:'icon-40@2x.png',idiom:'iphone',scale:'2x',pt:'40x40'},
      {size:120,name:'icon-40@3x.png',idiom:'iphone',scale:'3x',pt:'40x40'},
      {size:120,name:'icon-60@2x.png',idiom:'iphone',scale:'2x',pt:'60x60'},
      {size:180,name:'icon-60@3x.png',idiom:'iphone',scale:'3x',pt:'60x60'},
      {size:20,name:'icon-20-ipad.png',idiom:'ipad',scale:'1x',pt:'20x20'},
      {size:40,name:'icon-20-ipad@2x.png',idiom:'ipad',scale:'2x',pt:'20x20'},
      {size:29,name:'icon-29-ipad.png',idiom:'ipad',scale:'1x',pt:'29x29'},
      {size:58,name:'icon-29-ipad@2x.png',idiom:'ipad',scale:'2x',pt:'29x29'},
      {size:40,name:'icon-40-ipad.png',idiom:'ipad',scale:'1x',pt:'40x40'},
      {size:80,name:'icon-40-ipad@2x.png',idiom:'ipad',scale:'2x',pt:'40x40'},
      {size:76,name:'icon-76.png',idiom:'ipad',scale:'1x',pt:'76x76'},
      {size:152,name:'icon-76@2x.png',idiom:'ipad',scale:'2x',pt:'76x76'},
      {size:167,name:'icon-83.5@2x.png',idiom:'ipad',scale:'2x',pt:'83.5x83.5'},
      {size:1024,name:'icon-1024.png',idiom:'ios-marketing',scale:'1x',pt:'1024x1024'}
    ];

    const androidSquareSpecs=[
      {size:48,dir:'mipmap-mdpi',name:'ic_launcher.png'},
      {size:72,dir:'mipmap-hdpi',name:'ic_launcher.png'},
      {size:96,dir:'mipmap-xhdpi',name:'ic_launcher.png'},
      {size:144,dir:'mipmap-xxhdpi',name:'ic_launcher.png'},
      {size:192,dir:'mipmap-xxxhdpi',name:'ic_launcher.png'}
    ];

    const androidRoundSpecs=[
      {size:48,dir:'mipmap-mdpi',name:'ic_launcher_round.png'},
      {size:72,dir:'mipmap-hdpi',name:'ic_launcher_round.png'},
      {size:96,dir:'mipmap-xhdpi',name:'ic_launcher_round.png'},
      {size:144,dir:'mipmap-xxhdpi',name:'ic_launcher_round.png'},
      {size:192,dir:'mipmap-xxxhdpi',name:'ic_launcher_round.png'}
    ];

    function buildIosContentsJson(images){
      return JSON.stringify({
        images: images.map(img=>({
          size: img.pt,
          idiom: img.idiom,
          filename: img.name,
          scale: img.scale
        })),
        info: { version:1, author:"icon-factory" }
      },null,2);
    }

    generateBtn.addEventListener('click',async()=>{
      if(!baseImage)return;
      const bg=bgColorInput.value;
      const pad=parseInt(paddingInput.value)||0;
      const platform=platformSelect.value;
      loading.classList.add('show');
      try{
        const zip=new JSZip();
        if(platform==='both'||platform==='ios'){
          const iosFolder=zip.folder('iOS').folder('AppIcon.appiconset');
          const iosImages=[];
          for(const spec of iosSpecs){
            const c=drawIconToCanvas(spec.size,bg,pad);
            const blob=await encodePngNative(c);
            iosFolder.file(spec.name,blob);
            iosImages.push(spec);
          }
          iosFolder.file('Contents.json',buildIosContentsJson(iosImages));
        }
        if(platform==='both'||platform==='android'){
          const andFolder=zip.folder('Android');
          for(const spec of androidSquareSpecs){
            const c=drawIconToCanvas(spec.size,bg,pad);
            const blob=await encodePngNative(c);
            andFolder.folder(spec.dir).file(spec.name,blob);
          }
          const genRound=document.getElementById('generateRound').checked;
          if(genRound){
            for(const spec of androidRoundSpecs){
              const c=drawRoundIconToCanvas(spec.size,bg,pad);
              const blob=await encodePngNative(c);
              andFolder.folder(spec.dir).file(spec.name,blob);
            }
          }
        }
        const blob=await zip.generateAsync({type:'blob'});
        const url=URL.createObjectURL(blob);
        const a=document.createElement('a');
        a.href=url;
        a.download=`icon_factory_${Date.now()}.zip`;
        document.body.appendChild(a);a.click();document.body.removeChild(a);
        URL.revokeObjectURL(url);
        showStatus('ç”Ÿæˆå®Œæˆï¼Œå·²ä¸‹è½½ ZIP åŒ…','success');
      }catch(err){
        console.error(err);
        showStatus('ç”Ÿæˆå¤±è´¥ï¼š'+err.message,'error');
      }finally{
        loading.classList.remove('show');
      }
    });
  </script>
</body>
</html>
