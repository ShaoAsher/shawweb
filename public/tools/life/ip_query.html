<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>IPåœ°å€æŸ¥è¯¢å·¥å…·</title>
<link rel="stylesheet" href="../../assets/css/theme.css">
  <style>
    /* ç»§æ‰¿theme.cssçš„åŸºç¡€æ ·å¼ */
    /* ä»¥ä¸‹æ˜¯å·¥å…·é¡µé¢ç‰¹å®šçš„æ ·å¼è¦†ç›– */

    .container {
      max-width: 1000px;
    }

    .home-btn {
      position: absolute;
      top: var(--spacing-lg);
      left: var(--spacing-lg);
      width: 40px;
      height: 40px;
      background: rgba(255, 255, 255, 0.2);
      border: 2px solid rgba(255, 255, 255, 0.3);
      border-radius: var(--radius-full);
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--color-text-on-primary);
      text-decoration: none;
      font-size: var(--font-size-large);
      transition: all .3s;
      z-index: 10;
      backdrop-filter: blur(10px);
    }

    .home-btn:hover {
      background: rgba(255, 255, 255, 0.3);
      border-color: rgba(255, 255, 255, 0.5);
      transform: scale(1.1);
    }

    .header h1 {
      font-size: var(--font-size-xlarge);
      margin-bottom: var(--spacing-sm);
    }

    .header p {
      opacity: .9;
      font-size: var(--font-size-small);
    }

    .content {
      padding: var(--spacing-xl);
    }

    .query-section {
      background: var(--color-background-alt);
      border-radius: var(--radius-md);
      padding: var(--spacing-lg);
      margin-bottom: var(--spacing-lg);
      border: 1px solid var(--color-border);
    }

    .query-section h2 {
      font-size: var(--font-size-large);
      color: var(--color-text);
      margin-bottom: var(--spacing-lg);
      display: flex;
      align-items: center;
      gap: var(--spacing-sm);
    }

    .query-form {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
      align-items: flex-end;
    }

    .input-group {
      flex: 1;
      min-width: 200px;
    }

    .input-group label {
      display: block;
      font-weight: var(--font-weight-semibold);
      color: var(--color-text);
      margin-bottom: var(--spacing-sm);
      font-size: var(--font-size-small);
    }

    .input-group input {
      padding: var(--spacing-sm) var(--spacing-md);
      border: 2px solid var(--color-border);
      border-radius: var(--radius-sm);
    }

    .input-group input:focus {
      border-color: var(--color-primary);
      box-shadow: 0 0 0 4px var(--color-shadow-primary);
    }

    .btn {
      background: linear-gradient(135deg, var(--color-primary) 0%, var(--color-primary-dark) 100%);
      color: var(--color-text-on-primary);
      padding: var(--spacing-sm) var(--spacing-xl);
      border-radius: var(--radius-sm);
    }

    .btn:hover {
      box-shadow: var(--shadow-md);
    }

    .btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none;
    }

    .btn-secondary {
      background: linear-gradient(135deg, var(--color-secondary) 0%, var(--color-primary-dark) 100%);
    }

    .result-section {
      margin-top: var(--spacing-lg);
    }

    .result-card {
      background: var(--color-surface);
      border-radius: var(--radius-md);
      padding: var(--spacing-lg);
      margin-bottom: var(--spacing-md);
      border: 1px solid var(--color-border);
      box-shadow: var(--shadow-sm);
    }

    .result-card h3 {
      font-size: var(--font-size-large);
      color: var(--color-text);
      margin-bottom: var(--spacing-md);
      display: flex;
      align-items: center;
      gap: var(--spacing-sm);
      padding-bottom: var(--spacing-sm);
      border-bottom: 2px solid var(--color-border);
    }

    .result-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: var(--spacing-md);
    }

    .result-item {
      background: var(--color-surface-alt);
      padding: var(--spacing-md);
      border-radius: var(--radius-sm);
      border: 1px solid var(--color-border);
    }

    .result-label {
      font-size: var(--font-size-small);
      color: var(--color-text-secondary);
      font-weight: var(--font-weight-semibold);
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-bottom: var(--spacing-xs);
    }

    .result-value {
      font-size: var(--font-size-base);
      color: var(--color-text);
      font-weight: var(--font-weight-semibold);
      word-break: break-all;
    }

    .result-value.empty {
      color: var(--color-text-light);
      font-style: italic;
    }

    .loading {
      text-align: center;
      padding: var(--spacing-xl);
      color: var(--color-text-secondary);
    }

    .loading-spinner {
      display: inline-block;
      width: 40px;
      height: 40px;
      border: 4px solid var(--color-border);
      border-top-color: var(--color-primary);
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin-bottom: var(--spacing-md);
    }

    @keyframes spin {
      to {
        transform: rotate(360deg);
      }
    }

    .error {
      background: var(--color-surface-alt);
      border-color: var(--color-error);
      color: var(--color-error);
      padding: var(--spacing-md);
      border-radius: var(--radius-sm);
      margin-top: var(--spacing-md);
      border: 2px solid var(--color-error);
    }

    .ip-badge {
      display: inline-block;
      background: linear-gradient(135deg, var(--color-primary) 0%, var(--color-primary-dark) 100%);
      color: var(--color-text-on-primary);
      padding: var(--spacing-xs) var(--spacing-sm);
      border-radius: var(--radius-lg);
      font-size: var(--font-size-small);
      font-weight: var(--font-weight-semibold);
      margin-left: var(--spacing-sm);
    }

    @media (max-width: 768px) {
      .query-form {
        flex-direction: column;
      }

      .btn {
        width: 100%;
      }

      .result-grid {
        grid-template-columns: 1fr;
      }
    }
  </style>
  <link rel="icon" href="data:,">
  <script src="../../assets/js/tools.js"></script>
  <script src="../../assets/js/themes.js"></script>
  <script src="../../assets/js/theme-ui.js"></script>
</head>

<body>
  <div class="container">
    <div class="header">
      <a href="../../index.html" class="home-btn">ğŸ </a>
      <h1></h1>
      <p></p>
    </div>
    <div class="content">
      <!-- å½“å‰IPæŸ¥è¯¢ -->
      <div class="query-section">
        <h2>
          <span>ğŸŒ</span>
          <span>å½“å‰IPåœ°å€æŸ¥è¯¢</span>
        </h2>
        <button class="btn" id="queryCurrentBtn">
          <span>æŸ¥è¯¢æˆ‘çš„IP</span>
        </button>
        <div id="currentIpResult"></div>
      </div>

      <!-- è¾“å…¥IPæŸ¥è¯¢ -->
      <div class="query-section">
        <h2>
          <span>ğŸ”</span>
          <span>IPåœ°å€å½’å±åœ°æŸ¥è¯¢</span>
        </h2>
        <div class="query-form">
          <div class="input-group">
            <label for="ipInput">IPåœ°å€</label>
            <input type="text" id="ipInput" placeholder="è¯·è¾“å…¥IPåœ°å€ï¼Œä¾‹å¦‚ï¼š8.8.8.8" />
          </div>
          <button class="btn" id="queryIpBtn">
            <span>æŸ¥è¯¢</span>
          </button>
        </div>
        <div id="ipResult"></div>
      </div>
    </div>
  </div>

  <script>
    // IPæŸ¥è¯¢APIï¼ˆä½¿ç”¨ipinfo.ioï¼Œæ”¯æŒHTTPSå’ŒCORSï¼Œå…è´¹ï¼‰
    const IPINFO_API_BASE = 'https://ipinfo.io/';
    // å¤‡ç”¨APIï¼ˆipwhois.appï¼Œæ”¯æŒHTTPSå’ŒCORSï¼Œå…è´¹ï¼‰
    const IPWHOIS_API_BASE = 'https://ipwhois.app/json/';

    // éªŒè¯IPåœ°å€æ ¼å¼
    function isValidIP(ip) {
      const ipRegex = /^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/;
      return ipRegex.test(ip);
    }

    // ä½¿ç”¨ipinfo.ioæŸ¥è¯¢IPä¿¡æ¯ï¼ˆä¸»APIï¼‰
    async function queryIPWithIpinfo(ip = '') {
      const url = ip ? `${IPINFO_API_BASE}${ip}/json` : `${IPINFO_API_BASE}json`;
      const response = await fetch(url);

      if (!response.ok) {
        throw new Error(`HTTPé”™è¯¯: ${response.status}`);
      }

      const data = await response.json();

      // è§£æç»çº¬åº¦
      let lat = 0, lon = 0;
      if (data.loc) {
        const [latitude, longitude] = data.loc.split(',').map(Number);
        lat = latitude || 0;
        lon = longitude || 0;
      }

      // è§£æASä¿¡æ¯
      let as = 'æœªçŸ¥';
      if (data.org) {
        const asMatch = data.org.match(/AS\d+/);
        if (asMatch) {
          as = asMatch[0];
        }
      }

      return {
        ip: data.ip || ip || 'æœªçŸ¥',
        country: data.country_name || data.country || 'æœªçŸ¥',
        countryCode: data.country || '',
        region: data.region || 'æœªçŸ¥',
        city: data.city || 'æœªçŸ¥',
        zip: data.postal || 'æœªçŸ¥',
        lat: lat,
        lon: lon,
        timezone: data.timezone || 'æœªçŸ¥',
        isp: data.org ? data.org.replace(/AS\d+\s*/, '') : 'æœªçŸ¥',
        org: data.org || 'æœªçŸ¥',
        as: as
      };
    }

    // ä½¿ç”¨ipwhois.appæŸ¥è¯¢IPä¿¡æ¯ï¼ˆå¤‡ç”¨APIï¼‰
    async function queryIPWithIpwhois(ip = '') {
      const url = ip ? `${IPWHOIS_API_BASE}${ip}` : IPWHOIS_API_BASE;
      const response = await fetch(url);

      if (!response.ok) {
        throw new Error(`HTTPé”™è¯¯: ${response.status}`);
      }

      const data = await response.json();

      if (data.success === false) {
        throw new Error(data.message || 'æŸ¥è¯¢å¤±è´¥');
      }

      return {
        ip: data.ip || ip || 'æœªçŸ¥',
        country: data.country || 'æœªçŸ¥',
        countryCode: data.country_code || '',
        region: data.region || 'æœªçŸ¥',
        city: data.city || 'æœªçŸ¥',
        zip: data.postal || 'æœªçŸ¥',
        lat: data.latitude || 0,
        lon: data.longitude || 0,
        timezone: data.timezone || 'æœªçŸ¥',
        isp: data.isp || 'æœªçŸ¥',
        org: data.org || 'æœªçŸ¥',
        as: data.asn ? `AS${data.asn}` : 'æœªçŸ¥'
      };
    }

    // æŸ¥è¯¢IPä¿¡æ¯ï¼ˆè‡ªåŠ¨å°è¯•å¤šä¸ªAPIï¼‰
    async function queryIP(ip = '') {
      const apis = [
        { name: 'ipinfo.io', func: queryIPWithIpinfo },
        { name: 'ipwhois.app', func: queryIPWithIpwhois }
      ];

      for (const api of apis) {
        try {
          console.log(`å°è¯•ä½¿ç”¨ ${api.name} æŸ¥è¯¢...`);
          return await api.func(ip);
        } catch (error) {
          console.log(`${api.name} æŸ¥è¯¢å¤±è´¥:`, error.message);
          // ç»§ç»­å°è¯•ä¸‹ä¸€ä¸ªAPI
          continue;
        }
      }

      // æ‰€æœ‰APIéƒ½å¤±è´¥
      throw new Error('æ‰€æœ‰APIæŸ¥è¯¢å‡å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥æˆ–ç¨åé‡è¯•ã€‚');
    }

    // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
    function showLoading(containerId) {
      const container = document.getElementById(containerId);
      container.innerHTML = `
        <div class="loading">
          <div class="loading-spinner"></div>
          <div>æ­£åœ¨æŸ¥è¯¢ä¸­...</div>
        </div>
      `;
    }

    // æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
    function showError(containerId, message) {
      const container = document.getElementById(containerId);
      container.innerHTML = `
        <div class="error">
          <strong>âŒ æŸ¥è¯¢å¤±è´¥</strong>
          <p>${message}</p>
        </div>
      `;
    }

    // æ˜¾ç¤ºæŸ¥è¯¢ç»“æœ
    function showResult(containerId, data, isCurrent = false) {
      const container = document.getElementById(containerId);
      const title = isCurrent ? 'å½“å‰IPä¿¡æ¯' : 'IPå½’å±åœ°ä¿¡æ¯';
      const icon = isCurrent ? 'ğŸŒ' : 'ğŸ“';

      container.innerHTML = `
        <div class="result-card">
          <h3>
            <span>${icon}</span>
            <span>${title}</span>
            <span class="ip-badge">${data.ip}</span>
          </h3>
          <div class="result-grid">
            <div class="result-item">
              <div class="result-label">å›½å®¶/åœ°åŒº</div>
              <div class="result-value">${data.country} ${data.countryCode ? `(${data.countryCode})` : ''}</div>
            </div>
            <div class="result-item">
              <div class="result-label">çœä»½/å·</div>
              <div class="result-value">${data.region}</div>
            </div>
            <div class="result-item">
              <div class="result-label">åŸå¸‚</div>
              <div class="result-value">${data.city}</div>
            </div>
            <div class="result-item">
              <div class="result-label">é‚®æ”¿ç¼–ç </div>
              <div class="result-value ${data.zip === 'æœªçŸ¥' ? 'empty' : ''}">${data.zip}</div>
            </div>
            <div class="result-item">
              <div class="result-label">æ—¶åŒº</div>
              <div class="result-value">${data.timezone}</div>
            </div>
            <div class="result-item">
              <div class="result-label">ISPæœåŠ¡å•†</div>
              <div class="result-value">${data.isp}</div>
            </div>
            <div class="result-item">
              <div class="result-label">ç»„ç»‡</div>
              <div class="result-value ${data.org === 'æœªçŸ¥' ? 'empty' : ''}">${data.org}</div>
            </div>
            <div class="result-item">
              <div class="result-label">ASç¼–å·</div>
              <div class="result-value ${data.as === 'æœªçŸ¥' ? 'empty' : ''}">${data.as}</div>
            </div>
            ${data.lat && data.lon ? `
            <div class="result-item">
              <div class="result-label">ç»çº¬åº¦</div>
              <div class="result-value">${data.lat}, ${data.lon}</div>
            </div>
            ` : ''}
          </div>
        </div>
      `;
    }

    // æŸ¥è¯¢å½“å‰IP
    document.getElementById('queryCurrentBtn').addEventListener('click', async () => {
      const btn = document.getElementById('queryCurrentBtn');
      const originalText = btn.innerHTML;

      btn.disabled = true;
      btn.innerHTML = '<span>æŸ¥è¯¢ä¸­...</span>';
      showLoading('currentIpResult');

      try {
        const data = await queryIP();
        showResult('currentIpResult', data, true);
      } catch (error) {
        showError('currentIpResult', error.message || 'æ— æ³•è·å–å½“å‰IPä¿¡æ¯ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥');
      } finally {
        btn.disabled = false;
        btn.innerHTML = originalText;
      }
    });

    // æŸ¥è¯¢è¾“å…¥IP
    document.getElementById('queryIpBtn').addEventListener('click', async () => {
      const ipInput = document.getElementById('ipInput');
      const ip = ipInput.value.trim();
      const btn = document.getElementById('queryIpBtn');
      const originalText = btn.innerHTML;

      if (!ip) {
        showError('ipResult', 'è¯·è¾“å…¥IPåœ°å€');
        return;
      }

      if (!isValidIP(ip)) {
        showError('ipResult', 'IPåœ°å€æ ¼å¼ä¸æ­£ç¡®ï¼Œè¯·è¾“å…¥æœ‰æ•ˆçš„IPv4åœ°å€');
        return;
      }

      btn.disabled = true;
      btn.innerHTML = '<span>æŸ¥è¯¢ä¸­...</span>';
      showLoading('ipResult');

      try {
        const data = await queryIP(ip);
        showResult('ipResult', data, false);
      } catch (error) {
        showError('ipResult', error.message || 'æŸ¥è¯¢å¤±è´¥ï¼Œè¯·æ£€æŸ¥IPåœ°å€æ˜¯å¦æ­£ç¡®');
      } finally {
        btn.disabled = false;
        btn.innerHTML = originalText;
      }
    });

    // æ”¯æŒå›è½¦é”®æŸ¥è¯¢
    document.getElementById('ipInput').addEventListener('keypress', (e) => {
      if (e.key === 'Enter') {
        document.getElementById('queryIpBtn').click();
      }
    });

    // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æŸ¥è¯¢å½“å‰IP
    window.addEventListener('DOMContentLoaded', () => {
      // å»¶è¿Ÿä¸€ä¸‹ï¼Œç¡®ä¿é¡µé¢å®Œå…¨åŠ è½½
      setTimeout(() => {
        document.getElementById('queryCurrentBtn').click();
      }, 500);
    });
  </script>
</body>

</html>